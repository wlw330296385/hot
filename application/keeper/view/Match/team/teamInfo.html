<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>球队详情</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--标准mui.css-->
    <link rel="stylesheet" href="/static/frontend/css/mui.min.css">
    <!--自定义style.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/style.css" />
    <style>
        .teamCont {
            padding: 15px !important;
            background: #fff !important;
        }

        .teamCont .teamLogo img {
            width: 80px !important;
            height: 80px !important;
        }

        .teamCont p {
            padding: 10px;
            margin: 0;
        }
        .teamMemberName {
            padding-left: 10px;
        }
        .claim,.sendApply {
            padding: 3px 9px !important;
        }
    </style>
</head>

<body>

    <header class="mui-bar mui-bar-nav subheader">
        <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left arrow"></a>
    </header>

    <div class="mui-content">
        <div class="list">
            <div class="mui-text-center teamCont">
                <p class="teamLogo"><img src="{$teamInfo.logo}" alt="" class="img50"></p>
                <p class="teamName">{$teamInfo.name}</p>
            </div>

            <!-- 领队 -->
            <div class="page-header bggray2">
                <span class="f14">领队</span>
            </div>
            <ul class="mui-table-view">
                <li class="mui-table-view-cell listli">
                    <div class="mui-row" style="line-height: 27px;">
                        <div class="mui-col-xs-1 mui-text-center">1</div>
                        <div class="mui-col-xs-8 teamMemberName">{$leaderInfo.name}</div>
                        {if $leaderInfo.telephone == $myTelephone && $leaderInfo.member_id ==-1}
                        <div class="mui-col-xs-3 mui-text-right">
                            <button type="button" class="mui-btn-danger claim" data-team_member_id="{$leaderInfo.id}">认领</button>
                        </div>
                        {/if}
                        {if $leaderInfo.member_id ==-1}
                        <div class="mui-col-xs-3 mui-text-right">
                            未认领
                        </div>
                        {else/}
                        <div class="mui-col-xs-3 mui-text-right colorred">
                            已认领
                        </div>
                        {/if}
                    </div>
                </li>
            </ul>

            <!-- 参赛队员 -->
            <div class="page-header bggray2">
                <span class="f14">参赛队员</span>
            </div>
            <ul class="mui-table-view" style="margin-bottom: 66px;">
                {if condition="empty($teamMembers)"}
                <p class="nohave">暂无球员数据</p>
                {else/}
                {volist name="teamMembers" id="vo"}
                <li class="mui-table-view-cell listli">
                    <div class="mui-row" style="line-height: 27px;">
                        <div class="mui-col-xs-1 mui-text-center">{$key+1}</div>
                        <div class="mui-col-xs-8 teamMemberName">{$vo.name}</div>
                        {if $vo.telephone !=0 || $myTelephone !=0}
                        {if $vo.telephone == $myTelephone && $vo.member_id ==-1}
                        <div class="mui-col-xs-3 mui-text-right">
                            <button type="button" class="mui-btn-danger claim" data-team_member_id="{$vo.id}">认领</button>
                        </div>
                        {/if}
                        {if $vo.telephone == $myTelephone && $vo.member_id !=-1}
                        <div class="mui-col-xs-3 mui-text-right colorred">
                            已认领
                        </div>
                        {/if}
                        {if $vo.telephone != $myTelephone && $vo.member_id !=-1}
                        <div class="mui-col-xs-3 mui-text-right colorred">
                            已认领
                        </div>
                        {/if}
                        {if $vo.telephone != $myTelephone && $vo.member_id ==-1}
                        <div class="mui-col-xs-3 mui-text-right">
                            未认领
                        </div>
                        {/if}
                        {else/}
                        <div class="mui-col-xs-3 mui-text-right">
                            <a href="#sendApply"><button type="button" class="bgblue sendApply" data-team_member_id="{$vo.id}">申请</button></a>
                        </div>
                        {/if}
                    </div>
                </li>
                {/volist}
                {/if}
            </ul>

            <!-- 底部操作 -->
            <ul class="mui-table-view operation mt">
                {if $leaderInfo.member_id==-1}
                <li class="mui-table-view-cell mui-col-xs-12 opli bgblue" style="height: 66px;">
                    注：领队未认领球队，待认领后,未在平台记录手机号者可向领队申请认领数据
                </li>
                {else/}
                <li class="mui-table-view-cell mui-col-xs-12 opli bgblue">
                    注：向领队发送申请，认领数据
                </li>
                {/if}
            </ul>
        </div>

    </div>

    <!-- 发送申请 -->
    <div id="sendApply" class="mui-popover mui-popover-action mui-popover-bottom actionsheet">
        <div class="list">
            <ul class="mui-table-view operation">
                <h5 class="mui-text-left" style="padding-bottom: 5px !important;">
                    <i class="mui-icon mui-icon-compose"></i>
                    <span class="type ">申请内容</span>
                    <a href="#sendApply" class="mui-icon mui-icon-closeempty"></a>
                </h5>
                <li class="listli">
                    <textarea rows="4" class="remark" placeholder="请填写能证明你身份的内容"></textarea>
                </li>
                <li class="mui-col-xs-12 opli sendApplyBtn">提交申请</li>
            </ul>
        </div>
    </div>

    <script src="/static/frontend/js/mui.min.js"></script>
    <script src="/static/frontend/js/jquery-3.2.1.min.js"></script>
    <script>
        //初始化
        mui.init({
            swipeBack: true //启用右滑关闭功能
        });

        // 认领数据操作
        $(document).on("tap", ".claim", function () {
            var team_member_id = $(this).attr("data-team_member_id");
            console.log(team_member_id)
            mui.ajax("{:url('api/claim/teamMember')}", {
                data: {
                    team_member_id: team_member_id
                },
                dataType: 'json', //服务器返回json格式数据
                type: 'post', //HTTP请求类型
                timeout: 10000, //超时时间设置为10秒；
                headers: {
                    'Content-Type': 'application/json'
                },
                success: function (data) {
                    console.log(data);
                    if (data.code == 200) {
                        mui.toast("认领成功");
                        setTimeout(function () {
                            window.location.reload();
                        }, 1500)
                    } else {
                        mui.toast(data.msg);
                        window.location.reload();
                    }
                },
                error: function (xhr, type, errorThrown) {
                    //异常处理；
                    console.log(type);
                }
            });
        });

        // 向领队发送申请认领数据
        $(document).on("tap", ".sendApplyBtn", function () {
            var member_id = "{$memberInfo.id}";
            var team_member_id = $(this).attr("data-team_member_id");
            var remarks = $(".remarks").val();
            mui.ajax("{:url('api/claim/')}", {
                data: {
                    member_id: member_id,
                    team_member_id: team_member_id
                },
                dataType: 'json', //服务器返回json格式数据
                type: 'post', //HTTP请求类型
                timeout: 10000, //超时时间设置为10秒；
                headers: {
                    'Content-Type': 'application/json'
                },
                success: function (data) {
                    console.log(data);
                    if (data.code == 200) {
                        mui.toast("已经向领队发送申请，请耐心等待回复！");
                        $(".sendApply").text("申请中").removeClass("bgblue").addClass("bggray");
                    } else {
                        mui.toast(data.msg);
                        window.location.reload();
                    }
                },
                error: function (xhr, type, errorThrown) {
                    //异常处理；
                    console.log(type);
                }
            });
        })
    </script>

</body>

</html>