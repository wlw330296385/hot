<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>快捷报名二维码</title>
    <meta name="viewport" content="width=500">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--标准mui.css-->
    <link rel="stylesheet" href="/static/frontend/css/mui.min.css">
    <!--自定义style.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/style.css" />
    <style>
        html,
        body {
            padding: 0px;
            width: 500px;
        }

        .subheader {
            height: 60px;
        }

        .subheader a {
            padding-top: 17px;
            padding-bottom: 17px;
        }

        .subheader .mui-title {
            font-size: 20px;
            line-height: 60px;
        }

        .img50 {
            width: 80px;
            height: 80px;
            margin-top: 5px;
        }

        #pageShare h4 {
            font-size: 22px;
        }

        #pageShare p {
            font-size: 18px;
            line-height: 30px
        }

        #qrcode {
            width: 200px;
            margin: 0 auto;
            margin-top: 55px;
        }

        .tip {
            text-align: center;
            margin: 30px 0;
        }

        #canvasPic {
            display: none;
        }

        #popupShare {
            width: 500px;
            visibility: hidden;
            position: absolute;
            top: 60px;
            left: 0;
            z-index: 888;
        }

        #pageShare {
            width: 500px;
            font-family: "Microsoft Yahei", Arial, sans-serif;
            position: relative;
            background: #fff;
            margin-top: 60px;
        }

        .operation .opli {
            height: 60px;
            line-height: 40px;
            font-size: 20px;
        }
    </style>
</head>

<body class="whitebg">

    <header class="mui-bar mui-bar-nav subheader">
        <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left arrow"></a>
        <h1 class="mui-title">联赛快捷报名</h1>
    </header>


    <div id="pageShare">
        <ul class="mui-table-view mb">
            <li class="mui-table-view-cell mui-media listli" style="padding:11px 15px;">
                <img class="img50 mui-pull-left" src="{$leagueInfo.logo}">
                <h4 style="line-height: 27px;">{$leagueInfo.name}</h4>
                <div class="mui-media-body lineHeight20 wd73">
                    <p class="mui-ellipsis">主办单位：{$leagueInfo.match_org.name}</p>
                    <p>{$leagueInfo.city} {$leagueInfo.area} 参赛队：<strong class="colororange">{$leagueInfo.teams_count}</strong>支
                        | 关注：
                        <strong class="colororange">{$leagueInfo.fans_num}</strong></p>
                </div>
            </li>
        </ul>

        <p class="pline"></p>

        <div id="qrcode"></div>

        <p class="saveBefore tipBefore tip">请先点击底部合成图片并分享按钮</p>
        <p class="saveAfter tipAfter tip hide">长按二维码保存或转发给朋友快捷报名联赛</p>

        <ul class="mui-table-view operation">
            <li class="mui-table-view-cell mui-col-xs-12 opli bgorange saveBefore" id="btnSave">
                合成图片并分享
            </li>
            <li class="mui-table-view-cell mui-col-xs-12 opli bggreen hide saveAfter">
                请长按图片保存或转发朋友
            </li>
        </ul>

    </div>

    <!--canvasPic:页面转画布-->
    <div id="canvasPic"></div>
    <!--pageShare:画布转图片-->
    <div id="popupShare">
        <img src="/static/frontend/images/images/blank.png" id="sharePic" />
    </div>

    <script src="/static/frontend/js/mui.min.js"></script>
    <script src="/static/frontend/js/jquery-3.2.1.min.js"></script>
    <script src="/static/frontend/js/wooApi.js"></script>
    <script src="/static/frontend/js/qrcode.js"></script>
    <script>
        //初始化
        mui.init({
            swipeBack: true //启用右滑关闭功能
        });

        window.onload = function () {
            var qrcode = new QRCode(document.getElementById("qrcode"), {
                height: 200,
                width: 200
            });
            qrcode.makeCode("https://m.hot-basketball.com/keeper/match/quickSignUp?league_id=" + "{$league_id}");
        }

        /*生成canvas图形*/

        // 获取按钮id
        var btnSave = document.getElementById("btnSave");
        // 获取内容id
        var content = $("#pageShare");
        // 进行canvas生成
        btnSave.onclick = function () {

            setTimeout(function () {

                $(".tipBefore").hide()
                $(".tipAfter").show()

                $(".img50").css("border-radius", "50% !important");
                var h = content.clientHeight;
                var w = content.clientWidth;
                html2canvas(content, {
                    scale: 2,
                    onrendered: function (canvas) {

                        //添加属性
                        canvas.setAttribute('id', 'thecanvas');
                        //读取属性值
                        document.getElementById('canvasPic').appendChild(canvas);
                        var oCanvas = document.getElementById("thecanvas");
                        var img_data2 = Canvas2Image.saveAsJPEG(oCanvas, true).getAttribute(
                            'src');
                        var element = document.getElementById('sharePic');
                        element.src = img_data2;
                        $("#pageShare").hide();
                        $(".saveBefore").hide();
                        $("#popupShare img").css("width", "500px")
                        $("#popupShare").css("visibility", "visible");
                        $(".saveAfter").show();
                    }
                });

            }, 2000)
        }
    </script>
    <!-- 将canvas图片保存成图片 -->
    <script src="/static/frontend/js/html2canvas/html2canvas.min.js"></script>
    <script src="/static/frontend/js/html2canvas/canvas2image.js"></script>
    <script src="/static/frontend/js/html2canvas/base64.js"></script>

</body>

</html>