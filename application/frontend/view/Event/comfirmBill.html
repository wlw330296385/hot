<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>活动订单支付</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--标准mui.css-->
    <link rel="stylesheet" href="/static/frontend/css/mui.min.css">
    <!--自定义style.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/style.css" />
    <style>
        .show {
            display: block;
        }
        
        .hide {
            display: none;
        }
    </style>
</head>

<body class=whitebg>

    <header id="header" class="mui-bar mui-bar-nav subheader">
        <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left arrow"></a>
        <h1 class="mui-title">确认订单</h1>
    </header>
    <div class="mui-content">

        <div class="list">
            <ul class="mui-table-view">
                <li class="mui-table-view-cell mui-media listli mb">
                    <a href="javascript:;">
                        <img class="mui-media-object mui-pull-left" src="{$eventInfo.cover}">
                        <div class="mui-media-body wd45 domData" name="event">{$eventInfo.event}<p class="mui-ellipsis domData" name="event_type">{$eventInfo.event_type}</p>
                        </div>
                        <div class="price-frame">
                            <p class="price"><span class="nofloat">已报名{$eventInfo.participator}人</span></p>
                            <input type="hidden" name="participator" value="{$eventInfo.participator}" class="data">
                            <p class="price"><span class="nofloat">剩余<font class="surplus"></font>名额</span></p>
                        </div>
                    </a>
                </li>
            </ul>
            <div class="page-header">
                <span class="course">活动信息</span>
            </div>

            <ul class="mui-table-view">
                <input type="hidden" name="__token__" class="data" value="{$Request.token}" />
                <input type="hidden" name="target_type" value="{$eventInfo.target_type}" class="target_type data">
                <input type="hidden" name="organization_id" value="{$eventInfo.organization_id}" class="data">
                <input type="hidden" name="target_id" value="{$eventInfo.target_id}" class="data">
                <input type="hidden" name="price" value="{$eventInfo.price}" class="data">
                <li class="mui-table-view-cell listli {eq name='eventInfo.organization' value='2||3'}show{else/}hide{/eq}">所属训练营<span class="domData" name="organization">{$eventInfo.organization}</span></li>
                <li class="mui-table-view-cell listli {eq name='eventInfo.organization' value='3'}show{else/}hide{/eq}">所属班级<span class="domData" name="target">{$eventInfo.target}</span></li>
                <li class="mui-table-view-cell listli">活动单价<span><b class="colororange">￥{$eventInfo.price}</b>（元）</span></li>
                <li class="mui-table-view-cell listli">活动开始时间<span class="domData" name="starts">{$eventInfo.starts}</span></li>
                <li class="mui-table-view-cell listli">活动结束时间<span class="domData" name="ends">{$eventInfo.ends}</span></li>
                <li class="mui-table-view-cell listli">活动地点<span class="domData" name="location">{$eventInfo.location}</span></li>
                <li class="mui-table-view-cell listli">所属地区<span class="domData" name="address">{$eventInfo.province} {$eventInfo.city} {$eventInfo.area}</span></li>

            </ul>
            <div class="page-header">
                <span class="course">报名信息</span>
            </div>

            <div class="mui-input-group mb44">

                <div id="oldStudent">
                    <input type="hidden" name="__token__" class="data" value="{$Request.token}" />
                    <div class="mui-input-row">
                        <label>报名人数</label>
                        <input type="text" name="participator" value="" class="participator data" placeholder="请输入报名人数">
                    </div>
                    <div class="mui-input-row">
                        <label>联系人</label>
                        <input type="text" name="contract" class="data" value="{$eventInfo.member}">
                    </div>
                    <div class="mui-input-row">
                        <label>联系电话</label>
                        <input type="text" name="telephone" class="data" value="{$memberInfo.telephone}">
                    </div>
                    <div class="mui-input-row">
                        <label>备注</label>
                        <textarea name="remarks" class="data" value="" placeholder="备注信息填写"></textarea>
                    </div>

                </div>

            </div>
            <ul class="mui-table-view operation">
                <li class="mui-table-view-cell mui-media mui-col-xs-8 opli">需要支付:<b class="colororange eventTotal">￥</b></li>
                <li class="mui-table-view-cell mui-media mui-col-xs-4 opli bggreen" onclick="wxpay()">立即支付</li>
            </ul>
        </div>
    </div>

    <script src="/static/frontend/js/mui.min.js"></script>
    <script type="text/javascript" src="/static/frontend/js/wooApi.js"></script>
    <script>
        //初始化
        mui.init({
            swipeBack: true //启用右滑关闭功能
        });

        $(function () {
            // 需要支付的费用
            $(".participator").on("blur", '', function () {
                var eventPrice = "{$eventInfo.price}";
                var participator = $(".participator").val();
                var eventTotal = eventPrice * participator;
                console.log(eventTotal)
                $(".eventTotal").text('￥' + eventTotal);
            });
            surplus();
        });

        function surplus() {
            var surplus = "{$eventInfo.max}" - "{$eventInfo.participator}";
            $(".surplus").text(surplus)
        };

        function wxpay() {
            var data = wooApi.getInputData('input', 'data');
            datas = wooApi.getInputData('select', 'data', data);
            // 获取其他标签值
            arrData = wooApi.getDomData('domData', datas);
            var objData = wooApi.arrTOobj(arrData);
            var remarks = $('textarea.data').val();
            objData.remarks = remarks;
            var url = "{:url('api/event/joinEventApi',['event_id'=>$eventInfo['id']])}";
            var ajaxResult = wooApi.asyncF(url, objData);
            // if (ajaxResult.code == 200) {
            //     mui.alert(ajaxResult.msg, '活动创建成功', '确定', function () {
            //         var goUrl = "{:url('event/eventlist')}";
            //         window.top.location.href = goUrl;
            //     })
            // } else {
            //     mui.alert(ajaxResult.msg, '活动创建失败', '确定', function () {
            //         mui.get("{:url('api/frontend/reloadtoken')}", function (data) {
            //             if (data.code === 200) {
            //                 $('input[name=__token__]').val(data.data);
            //             }
            //         }, 'json');
            //     })
            // }

            // var url = "{:url('api/event/joinEventApi',['event_id'=>$eventInfo['id']])}";
            // mui.ajax(url, {
            //     data: {
            //         member: "{$memberInfo.member}",
            //         member_id: "{$memberInfo.id}",
            //         event: "{$eventInfo.event}",
            //         event_id: "{$eventInfo.id}",
            //         participator:participator,
            //         // is_pay: 1,
            //         // is_sign: 1,
            //         status: 1,
            //     },
            //     dataType: 'json',//服务器返回json格式数据
            //     type: 'post',//HTTP请求类型
            //     timeout: 10000,//超时时间设置为10秒；
            //     headers: { 'Content-Type': 'application/json' },
            //     success: function (data) {
            //         //服务器返回响应，根据响应结果，分析是否登录成功；
            //         console.log(data);
            //         if (data.code == 200) {
            //             mui.alert('报名成功。', '提示', '确定', function () {
            //                 window.location.href = "{:url('event/eventlist')}";
            //             });
            //         } else {
            //             mui.toast(data.msg);
            //         }
            //     },
            //     error: function (xhr, type, errorThrown) {
            //         //异常处理；
            //         console.log(type);
            //     }
            // });
        }
    </script>
</body>

</html>