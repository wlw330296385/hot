<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>活动详情</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--标准mui.css-->
    <link rel="stylesheet" href="/static/frontend/css/mui.min.css">
    <!--自定义style.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/style.css" />
    <style>
        .show {
            display: block;
        }
        
        .hide {
            display: none;
        }
        
        .intro {
            padding: 0 !important;
        }
        
        .intro img {
            padding: 0px 15px;
            width: 100%;
            height: auto;
        }
        
        .operationDiv {
            position: relative;
        }
        
        .operationDiv .delbtn {
            position: absolute;
            right: 15px;
            top: 10px;
            line-height: initial !important;
            font-size: 18px !important;
        }
        
        .operationDiv h5 {
            padding: 10px 15px;
            height: 40px;
            line-height: 21px;
            color: #000;
            margin: 0;
            font-weight: bold
        }
        
        .operationDiv p {
            padding: 10px 15px;
            margin: 0;
            color: #000;
        }
        
        .nohave {
            margin: 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-top: none;
            text-align: center;
        }
    </style>
</head>

<body class=whitebg>

    <header id="header" class="mui-bar mui-bar-transparent">
        <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left arrow"></a>
    </header>
    <!--活动详情页-->
    <div class="mui-content" style="padding: 0">
        <div class="list camp-list detalis-list mt55">
            <div class="img4x3" style="background-image:url('{$eventInfo.cover}')"></div>
            <ul class="mui-table-view mb" style="margin-top: -4px">
                <li class="mui-table-view-cell mui-media listli" style="padding:11px 15px;">
                    <a href="javascript:;">
                        <div class="mui-media-body wd52">
                            <strong>{$eventInfo.event}</strong>
                            <p class="mui-ellipsis">{$eventInfo.event_type}</p>
                        </div>
                        <div class="price-frame">
                            <p class="price">￥<strong>{$eventInfo['doms'][0]['price']}</strong><span class="nofloat"> / 人</span></p>
                            <p class="price"><span class="nofloat">已报名{$eventInfo.participator}人</span></p>
                        </div>
                    </a>
                </li>
            </ul>
            <ul class="mui-table-view">
                <input type="hidden" name="target_type" value="{$eventInfo.target_type}">
                <li class="mui-table-view-cell listli"><label>活动对象</label><span class="target_type">{$eventInfo.target_type}</span></li>
                <li class="mui-table-view-cell listli">报名种类
                    <span>
                        {volist name='$eventInfo.doms' id="vol"}
                        <button type="button" class="mui-btn selectDom {if $key==0} bggreen{/if}" value="{$vol.price}" data="{$key}">{$vol.name}</button>
                        {/volist}
                    </span>
                </li>
                <li class="mui-table-view-cell listli {eq name='eventInfo.target_type' value='2||3'}show{else/}hide{/eq}">所属训练营<span>{$eventInfo.organization}</span></li>
                <li class="mui-table-view-cell listli {eq name='eventInfo.target_type' value='3'}show{else/}hide{/eq}">所属班级<span>{$eventInfo.target}</span></li>
                <li class="mui-table-view-cell listli"><label><span class="icon iconfont icon-activity-Startingtim colororange"></span>开始时间</label><span>{$eventInfo.starts}</span></li>
                <li class="mui-table-view-cell listli"><label><span class="icon iconfont icon-activity-EndTime colororange"></span>结束时间</label><span>{$eventInfo.ends}</span></li>
                <li class="mui-table-view-cell listli"><label><span class="icon iconfont icon-activity-Location colororange"></span>所属地区</label><span>{$eventInfo.province} {$eventInfo.city} {$eventInfo.area}</span></li>
                <li class="mui-table-view-cell listli"><label><span class="icon iconfont icon-activity-EventLocati colororange"></span>活动地点</label><span>{$eventInfo.location}</span></li>
                <li class="mui-table-view-cell listli"><label><span class="icon iconfont icon-activity-Quantity colororange"></span>人数范围</label><span>{$eventInfo.min}-{$eventInfo.max}人</span></li>
                <li class="mui-table-view-cell listli"><label><span class="icon iconfont icon-activity-Contact colororange"></span>联系人</label><span>{$eventInfo.contact}</span></li>
                <li class="mui-table-view-cell listli"><label><span class="icon iconfont icon-activity-phone colororange"></span>联系电话</label><span>{$eventInfo.telephone}</span></li>
                <div class="page-header" style="background: #efeff4;">
                    <span class="course">活动简介</span>
                </div>
                <li class="mui-table-view-cell listli intro">{$eventInfo.event_des}</li>
            </ul>


            <!--推荐人信息-->
            {notempty name="pmember"}
            <div class="page-header">
                <span class="course">推荐人信息</span>
            </div>
            <form action="" class="mui-input-group">
                <div class="mui-input-row h-auto">
                    <label>头像</label><img src="{$pmember['avatar']}" style="margin-right: 18px">
                </div>
                <div class="mui-input-row">
                    <label>推荐人</label><span>{$pmember.nickname}</span>
                </div>
                <div class="mui-input-row">
                    <label>电话</label><span>{$pmember.telephone}</span>
                </div>
            </form>
            {/notempty}



        </div>
        <ul class="mui-table-view operation">
            <li class="mui-table-view-cell mui-media mui-col-xs-2 opli"><a href="/frontend/"><span
                    class="mui-icon icon iconfont icon-nav-Home"></span></a></li>
        {switch name="variable"} {case value='1'}
        <!--报名状态-->
            <li class="mui-table-view-cell mui-media mui-col-xs-3 opli"><a href="tel:{$eventInfo.telephone}"><span
                    class="mui-icon mui-icon-phone"></span> 咨询</a></li>
            <li class="mui-table-view-cell mui-media mui-col-xs-4 opli ">剩余
                <font class="surplus colororange"></font>名额</li>
            {if empty($EventMemberList)}
            <li class="mui-table-view-cell mui-media mui-col-xs-3 opli bggreen signupbtn">报名</li>
            {else /}
            <li class="mui-table-view-cell mui-media mui-col-xs-3 opli ">已报名</li>    
            {/if}
        {/case} {case value='3'}
        <!--报名人数已满-->
            <li class="mui-table-view-cell mui-media mui-col-xs-10 opli bggray">报名人数已满</li>
        {/case} {case value='2'}
        <!--已下架-->
            <li class="mui-table-view-cell mui-media mui-col-xs-10 opli bggray">已下架</li>
        {/case} {case value='4'}
        <!--已过期-->
            <li class="mui-table-view-cell mui-media mui-col-xs-10 opli bggray">已过期</li>
        {/case} {/switch}
        </ul>
    </div>



    <script src="/static/frontend/js/mui.min.js"></script>
    <script type="text/javascript" src="/static/frontend/js/wooApi.js"></script>
    <script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
    <script>
        //初始化
        mui.init({
            swipeBack: true //启用右滑关闭功能
        });

        mui(".mui-content").on("tap", "a", function () {
            window.top.location.href = this.href;
        });
        var domIndex = 0;

        $(function () {
            // 活动对象转换成文字显示
            // 默认的样式
            initialEds();


            // 选择套餐
            $('.selectDom').on('click',function(){
                $('.selectDom').removeClass('bggreen');
                $(this).addClass('bggreen');
                $('.price-frame strong').text($(this).val());
            })

            var surplus = "{$eventInfo.max}" - "{$eventInfo.participator}";
            $(".surplus").text(surplus)

            //报名活动
            $('.signupbtn').on('tap', '', function () {

                var mID = "{$memberInfo.id}";
                if (mID <= 0) {
                    var btnArray = ['取消', "<a href='{$fasturl}' style='color:#007aff'>前往完善</a>"];
                    mui.confirm('请完善您的信息，以便进行后续操作，谢谢！', '提示', ['取消', '前往完善'], function (e) {
                        if (e.index === 1) {
                            window.location.href = "{$fasturl}";
                        }
                    });
                } else {
                    var btnArray = ['确定', '取消'];
                    var addForm = '<div class="mui-popup-input"><input type="number" name="participator" class="data" placeholder="请输入报名人数" autofocus=""></div>'
                    mui.confirm(addForm, '报名人数', btnArray, function (e) {
                        if (e.index == 0) {
                            // 获取套餐
                            domIndex = $('.selectDom.bggreen').attr('data');
                            var eventTotal = $("input[name=participator]").val();
                            if (!(/^[0-9]*$/).test(eventTotal) || eventTotal == '') {
                                mui.toast("请输入正确数字");
                                return false;
                            }
                            var isfree = "{$eventInfo.is_free}";
                            if (isfree == 1) {
                                buyUrl = "{:url('event/bookBill',['event_id'=>$eventInfo['id']])}";
                            } else {
                                buyUrl = "{:url('event/comfirmBill',['event_id'=>$eventInfo['id']])}";
                            }
                            window.location.href = buyUrl + '?total=' + eventTotal+'&domIndex='+domIndex;
                        }
                    });
                }
            });

        });

  
        // 默认的样式
        function initialEds() {
            if ($(".intro").text() == '') {
                $(".intro").append("<p class='nohave'>还没有活动简介哦</p>")
            }
        }
    </script>
    <script>
        wx.config({
            //debug: true,
            appId: "{$jsapi['appId']}",
            timestamp: "{$jsapi['timestamp']}",
            nonceStr: "{$jsapi['nonceStr']}",
            signature: "{$jsapi['signature']}",
            jsApiList: [
                // 所有要调用的 API 都要加到这个列表中
                'checkJsApi',
                'onMenuShareTimeline',
                'onMenuShareAppMessage',
                'onMenuShareQQ'
            ]
        });
        wx.ready(function () {
           
            // 分享到朋友圈
            wx.onMenuShareTimeline({
                title: "{$eventInfo.event}",
                link: "{$shareurl}/pid/{$mid}", 
                imgUrl: "{:request()->root(true)}{$eventInfo.cover}", 
                success: function () {
                   
                },
                cancel: function () {
                    
                }
            });

            // 分享给朋友
            wx.onMenuShareAppMessage({
                title: '{$eventInfo.event}', 
                desc: '{$eventInfo.organization}', 
                link: "{$shareurl}/pid/{$mid}", 
                imgUrl: "{:request()->root(true)}{$eventInfo.cover}",
                type: "",
                dataUrl: '',
                success: function () {
                    
                },
                cancel: function () {
                   
                }
            });

        });
    </script>
</body>

</html>