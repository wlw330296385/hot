{__CONTENT__}


<!--底部导航-->
<nav class="mui-bar mui-bar-tab">
	{volist name="footMenu" id="vol"}
    <a class="mui-tab-item {eq name='controller' value='$vol.controller' } mui-active{/eq}" href="{:url($vol.controller.'/'.$vol.action)}">
        <span class="mui-icon {$vol.icon}" id="{$vol.controller}" data="{$vol.controller}">
        
        </span>
        <span class="mui-tab-label">{$vol.name}</span>
    </a>
    {/volist}
</nav>


<script src="/static/frontend/js/wooApi.js"></script>
<script type="text/javascript">
	mui("body").on("tap","a",function(){
	    window.top.location.href=this.href;
	});
    var unReadMessage = sessionStorage.getItem('unReadMessage_frontend_'+{$memberInfo.id});
    if({$memberInfo.id}>0){

        if(!unReadMessage || unReadMessage===undefined || unReadMessage===null){
            unReadMessage = getUnreadMessage("{:url('api/message/getMessageMmeberCountApi')}",{status:1, steward_type:1},'unReadMessage_frontend_'+{$memberInfo.id});           
        }
        if(unReadMessage>0){
            tips(unReadMessage);
        }
    }


    $('#Message').on('tap',function(){
        getUnreadMessage("{:url('api/message/getMessageMmeberCountApi')}",{status:1, steward_type:1},'unReadMessage_frontend_'+{$memberInfo.id});
    });



    // 获取消息小红点
    function getUnreadMessage(url,data,name){
        $.ajax({
            url: url,
            data: data,
            async: true,
            type: 'post',
            dataType:'json',
            complete: function(msg) {
                
                if(msg.responseJSON.code == 200){
                    sessionStorage.setItem(name,msg.responseJSON.data);
                    if(msg.responseJSON.data>0){
                        tips(msg.responseJSON.data)
                    }else{
                        tips(0);
                    }
                }else{
                    
                    sessionStorage.setItem(name,0);
                } 
            }
        })
        
    }



    function tips(unReadMessage){
        if(unReadMessage>0){
            var html = `<span class="mui-badge">${unReadMessage}</span>`;
        }else{
            var html = ``;
        }
        
        $('#Message').html(html);
    } 





    setInterval(function(){
        if({$memberInfo.id}>0){
            getUnreadMessage("{:url('api/message/getMessageMmeberCountApi')}",{status:1, steward_type:1},'unReadMessage_frontend_'+{$memberInfo.id});
        }
    }, 5000); 


</script>