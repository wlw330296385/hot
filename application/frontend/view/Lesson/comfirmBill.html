<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>课程订单支付</title>
  <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <!--标准mui.css-->
  <link rel="stylesheet" href="/static/frontend/css/mui.min.css">
  <!--icon扩展样式icons-extra.css-->
  <link rel="stylesheet" type="text/css" href="/static/frontend/css/icons-extra.css"/>
  <!--App自定义的css-->
  <link rel="stylesheet" type="text/css" href="/static/frontend/css/app.css"/>
  <!--自定义style.css-->
  <link rel="stylesheet" type="text/css" href="/static/frontend/css/style.css"/>
</head>

<body class=whitebg>

  <header id="header" class="mui-bar mui-bar-nav subheader">
    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left arrow"></a>
    <h1 class="mui-title">确认订单</h1>
  </header>
  <div class="mui-content">

    <!--课程订单支付-->
    <div class="mui-content">
      <div class="list">
        <ul class="mui-table-view">
          <li class="mui-table-view-cell mui-media listli mb">
            <a href="javascript:;">
              <img class="mui-media-object mui-pull-left" src="/static/frontend/images/shuijiao.jpg">
              <div class="mui-media-body wd45">
                {$lessonInfo.lesson}
                <p class="mui-ellipsis">{$lessonInfo.gradecate}</p>
              </div>
              <div class="price-frame singup-num">
                {$lessonInfo.students}人已报名
              </div>
            </a>
          </li>
        </ul>

        <ul class="mui-table-view">
          <li class="mui-table-view-cell listli">
            <a class="mui-navigate-right">
              所属训练营<span class="wd66">{$lessonInfo.camp}</span>
            </a>
          </li>
          <li class="mui-table-view-cell listli">课程单价<span><b class="colororange">￥{$lessonInfo.cost}</b>（元）</span></li>
          <li class="mui-table-view-cell listli">所选课量<span><b class="colororange total"></b>（节）</span></li>
          <li class="mui-table-view-cell listli">训练时间<span>{$lessonInfo.week} {$lessonInfo.lesson_time}</span></li>
          <li class="mui-table-view-cell listli">训练地点<span>{$lessonInfo.location}</span></li>
          <li class="mui-table-view-cell listli">所属地区<span>{$lessonInfo.province} {$lessonInfo.city} {$lessonInfo.area}</span></li>
          <li class="mui-table-view-cell listli"><span>课程总价<b class="colororange total_fee"></b></span></li>
        </ul>


        <div class="page-header">
          <span class="course"><strong>个人信息</strong></span>
        </div>

        <!-- 老会员进入 -->
        <ul class="mui-table-view list detalis-list mt55">
         <li class="mui-table-view-cell listli">
           学员姓名
           <span class="select-arrow location-choise">
            <select class="select" style="width: 22%">
              <option value="习大大">习大大</option>
              <option value="习小">习小</option>
              <option value="习小大">习小大</option>
            </select>
          </span>
        </li>
        <li class="mui-table-view-cell listli">家长姓名<span>习大地</span></li>
        <li class="mui-table-view-cell listli">手机号码<span class="width">1355657464</span></li>
        <li class="mui-table-view-cell listli">留言<span>留言内容</span></li>
      </ul>

      
      <!-- 新会员进入 -->
      <form class="mui-input-group mt55" style="display: none;">

        <div class="mui-input-row">
          <label>学员姓名</label>
          <input type="text" value="学员姓名" style="color: #737373">
        </div>

        <div class="mui-input-row">
          <label>家长姓名</label>
          <input type="text" value="家长姓名" style="color: #737373">
        </div>

        <div class="mui-input-row">
          <label>手机号码</label>
          <input id="telephone" type="text" name="mobile" class="reg_mobile" placeholder="请输入手机号码" id="telephone">
        </div>
        <div class="mui-input-row">
          <label>短信验证码</label>
          <input type="button" class="code-btn" value="获取验证码" onclick="sendCode(this)" >
          <input id="code" type="text" class="input reg_code" placeholder="输入验证码" style="width: 40%;" >
        </div>

        <div class="mui-input-row">
          <label>留言</label>
          <textarea rows="4" placeholder="请输入留言"></textarea>
        </div>

      </form>


      <ul class="mui-table-view operation">
        <li class="mui-table-view-cell mui-media mui-col-xs-8 opli" >还需支付:<b class="colororange total_fee">￥</b></li>
        <li class="mui-table-view-cell mui-media mui-col-xs-4 opli bggreen" onclick="wxpay()">立即支付</li>
      </ul>

    </div>
  </div>
</div>
</body>
<script src="/static/frontend/js/mui.min.js"></script>
<script type="text/javascript" src="/static/frontend/js/wooApi.js"></script>
<script>
    //初始化
    mui.init({
        swipeBack: true //启用右滑关闭功能
    });

    var total = sessionStorage.lessonTotal;
    var total_fee = "{$lessonInfo.cost}"*total;
    $(function(){
      $('.total').html(total);
      $('.total_fee').html("￥"+total_fee);
    })


    function wxpay(){

      console.log(total_fee);
      var bill_order = "{$billOrder}";
      if (typeof WeixinJSBridge == "undefined"){
       if( document.addEventListener ){
         document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
       }else if (document.attachEvent){
         document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
         document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
       }
     }else{
      var result = wooApi.asyncF("{:url('api/wxpay/getParametersApi')}",{'order_no':bill_order,'amount':total_fee});
      console.log(result);
      if(result.code == 100){
        onBridgeReady(result.data.data.jsApiParameters);
      }else{
        mui.toast(result.data.msg)
      } 


    }
  }

  function onBridgeReady(jsApiParameters){
    var objJsApiParameters = JSON.parse(jsApiParameters);
    console.log(objJsApiParameters);
    WeixinJSBridge.invoke(
     'getBrandWCPayRequest', {
               "appId":objJsApiParameters.appId,     //公众号名称，由商户传入     
               "timeStamp":"{:time()}",         //时间戳，自1970年以来的秒数     
               "nonceStr":objJsApiParameters.nonceStr, //随机串     
               "package":objJsApiParameters.package,     
               "signType":"MD5",         //微信签名方式：     
               "paySign":objJsApiParameters.paySign, //微信签名
               'payType':objJsApiParameters.payType
             },
             function(res){     
               if(res.err_msg == "get_brand_wcpay_request:ok" ) {}     // 使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。 
             }
           ); 
  }

</script>
</html>