<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>课程详情</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--标准mui.css-->
    <link rel="stylesheet" href="/static/frontend/css/mui.min.css">
    <!--自定义style.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/style.css"/>
</head>

<body class=whitebg>

<header id="header" class="mui-bar mui-bar-nav subheader subheader-other">
    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left arrow"></a>
</header>
<!--课程详情页-->
<div class="mui-content" style="padding: 0">
    <div class="list camp-list">
        <div class="img4x3" style="background-image:url('{$lessonInfo.cover}')"></div>
        <ul class="mui-table-view mb" style="margin-top: -4px">
            <li class="mui-table-view-cell mui-media listli" style="padding:11px 15px;">
                <a href="javascript:;">
                    <div class="mui-media-body wd52">
                        <strong>{$lessonInfo.lesson}</strong>
                        <p class="mui-ellipsis">{$lessonInfo.gradecate}</p>
                    </div>
                    <div class="price-frame">
                        <p class="price">￥{$lessonInfo.cost}<span class="nofloat"> / 课时</span></p>
                    </div>
                </a>
            </li>
        </ul>

        <ul class="mui-table-view mt55">
            <li class="mui-table-view-cell listli">选择课量
                <span>
                        {volist name="lessonInfo['doms']" id="vol" }
                        <button type="button" class="mui-btn selectTotal" data="{$vol}">{$vol}节</button>
                        {/volist}
                    </span>
            </li>
            <li class="mui-table-view-cell listli">
                <a class="mui-navigate-right">
                    所属训练营<span class="wd66" id="aaa">{$lessonInfo.camp}</span>
                </a>
            </li>
            <li class="mui-table-view-cell listli">训练时间<span>{$lessonInfo.week} {$lessonInfo.lesson_time |} </span></li>
            <li class="mui-table-view-cell listli">训练地点<span>{$lessonInfo.court}</span></li>
            <li class="mui-table-view-cell listli">所属地区<span>{$lessonInfo.province} {$lessonInfo.city} {$lessonInfo.area}</span>
            </li>
            <li class="mui-table-view-cell listli">具体地址<span>{$lessonInfo.location}</span></li>
            <li class="mui-table-view-cell listli">人数范围<span>{$lessonInfo.min}-{$lessonInfo.max}人</span></li>
            <li class="mui-table-view-cell listli">主教练<span>{$lessonInfo.coach}</span></li>
            <li class="mui-table-view-cell listli">备注<span>{$lessonInfo.remarks}</span></li>
        </ul>

        <ul class="mui-table-view operation">
            <li class="mui-table-view-cell mui-media mui-col-xs-4 opli"><a href="tel:{$lessonInfo.telephone}"><span
                    class="mui-icon mui-icon-phone"></span>电话咨询</a></li>
            <li class="mui-table-view-cell mui-media mui-col-xs-4 opli bgblue" id="bookLesson">预约体验</li>
            <li class="mui-table-view-cell mui-media mui-col-xs-4 opli bggreen" id="buyLesson">购买课程</a></li>
        </ul>

    </div>
</div>
<input type="hidden" name="{$shareurl}">
</body>
<script src="/static/frontend/js/mui.min.js"></script>
<script src="/static/frontend/js/jquery-3.2.1.min.js"></script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script src="/static/frontend/js/wooApi.js"></script>
<script>
    //初始化
    mui.init({
        swipeBack: true //启用右滑关闭功能
    });

    mui("body").on("tap", "a", function () {
        window.top.location.href = this.href;
    });

    mui.get("{:url('api/member/checkopenid')}", {}, function(data) {
        console.log(data);
    }, 'json');

    var buyUrl = "{:url('lesson/comfirmBill',['lesson_id'=>$lessonInfo['id']])}";
    var bookUrl = "{:url('lesson/bookBill',['lesson_id'=>$lessonInfo['id']])}";

    // 预约课程和购买课程
    $(function () {
//        sessionStorage.lessonTotal = 0;
//        $('.selectTotal').on('click', function () {
//            $('.selectTotal').removeClass('mui-btn-warning');
//            var data = wooApi.selectLessonTotal2($(this));
//            // 存储课时
//            sessionStorage.lessonTotal = data;
//            console.log(sessionStorage.lessonTotal);
//        })

        //选择课量
        $('.selectTotal').on('tap','', function () {
            $('.selectTotal').removeClass('mui-btn-warning');
            $(this).addClass('mui-btn-warning');
        })

        //预约体验
        $('#bookLesson').on('tap','', function () {
            if ("{$isPower}" > 1) {
                mui.alert('不允许购买自身训练营下的课程');
                return false;
            }
            if ("{$memberInfo.id}" <= 0) {
                var btnArray = ['取消', "<a href='{$fasturl}' style='color:#007aff'>前往完善</a>"];
                mui.confirm('请先完善您的基本信息，以便进行后续操作，谢谢！', '提示', btnArray);
            } else {
                // sessionStorage.lessonTotal = 1;
                // window.location.href = bookUrl;
                window.location.href = bookUrl + '?total=1';
            }
        })

        //购买课程
        $('#buyLesson').on('tap','', function () {
            if ("{$isPower}" > 1) {
                mui.alert('不允许购买自身训练营下的课程');
                return false;
            }
            if ("{$memberInfo.id}" <= 0) {
                var btnArray = ['取消', "<a href='{$fasturl}' style='color:#007aff'>前往完善</a>"];
                mui.confirm('请先完善您的基本信息，以便进行后续操作，谢谢！', '提示', btnArray);
            } else {
               // var lessonTotal = sessionStorage.lessonTotal;
                var lessonTotal = $('.mui-btn-warning').attr("data");
                if (lessonTotal == 0||lessonTotal == null||lessonTotal == '') {
                    alert('请先选择课量');
                    return false;

                } else {
                    // window.location.href = buyUrl;
                    window.location.href = buyUrl + '?total=' + lessonTotal;
                //alert(lessonTotal);

                }
            }
        })

    })


//    function book() {
//        if ("{$isPower}" > 1) {
//            mui.alert('不允许购买自身训练营下的课程');
//            return false;
//        }
//        if ("{$memberInfo.id}" <= 0) {
//            var btnArray = ['取消', "<a href='{$fasturl}' style='color:#007aff'>前往完善</a>"];
//            mui.confirm('请先完善您的基本信息，以便进行后续操作，谢谢！', '提示', btnArray);
//        } else {
////            sessionStorage.lessonTotal = 1;
//            // window.location.href = bookUrl;
//            window.location.href = bookUrl + '?total=1';
//        }
//
//    }
//
//    function buy() {
//        if ("{$isPower}" > 1) {
//            mui.alert('不允许购买自身训练营下的课程');
//            return false;
//        }
//        if ("{$memberInfo.id}" <= 0) {
//            var btnArray = ['取消', "<a href='{$fasturl}' style='color:#007aff'>前往完善</a>"];
//            mui.confirm('请先完善您的基本信息，以便进行后续操作，谢谢！', '提示', btnArray);
//        } else {
////            var lessonTotal = sessionStorage.lessonTotal;
//            if (selectLessonCount == 0) {
//                alert('请先选择课量');
//                return false;
//
//            } else {
//                // window.location.href = buyUrl;
//                window.location.href = buyUrl + '?total=' + selectLessonCount;
////                alert(lessonTotal);
//
//            }
//        }
//
//    }
</script>

<script>
    wx.config({
        //debug: true,
        appId: "{$jsapi['appId']}",
        timestamp: "{$jsapi['timestamp']}",
        nonceStr: "{$jsapi['nonceStr']}",
        signature: "{$jsapi['signature']}",
        jsApiList: [
            // 所有要调用的 API 都要加到这个列表中
            'checkJsApi',
            'onMenuShareTimeline',
            'onMenuShareAppMessage',
            'onMenuShareQQ'
        ]
    });
    wx.ready(function () {
        // 在这里调用 API
        /*document.querySelector('#checkJsApi').onclick = function () {
         wx.checkJsApi({
         jsApiList: [
         'onMenuShareTimeline',
         'onMenuShareAppMessage',
         'onMenuShareQQ'
         ],
         success: function (res) {
         alert(JSON.stringify(res));
         }
         });
         };*/

        // 分享到朋友圈
        wx.onMenuShareTimeline({
            title: "{$lessonInfo.lesson}", // 分享标题
            link: "{$shareurl}", // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
            imgUrl: "{$lessonInfo.cover}", // 分享图标
            success: function () {
                // 用户确认分享后执行的回调函数
                alert('已分享');
            },
            cancel: function () {
                // 用户取消分享后执行的回调函数
            }
        });

        // 分享给朋友
        wx.onMenuShareAppMessage({
            title: '{$lessonInfo.lesson}', // 分享标题
            desc: '{$lessonInfo.camp}', // 分享描述
            link: "{$shareurl}", // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
            imgUrl: "{$lessonInfo.cover}", // 分享图标
            type: "", // 分享类型,music、video或link，不填默认为link
            dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
            success: function () {
                // 用户确认分享后执行的回调函数
            },
            cancel: function () {
                // 用户取消分享后执行的回调函数
            }
        });

    });
</script>
</html>