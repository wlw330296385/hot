<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>购买课时详情</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--标准mui.css-->
    <link rel="stylesheet" href="/static/frontend/css/mui.min.css">
    <!--自定义style.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/style.css" />
    <!--选择器样式-->
    <link href="/static/frontend/css/mui.picker.min.css" rel="stylesheet" />
    <link href="/static/frontend/css/mui.poppicker.css" rel="stylesheet" />
    <link rel="stylesheet" href="/static/frontend/css/webuploader.css">
    <style>
        .mui-input-row a.mui-navigate-right {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .mui-popover-arrow {
            left: auto;
            right: 6px;
        }
        
        .mui-popover {
            height: 300px;
        }
        
        .mui-toast-container {
            top: 250px
        }
        
        .number {
            width: 20% !important;
        }
        
        .box {
            max-height: 300px;
            overflow: scroll;
            border-bottom: 1px solid #ddd;
        }
        
        .editor .image-items .mui-input-group .mui-input-row {
            height: initial;
        }
        
        #newdiv .tips {
            color: #AAAAAA;
            line-height: normal;
        }
        
        .page-header {
            background: #efeff4;
        }
        
        .explain-cont {
            padding: 15px;
        }
        
        .explain-cont p {
            margin-bottom: 2px;
        }
         .checkboxCont font {
            font-size: 14px;
        }
        .subheader{
            border: none;
        }
    </style>
</head>

<body class="whitebg">

    <header id="header" class="mui-bar mui-bar-nav subheader">
        <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left arrow"><span class="return">返回</span></a>
        <h1 class="mui-title">{$campInfo.camp}</h1>
    </header>

    <div class="mui-content">

        <form class="mui-input-group">

            <div class="mui-input-row">
                <label>课程名称</label>
                <span>{$giftbuyInfo.lesson}</span>
            </div>

            <div class="mui-input-row">
                <label>课时单价</label>
                <span>{$giftbuyInfo.cost}元</span>
            </div>

            <div class="mui-input-row">
                <label>本次购买赠课数量</label>
                <span>{$giftbuyInfo.quantity}</span>
            </div>

            <div class="mui-input-row">
                <label>购买时间</label>
                <span>{$giftbuyInfo.create_time}</span>
            </div>
            <div class="mui-input-row">
                <label>该课程剩余未赠送数量</label>
                <span>{$lessonInfo.resi_giftschedule}</span>
            </div>
        </form>
        <br>
        <ul class="mui-table-view" style="text-align: center">
            <li class="mui-table-view-cell mui-btn bggreen" onclick="submitAction()" data-id="{$giftbuyInfo.id}">
                退掉{$lessonInfo.resi_giftschedule}节赠课
            </li>
        </ul>
    </div>

    <script src="/static/frontend/js/mui.min.js"></script>
    <script src="/static/frontend/js/jquery-3.2.1.min.js"></script>
    <script>
        //初始化
        mui.init({
            swipeBack: true //启用右滑关闭功能
        });

        function submitAction(){
            mui.confirm('此操作将推掉该课程下的所有未赠送的{$lessonInfo.resi_giftschedule}节赠课数量,是否确定退掉赠课?',function(index){
                if(index.index ==1){
                    mui.ajax({
                        url: "{:url('api/schedule/refundGift')}",
                        data: {
                            lesson_id:{$giftbuyInfo.lesson_id}
                        },
                        async:false,
                        dataType: 'json',//服务器返回json格式数据
                        type: 'post',//HTTP请求类型
                        timeout: 10000,//超时时间设置为10秒；
                        headers: { 'Content-Type': 'application/json' },
                        //processData:false,
                        success: function (data) {
                            if (data.code == 200) {
                               mui.alert(data.msg,'退掉赠课成功',function(){
                                    location.reload();
                               });
                            } else {
                                mui.toast(data.msg);
                            }
                        },
                        error: function (xhr, type, errerThrown) {
                            mui.toast('网络异常,请稍候再试');
                        }
                    });
                }
            });
        }

    </script>
</body>

</html>