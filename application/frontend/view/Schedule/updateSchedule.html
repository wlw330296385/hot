<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>课时编辑</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--标准mui.css-->
    <link rel="stylesheet" href="/static/frontend/css/mui.min.css">
    <!--自定义style.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/style.css" />
    <!--选择器样式-->
    <link href="/static/frontend/css/mui.picker.min.css" rel="stylesheet" />
    <link href="/static/frontend/css/mui.poppicker.css" rel="stylesheet" />
    <link rel="stylesheet" href="/static/frontend/css/webuploader.css">
    <style>
        .mui-input-row a.mui-navigate-right {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .mui-popover-arrow {
            left: auto;
            right: 6px;
        }
        
        .mui-popover {
            height: 300px;
        }
        
        .mui-toast-container {
            top: 250px
        }
        
        .number {
            width: 20% !important;
        }
        
        .box {
            max-height: 300px;
            overflow: scroll;
            border-bottom: 1px solid #ddd;
        }
        
        .editor .image-items .mui-input-group .mui-input-row {
            height: initial;
        }
        
        .pdr {
            padding-right: 30px !important;
        }
        
        #newdiv .tips {
            color: #AAAAAA;
            line-height: normal;
        }
        
        .nohave {
            margin: 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-top: none;
            text-align: center;
        }
    </style>
</head>

<body>

    <header id="header" class="mui-bar mui-bar-nav subheader">
        <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left arrow"><span class="return">返回</span></a>
        <h1 class="mui-title">{$scheduleInfo.camp}</h1>
    </header>

    <div class="mui-content">

        <div class="camp-list camp-lesson-list detalis-list grade-list editor mt">

            <ul class="mui-table-view list mb">
                <li class="mui-table-view-cell mui-media listli">
                    <a href="javascript:;" class="mui-navigate-right">
                        <div class="mui-media-body wd83">
                            <strong class="grade">{$scheduleInfo.grade}</strong>
                            <p class="mui-ellipsis camp" style="text-indent: 0" data-id="{$scheduleInfo.camp_id}">{$scheduleInfo.camp} | {$scheduleInfo.lesson}</p>
                            <input type="hidden" name="camp" value="{$scheduleInfo.camp}">
                            <input type="hidden" name="grade_id" value="{$scheduleInfo.id}">
                            <input type="hidden" name="lesson" value="{$scheduleInfo.lesson}">
                            <input type="hidden" name="lesson_id" value="{$scheduleInfo.lesson_id}">
                        </div>
                    </a>
                </li>
            </ul>

            <div class="page-header">
                <span class="course">参训学员</span>
            </div>

            <div class="image-items">

                <form class="mui-input-group">
                    <div class="mui-input-row h-auto">
                        <a class="portraits filePicker" onclick="add_id(3)">
                            <label>上传合照</label>
                            <img id="preview_3" src="{$scheduleInfo.cover}">
                            <input type="hidden" class="cover" name="portraits" value="">
                        </a>
                    </div>
                </form>

                <form class="mui-input-group">
                    <div class="mui-input-row">
                        <label>正式学员</label>
                    </div>
                    <div class="box checkChecked" id="inactiveList">
                        {foreach name="studentList" item="vol"}
                        <div class="mui-input-row mui-checkbox checkboxCont"><label class="number">{$key+1}</label>
                            <font>{$vol.student}</font><input name="student" class="stdList" data-id="{$vol.id}" data-student_id="{$vol.student_id}"
                                value="{$vol.student}" data-student="{$vol.student}" data-type="{$vol.type}" type="checkbox"></div>
                        {/foreach}
                    </div>
                    <div class="mui-input-row">
                        <label>体验生</label>
                    </div>
                    <div class="expbox checkChecked" id="expinactiveList">
                        {foreach name="expstudentList" item="vol"}
                        <div class="mui-input-row mui-checkbox checkboxCont"><label class="number">{$key+1}</label>
                            <font>{$vol.student}</font><input name="student" class="stdList" data-id="{$vol.id}" data-student_id="{$vol.student_id}"
                                value="{$vol.student}" data-student="{$vol.student}" data-type="{$vol.type}" type="checkbox"></div>
                        {/foreach}
                    </div>

                    <div class="operation-btn">
                        <span class="mui-badge">{$scheduleInfo.students}</span>
                        <a class="all">全选</a>
                        <a class="cancel">取消</a>
                        <a class="del">[删除]</a>
                        <a href="#addStudent" id="setStudentCBox" class="mui-icon mui-icon-personadd add"></a>
                    </div>
                </form>

            </div>

            <form class="mui-input-group mt55">

                <div class="mui-input-row picker btn" id="demo3" data-options='{"beginYear":2010,"endYear":2020}'>
                    <a href="#" class="mui-navigate-right">
                        <label>训练时间</label>
                        <span id="result" class="ui-alert lesson_time pdct">{$scheduleInfo.lesson_time|date="Y-m-d H:i",###}</span>
                    </a>
                </div>

                <div class="mui-input-row">
                    <a href="#trainLocation" class="mui-navigate-right">
                        <label>训练地点</label>
                        <span class="trainLocationCont">{$scheduleInfo.court}</span>
                        <input type="hidden" name="court_id" value="{$scheduleInfo.court_id}" class="court_id">
                        <input type="hidden" name="location" value="" class="location">
                    </a>
                </div>

                <div class="mui-input-row fzcity" id='showCityPicker3'>
                    <a href="#" class="mui-navigate-right">
                        <label>所属地区</label>
                        <span id="cityResult3" class="ui-alert">{$scheduleInfo.province} {$scheduleInfo.city} {$scheduleInfo.area}</span>
                        <input type="hidden" name="province" value="{$scheduleInfo.province}">
                        <input type="hidden" name="city" value="{$scheduleInfo.city}">
                        <input type="hidden" name="area" value="{$scheduleInfo.area}">
                    </a>
                </div>

                <div class="mui-input-row">
                    <a href="#mainCoach" class="mui-navigate-right">
                        <label>主教练</label>
                        <input type="text" value="{$scheduleInfo.coach}" class="mainCoachCont pdr">
                        <input type="hidden" name="coach_id" value="{$scheduleInfo.coach_id}" class="data coach_id">
                    </a>
                </div>

                <div class="mui-input-row">
                    <label>主教底薪</label>
                    <span class="coach_salary pdr">{$scheduleInfo.coach_salary}</span>
                </div>

                <div class="mui-input-row">
                    <a href="#assistantCoach" id="setAsCoach" class="mui-navigate-right">
                        <label>助理教练</label>
                        <input type="text" name="assistants" value="{$scheduleInfo.assistants}" class="assistantCoachCont pdr" placeholder="（选填）">
                        <input type="hidden" name="assistant_ids" value='{$scheduleInfo.assistant_ids}' class="assistant_ids">
                    </a>
                </div>

                <div class="mui-input-row">
                    <label>助教底薪</label>
                    <span class="assistant_salary pdr">{$scheduleInfo.assistant_salary}</span>
                </div>

                <div class="mui-input-row">
                    <a href="#leader" class="mui-navigate-right">
                        <label>领队</label>
                        <input type="text" value="{$scheduleInfo.leader}" class="leaderCont pdr" placeholder="（选填）">
                        <input type="hidden" name="leader_id" value="{$scheduleInfo.leader_id}" class="leader_id">
                    </a>
                </div>

                <div class="mui-input-row">
                    <a href="#headMaster" class="mui-navigate-right">
                        <label>班主任</label>
                        <input type="text" value="{$scheduleInfo.teacher}" class="headMasterCont pdr" placeholder="（选填）">
                        <input type="hidden" name="teacher_id" value="{$scheduleInfo.teacher_id}" class="teacher_id">
                    </a>
                </div>

                <div class="mui-input-row">
                    <label>备注</label>
                    <input type="text" class="remarks pdr" value="{$scheduleInfo.remarks}" placeholder="（选填）">
                </div>

            </form>

            <ul class="mui-table-view operation">
                <li class="mui-table-view-cell mui-media mui-col-xs-12 opli bggreen operationBtn" style="color: #fff">
                    提交修改
                </li>
            </ul>

        </div>


        <!--训练地点-->
        <div id="trainLocation" class="mui-popover">
            <div class="mui-popover-arrow"></div>
            <div class="page-header">
                <span class="course"><strong>训练地点</strong></span>
            </div>
            <div class="mui-scroll-wrapper">
                <div class="mui-scroll">
                    <ul class="mui-table-view list courtlist">
                    </ul>
                </div>
            </div>
        </div>

        <!--主教练-->
        <div id="mainCoach" class="mui-popover">
            <div class="mui-popover-arrow"></div>
            <div class="page-header">
                <span class="course"><strong>教练列表</strong></span>
            </div>
            <div class="mui-scroll-wrapper">
                <div class="mui-scroll">
                    <ul class="mui-table-view list mainCoach coach">
                    </ul>
                </div>
            </div>
        </div>

        <!--助理教练-->
        <div id="assistantCoach" class="mui-popover">
            <div class="mui-popover-arrow"></div>
            <div class="page-header">
                <span class="course wd36"><strong>教练列表</strong></span>
                <span class="fr"><button class="mui-btn-blue" id="assistantConfirm">确认</button></span>
            </div>
            <div class="mui-scroll-wrapper">
                <div class="mui-scroll">
                    <form class="mui-input-group coachAS">
                    </form>
                </div>
            </div>
        </div>

        <!--班主任-->
        <div id="headMaster" class="mui-popover" style="margin: 0">
            <div class="mui-popover-arrow"></div>
            <div class="page-header">
                <span class="course wd36"><strong>选择班主任</strong></span>
            </div>
            <div class="camp-lesson-list">
                <div class="mui-segmented-control">
                    <a class="mui-control-item mui-active" href="#item1">粉丝列表</a>
                    <a class="mui-control-item" href="#item2">教练列表</a>
                </div>
            </div>
            <div id="item1" class="mui-control-content mui-active">
                <div class="pop-search">
                    <input type="search" class="keywordHM" placeholder="请输入粉丝名称搜索">
                    <span class="mui-icon mui-icon-search searchicon" id="searchHM"></span>
                </div>
                <div class="mui-scroll-wrapper" style="top:40px !important;">
                    <div class="mui-scroll">
                        <ul class="mui-table-view list headMaster fans">
                        </ul>
                        <ul class="mui-pager">
                            <li><a href="#" class="prev_page">上一页</a></li>
                            <li><span class="currPage">0</span>/<span class="totalPage">0</span></li>
                            <li><a href="#" class="next_page">下一页</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div id="item2" class="mui-control-content">
                <div class="mui-scroll-wrapper">
                    <div class="mui-scroll">
                        <ul class="mui-table-view list headMaster coach">
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!--领队-->
        <div id="leader" class="mui-popover" style="margin: 0">
            <div class="mui-popover-arrow"></div>
            <div class="page-header">
                <span class="course wd36"><strong>选择领队</strong></span>
            </div>
            <div class="camp-lesson-list">
                <div class="mui-segmented-control">
                    <a class="mui-control-item mui-active" href="#item11">粉丝列表</a>
                    <a class="mui-control-item" href="#item22">教练列表</a>
                </div>
            </div>
            <div id="item11" class="mui-control-content mui-active">
                <div class="pop-search">
                    <input type="search" class="keywordLD" placeholder="请输入粉丝名称搜索">
                    <span class="mui-icon mui-icon-search searchicon" id="searchLD"></span>
                </div>
                <div class="mui-scroll-wrapper" style="top:40px !important;">
                    <div class="mui-scroll">
                        <ul class="mui-table-view list leader fans">
                        </ul>
                        <ul class="mui-pager">
                            <li><a href="#" class="prev_page">上一页</a></li>
                            <li><span class="currPage">0</span>/<span class="totalPage">0</span></li>
                            <li><a href="#" class="next_page">下一页</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div id="item22" class="mui-control-content">
                <div class="mui-scroll-wrapper">
                    <div class="mui-scroll">
                        <ul class="mui-table-view list leader coach">
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!--学员名单-->
        <div id="addStudent" class="mui-popover">
            <div class="mui-popover-arrow"></div>
            <div class="page-header">
                <span class="course wd36"><strong>学员名单</strong></span>
                <span class="fr"><button class="mui-btn-blue" id="studentConfirm">确认</button></span>
            </div>
            <div class="mui-scroll-wrapper">
                <div class="mui-scroll">
                    <form id="newdiv" class="mui-input-group addStudentList">

                    </form>
                </div>
            </div>
        </div>

        <script src="/static/frontend/js/mui.min.js"></script>
        <script src="/static/frontend/js/jquery-3.2.1.min.js"></script>
        <!-- 选择器 -->
        <script src="/static/frontend/js/mui.picker.min.js"></script>
        <script src="/static/frontend/js/mui.poppicker.js"></script>
        <script src="/static/frontend/js/city.data-3.js"></script>
        <script>
            var uploadApiUrl = "{:url('api/upload/imgwupload', ['usage' => 'cert'])}";
        </script>
        <script src="/static/frontend/libs/webuploader.cert.js?v=<?php echo time();?>"></script>
        <script src="/static/frontend/js/uploadcert.js?v=<?php echo time();?>"></script>
        <script>
            //初始化
            mui.init({
                swipeBack: true //启用右滑关闭功能
            });

            //弹出菜单
            mui('.mui-scroll-wrapper').scroll();

            //弹出框滚动必须写在mui专用的初始化
            (function ($) {
                $(".mui-scroll-wrapper").scroll({
                    //bounce: false,//滚动条是否有弹力默认是true
                    indicators: true //是否显示滚动条,默认是true
                });
                // 关闭弹出菜单
                $("body").on('tap', '.mui-backdrop', function () {
                    mui(".mui-popover.mui-active").popover("toggle");
                })
            })(mui);

            //选择器
            var getProvince = '';
            var getCity = '';
            var getArea = '';
            (function ($, doc) {
                $.ready(function () {
                    var _getParam = function (obj, param) {
                        return obj[param] || '';
                    };

                    // var picker = new mui.PopPicker();
                    // picker.setData([{value:'zz',text:'智子'}]);
                    // showCityPickerButton('tap', function (event) {
                    //     picker.show(function (selectItems) {
                    //         console.log(selectItems[0].text);//智子
                    //         console.log(selectItems[0].value);//zz 
                    //     })
                    // })

                    //选择地区
                    var cityPicker3 = new $.PopPicker({
                        layer: 3
                    });

                    // 设置默认值
                    cityPicker3.pickers[0].setSelectedIndex(18);
                    cityPicker3.pickers[1].setSelectedIndex(2);
                    cityPicker3.pickers[2].setSelectedIndex(2);


                    cityPicker3.setData(cityData3);
                    var showCityPickerButton = doc.getElementById('showCityPicker3');
                    var cityResult3 = doc.getElementById('cityResult3');
                    showCityPickerButton.addEventListener('tap', function (event) {

                        // var pickers0 = "{$scheduleInfo.province}";
                        // console.log(cityData3)
                        // console.log(cityData3.length)
                        // for(var i=0; i<cityData3.length; i++){ 
                        //     if(cityData3[i] == 18) {
                        //         cityPicker3.pickers[0].setSelectedIndex(18);
                        //     }
                        // } 
                        cityPicker3.show(function (items) {
                            cityResult3.innerText = _getParam(items[0], 'text') + " " + _getParam(items[1], 'text') + " " + _getParam(items[2], 'text');
                            //返回 false 可以阻止选择框的关闭
                            //return false;
                            getProvince = _getParam(items[0], 'text');
                            getCity = _getParam(items[1], 'text');
                            getArea = _getParam(items[2], 'text');
                        });
                    }, false);

                    //选择时间
                    var result = $('#result')[0];
                    var btns = $('.btn');
                    btns.each(function (i, btn) {
                        btn.addEventListener('tap', function () {
                            var optionsJson = this.getAttribute('data-options') || '{}';
                            var options = JSON.parse(optionsJson);
                            var id = this.getAttribute('id');
                            var picker = new $.DtPicker(options);
                            picker.show(function (rs) {
                                result.innerText = rs.text;
                                picker.dispose();

                            });
                        }, false);
                    });
                });
            })(mui, document);

            //更新学员序号
            function changeIndex() {
                var i = 1;
                $(".checkboxCont").each(function () { //循环checkboxCont
                    $(this).find("label").text(i++);//更新序号
                });
            }

            $(function () {

                //全选
                $(".all").click(function () {
                    $(".checkboxCont").find('input').prop('checked', true)
                })

                //取消全选
                $(".cancel").click(function () {
                    $(".checkboxCont").find('input').prop('checked', false)
                })

                //删除
                $(".del").click(function () {
                    $("input[name='student']:checked").parents(".checkboxCont").remove();
                    delStudent();
                    changeIndex();
                    checkStudent();
                });

                // 训练地点
                $(".courtlist").on('click', 'li.trainLocation', function () {
                    var trainLocation = $(this).html();
                    var id = $(this).attr('data-id');
                    $(".court_id").val(id);
                    var location = $(this).attr('data-location');
                    $(".location").val(location);
                    $(".trainLocationCont").text(trainLocation);
                    mui("#trainLocation").popover("toggle");
                })

                // 判断所选助教是否存在
                $(".coachAS").on('click', '.mui-checkbox', function () {
                    var mainID = $(".coach_id").val();
                    var asID = $(this).find("input[name='checkbox-assistant']").attr('data-id');
                    var asName = $(this).find("input[name='checkbox-assistant']").val();
                    if (asID == mainID) {
                        mui.alert(asName + "已是主教练，请不要重复选择！");
                        $(this).find("input[name='checkbox-assistant']").prop("checked", false);
                        return;
                    }
                })

                // 主教练
                $(".mainCoach").on('click', 'li', function () {
                    var mainCoach = $(this).text();
                    var id = $(this).attr('data-id');
                    var asID = '';
                    var isStop = 'No';
                    /// 判断所选主教是否存在助教栏
                    /// 给助教复选框赋值确保有效判断
                    toAssistantCheckbox();
                    $("#assistantCoach input[name='checkbox-assistant']:checked").each(function () {
                        asID = $(this).attr('data-id');
                        console.log(asID)
                        console.log(id)
                        if (asID == id) {
                            mui.alert(mainCoach + "已是助教，请不要重复选择！");
                            $(this).find("input[name='checkbox-assistant']").prop("checked", false);
                            isStop = 'Yes';
                            return false;
                        }
                    });
                    if (isStop == 'No') {
                        $(".mainCoachCont").val(mainCoach);
                        $(".coach_id").val(id);
                        mui("#mainCoach").popover("toggle");
                    }
                })

                // 助理教练
                $("#assistantConfirm").click(function () {
                    // 取id值的集合
                    $("input[name='assistant_ids']").val($("input[name='checkbox-assistant']:checked").map(function () {
                        return $(this).attr('data-id');
                    }).get().join(","));
                    $(".assistantCoachCont").val($("input[name='checkbox-assistant']:checked").map(function () {
                        return $(this).val();
                    }).get().join(","));
                    mui('#assistantCoach').popover('toggle');
                })

                // 班主任
                $(".headMaster").on('click', 'li', function () {
                    var headMaster = $(this).text();
                    $(".headMasterCont").val(headMaster);
                    var id = $(this).attr('data-id');
                    $(".teacher_id").val(id);
                    mui("#headMaster").popover("toggle");
                })
                // 领队
                $(".leader").on('click', 'li', function () {
                    var leader = $(this).text();
                    $(".leaderCont").val(leader);
                    var id = $(this).attr('data-id');
                    $(".leader_id").val(id);
                    mui("#leader").popover("toggle");
                })

                //学员列表复选框赋值
                $("#setStudentCBox").on('tap', '', function () {
                    //每次打开先清空所有选择
                    $("input[name='checkbox-student']").prop("checked", false);
                    //然后遍历出对应所选
                    $(".stdList").each(function (i) {
                        var id = $(this).attr("data-id");
                        var student_id = $(this).attr("data-student_id");
                        var student = $(this).attr("data-student");
                        $("#newdiv").find("input[name='checkbox-student']").filter(function (index) {
                            return $(this).attr("data-student_id") == student_id
                        }).prop("checked", true);
                    });
                });

                //复选框赋值
                $("#setAsCoach").on('tap', '', function () {
                    //每次打开先清空所有选择
                    $("input[name='checkbox-assistant']").prop("checked", false);
                    //然后遍历出对应所选
                    var str = $("input[name='assistant_ids']").val();
                    var s = str.split(',')
                    console.log(s.length)
                    for (var i = 0; i < s.length; i++) {
                        $("input[name='checkbox-assistant']").filter(function (index) {
                            return $(this).attr("data-id") == s[i]
                        }).prop("checked", true);
                    }
                });

                //角标随checkboxCont的数量变化
                $(document).on('click', '.del', function () {
                    totalNum = $(".checkboxCont").length;
                    $(".mui-badge").text(totalNum);
                });


                // 选择添加学员点击事件
                $("#studentConfirm").on('click', function () {

                    $("#inactiveList").empty();
                    $("#expinactiveList").empty();
                    studentList = [];//学员列表数组
                    expstudentList = [];//体验生列表数组

                    $(".addStudentList input[type=checkbox]:checked").each(function () {
                        var str = '<div class="mui-input-row mui-checkbox checkboxCont"><label class="number"></label><font>' + $(this).val() + '</font><input name="student" value="' + $(this).attr("data-student_id") + '" type="checkbox"><input type="hidden" class="stdList eachList" data-id="' + $(this).attr("data-id") + '" data-student="' + $(this).attr("data-student") + '" data-student_id="' + $(this).attr("data-student_id") + '" data-type="' + $(this).attr("data-type") + '" ></div>';
                        var student_type = $(this).attr("data-type");
                        var id = $(this).attr("data-id");
                        var student_id = $(this).attr("data-student_id");
                        var student = $(this).attr("data-student");
                        if (student_type == "正式生") {
                            $("#inactiveList").append(str);
                            studentList.push({ student: student, student_id: student_id, id: id, type: student_type });
                        } else {
                            $("#expinactiveList").append(str);
                            expstudentList.push({ student: student, student_id: student_id, id: id, type: student_type });
                        }
                    });

                    checkStudent();// 检查是否有学员数据

                    changeIndex();//调用-更新序号
                    mui("#addStudent").popover("toggle");
                    totalNum = $(".checkboxCont").length;
                    $(".mui-badge").text(totalNum);
                });


                //获取已经分配班级的学员列表
                toExpStudentList();
                //获取学员列表
                toScheduleList();
                //获取训练营场地表
                toCourtList()
                //获取训练营教练列表
                toCoachList();
                //获取训练营教练列表
                var fansKeyword = '';
                var wFans = '';
                var pageHM = 1;
                var pageLD = 1;
                toFansList(fansKeyword, wFans, 1);

                //搜索班主任粉丝
                $("#searchHM").on("click", function () {
                    var keyword = $(".keywordHM").val();
                    var pageHM = 1;
                    toFansList(keyword, "headMaster", pageHM);
                })
                //搜索领队粉丝
                $("#searchLD").on("click", function () {
                    var keyword = $(".keywordLD").val();
                    var pageLD = 1;
                    toFansList(keyword, "leader", pageLD);
                })
                //领队粉丝弹出框页码控制
                $("#leader").on('click', '.next_page', function () {
                    var getTotalPage = $("#leader .totalPage").text();
                    pageLD++;
                    if (pageLD > getTotalPage) {
                        mui.toast("已经最后一页了");
                    } else {
                        var keyword = $(".keywordLD").val();
                        toFansList(keyword, "leader", pageLD);
                    }
                })
                $("#leader").on('click', '.prev_page', function () {
                    pageLD--;
                    if (pageLD < 1) {
                        mui.toast("已经是第一页了");
                    } else {
                        var keyword = $(".keywordLD").val();
                        toFansList(keyword, "leader", pageLD);
                    }
                })
                //班主任粉丝弹出框页码控制
                $("#headMaster").on('click', '.next_page', function () {
                    var getTotalPage = $("#headMaster .totalPage").text();
                    pageHM++;
                    if (pageHM > getTotalPage) {
                        mui.toast("已经最后一页了");
                    } else {
                        var keyword = $(".keywordHM").val();
                        toFansList(keyword, "headMaster", pageHM);
                    }
                })
                $("#headMaster").on('click', '.prev_page', function () {
                    pageHM--;
                    if (pageHM < 1) {
                        mui.toast("已经是第一页了");
                    } else {
                        var keyword = $(".keywordHM").val();
                        toFansList(keyword, "headMaster", pageHM);
                    }
                })

                //录课
                $(".operationBtn").click(function () {
                    var province = getProvince || $('input[name=province]').val();
                    var city = getCity || $('input[name=city]').val();
                    var area = getArea || $('input[name=area]').val();
                    var cover = $(".cover").val() || $(".cover").attr("src");
                    var students = totalNum;
                    var camp = $("input[name=camp]").val();
                    var campid = $('.camp').attr('data-id');
                    var grade = $(".grade").text();
                    var grade_id = $("input[name=grade_id]").val();
                    var lesson = $("input[name=lesson]").val();
                    var lesson_id = $("input[name=lesson_id]").val();
                    var court = $(".trainLocationCont").text();
                    var court_id = $("input[name=court_id]").val();
                    var lesson_time = $(".lesson_time").text();
                    var coach = $(".mainCoachCont").val();
                    var coach_id = $("input[name=coach_id]").val();
                    var assistants = $(".assistantCoachCont").val();
                    var assistant_ids = $("input[name='assistant_ids']").val();
                    var leader = $(".leaderCont").val();
                    var leader_id = $("input[name='leader_id']").val();
                    var teacher = $(".headMasterCont").val();
                    var teacher_id = $("input[name='teacher_id']").val();
                    var remarks = $(".remarks").val();
                    var coach_salary = $(".coach_salary").val();
                    var assistant_salary = $(".assistant_salary").text();
                    var grade_category_id = $('input[name=grade_category_id]').val();
                    var grade_category = $('input[name=grade_category]').val();

                    if ($('.checkChecked input[name=student]').is(':checked')) {
                        mui.alert('请勿勾选学员名单');
                        return;
                    }

                    mui.ajax("{:url('api/schedule/updateScheduleApi')}" + '/grade_id/{$scheduleInfo.grade_id}/schedule_id/{$scheduleInfo.id}', {
                        data: {
                            'cover': cover,
                            'province': province,
                            'city': city,
                            'area': area,
                            'grade': grade,
                            'grade_id': grade_id,
                            'camp': camp,
                            'camp_id': campid,
                            'lesson': lesson,
                            'lesson_id': lesson_id,
                            'lesson_time': lesson_time,
                            'court': court,
                            'court_id': court_id,
                            'coach': coach,
                            'coach_id': coach_id,
                            'assistants': assistants,
                            'assistant_ids': assistant_ids,
                            'leader': leader,
                            'leader_id': leader_id,
                            'teacher': teacher,
                            'teacher_id': teacher_id,
                            'coach_salary': coach_salary,
                            'assistant_salary': assistant_salary,
                            'remarks': remarks,
                            'grade_category_id': grade_category_id,
                            'grade_category': grade_category,
                            'students': students,
                            'studentList': studentList,
                            'expstudentList': expstudentList
                        },
                        dataType: 'json',//服务器返回json格式数据
                        type: 'post',//HTTP请求类型
                        timeout: 10000,//超时时间设置为10秒；
                        headers: { 'Content-Type': 'application/json' },
                        success: function (data) {
                            //服务器返回响应，根据响应结果，分析是否登录成功；
                            console.log(data);
                            if (data.code == 200) {
                                mui.alert('修改成功  ', '提示', '确定', function () {
                                    setTimeout(window.location.href = "{:url('schedule/schedulelist',['camp_id'=>$scheduleInfo.camp_id])}", 3000)
                                });
                            } else {
                                mui.toast(data.msg);
                            }
                        },
                        error: function (xhr, type, errorThrown) {
                            //异常处理；
                            console.log(type);
                        }
                    });
                });
            });

            //初始值
            var delStudent = function () {
                studentList = [];
                expstudentList = [];
                $(".checkChecked input[type=checkbox]").each(function () {
                    var student_type = $(this).attr("data-type");
                    var id = $(this).attr("data-id");
                    var student_id = $(this).attr("data-student_id");
                    var student = $(this).attr("data-student");
                    if (student_type == 1) {
                        studentList.push({ student: student, student_id: student_id, id: id, type: student_type });
                    } else {
                        expstudentList.push({ student: student, student_id: student_id, id: id, type: student_type });
                    }
                    console.log(studentList)
                    console.log(expstudentList)
                });
            }


            // 检查是否有学员数据
            var checkStudent = function () {
                if ($("#inactiveList").html() == '' && $("#expinactiveList").html() == '') {
                    $(".checkChecked").append('<p class="nohave">没有学员哦</p>');
                } else if ($("#inactiveList").html() == '') {
                    $("#inactiveList").append('<p class="nohave">没有正式学员哦</p>');
                } else if ($("#expinactiveList").html() == '') {
                    $("#expinactiveList").append('<p class="nohave">没有体验生哦</p>');
                };
            };

            //根据默助教遍历出对应所选
            var toAssistantCheckbox = function () {
                var str = $("input[name='assistant_ids']").val();
                var s = str.split(',')
                for (var i = 0; i < s.length; i++) {
                    $("input[name='checkbox-assistant']").filter(function (index) {
                        return $(this).attr("data-id") == s[i]
                    }).prop("checked", true);
                };
            };

            //获取已经分配班级的学员列表
            var studentList = '';//正式学员全局变量
            var expstudentList = '';//体验生全局变量
            var toExpStudentList = function () {
                
                studentList = [];
                expstudentList = [];
         
                $("input[name=student]").each(function () {
                    var student_type = $(this).attr("data-type");
                    var id = $(this).attr("data-id");
                    var student_id = $(this).attr("data-student_id");
                    var student = $(this).attr("data-student");
                    if (student_type == "正式生") {
                        studentList.push({ student: student, student_id: student_id, id: id, type: student_type });
                    } else {
                        expstudentList.push({ student: student, student_id: student_id, id: id, type: student_type });
                    }
                });

                checkStudent();// 检查是否有学员数据

                // console.log(studentList);
                // console.log(expstudentList);
                changeIndex();//调用-更新序号
                totalNum = $(".checkboxCont").length;
            };


            //获取学员列表
            var toScheduleList = function () {
                var lesson_id = "{$scheduleInfo.lesson_id}";
                mui.ajax("{:url('api/lesson_member/getLessonMemberListNoPageApi')}", {
                    data: {
                        'lesson_id': lesson_id,
                    },
                    dataType: 'json',//服务器返回json格式数据
                    type: 'post',//HTTP请求类型
                    timeout: 10000,//超时时间设置为10秒；
                    headers: { 'Content-Type': 'application/json' },
                    success: function (data) {
                        //服务器返回响应，根据响应结果，分析是否登录成功；
                        console.log(data)
                        var div = '';
                        var tys = '';
                        if (data.code == 200) {
                            for (var i = 0; i <= data.data.length - 1; i++) {
                                tys = '';
                                if (data.data[i].type == 2) { tys = '<span class="tips">[ 体验生 ]</span>' }
                                div = div + '<div class="mui-input-row mui-checkbox mui-left"><label>' + data.data[i].student + tys + '</label><input name="checkbox-student" class="student" value="' + data.data[i].student + '" type="checkbox" data-id="' + data.data[i].id + '" data-student_id="' + data.data[i].student_id + '" data-student="' + data.data[i].student + '" data-type="' + data.data[i].type + '"></div>'
                            }
                            $("#newdiv").empty();
                            $("#newdiv").append(div);
                        }
                    },
                    error: function (xhr, type, errorThrown) {
                        //异常处理；
                        console.log(type);
                    }
                });
            };

            //训练营场地列表接口获取数据并追加到页面
            var toCourtList = function () {
                var url = "{:url('api/court/getCourtListNoPageApi','','',true)}";
                var campID = "{$scheduleInfo.camp_id}";
                mui.ajax({
                    url: url,
                    data: {
                        camp_id: campID
                    },
                    dataType: 'json',//服务器返回json格式数据
                    type: 'post',//HTTP请求类型
                    timeout: 10000,//超时时间设置为10秒；
                    headers: { 'Content-Type': 'application/json' },
                    //processData:false,
                    success: function (data) {
                        if (data.code == 200) {
                            var newli = '';
                            for (var i = 0; i <= data.data.length - 1; i++) {
                                newli = newli + '<li class="mui-table-view-cell listli detalisli trainLocation" data-id="' + data.data[i].court_id + '" data-location="' + data.data[i].location + '">' + data.data[i].court + '</li>'
                            }
                            $("ul.courtlist").empty();
                            if (newli == '') {
                                var createCount = "{:url('/frontend/court/createcourt/camp_id/')}" + campID;
                                newli = '<li class="mui-text-center"><p>没有查找到场地数据哦</p><a href="' + createCount + '" class="mui-btn mui-btn-primary">添加场地</a></li>'  ///// 添加场地按钮///////////////////////////////////////////////
                            }
                            $("ul.courtlist").append(newli);

                        } else {
                            mui.toast('数据获取失败,请稍候再试');
                        }
                    },
                    error: function (xhr, type, errerThrown) {
                        mui.toast('网络异常,请稍候再试');
                    }
                });
            };


            //教练列表接口获取数据并追加到页面
            var toCoachList = function () {
                var url = "{:url('api/camp_member/getCoachListApi','','',true)}";
                var campID = "{$scheduleInfo.camp_id}";
                mui.ajax({
                    url: url,
                    data: {
                        camp_id: campID,
                        type: 2
                    },
                    dataType: 'json',//服务器返回json格式数据
                    type: 'post',//HTTP请求类型
                    timeout: 10000,//超时时间设置为10秒；
                    headers: { 'Content-Type': 'application/json' },
                    //processData:false,
                    success: function (data) {
                        if (data.code == 200) {
                            var newli = ''; //主教练单选
                            var newliAS = ''; //助理教练多选
                            for (var i = 0; i <= data.data.length - 1; i++) {
                                newli = newli + '<li class="mui-table-view-cell listli detalisli" data-id="' + data.data[i].id + '">' + data.data[i].coach + '</li>'
                                newliAS = newliAS + '<div class="mui-input-row mui-checkbox mui-left"><label class="label" data-id="' + data.data[i].id + '">' + data.data[i].coach + '</label><input name="checkbox-assistant" data-id="' + data.data[i].id + '" value="' + data.data[i].coach + '" type="checkbox"></div>'
                            }
                            $("ul.coach").empty();
                            $(".coachAS").empty();
                            if (newli == '') {
                                newli = '<li class="nodata"><i class="icon iconfont icon-hothome-trainingpoi"></i><p>没有查找到数据哦</p></li>';
                                newliAS = newli
                            }
                            $("ul.coach").append(newli);
                            $(".coachAS").append(newliAS);

                        } else {
                            mui.toast('数据获取失败,请稍候再试');
                        }
                    },
                    error: function (xhr, type, errerThrown) {
                        mui.toast('网络异常,请稍候再试');
                    }
                });
            };


            //粉丝列表接口获取数据并追加到页面
            var toFansList = function (keyword, wFans, page) {
                var url = "{:url('api/camp_member/getCampMemberListByPageApi','','',true)}";
                var campID = "{$scheduleInfo.camp_id}";
                var typeID = "-1";
                var wFansList = "ul.fans";
                var currPage = ".currPage";
                var totalPage = ".totalPage";
                if (keyword != '' && wFans != '') {
                    wFansList = "#" + wFans + " ul.fans";
                    currPage = "#" + wFans + " .currPage";
                    totalPage = "#" + wFans + " .totalPage";
                }
                mui.ajax({
                    url: url,
                    data: {
                        camp_id: campID,
                        type: typeID,
                        page: page,
                        keyword: keyword
                    },
                    dataType: 'json',//服务器返回json格式数据
                    type: 'post',//HTTP请求类型
                    timeout: 10000,//超时时间设置为10秒；
                    headers: { 'Content-Type': 'application/json' },
                    //processData:false,
                    success: function (data) {
                        if (data.code == 200) {
                            var newli = '';
                            for (var i = 0; i <= data.data.data.length - 1; i++) {
                                newli = newli + '<li class="mui-table-view-cell listli detalisli" data-id="' + data.data.data[i].member_id + '">' + data.data.data[i].member + '</li>'
                            }
                            $(wFansList).empty();
                            if (newli == '') {
                                newli = '<li class="nodata"><i class="icon iconfont icon-hothome-trainingpoi"></i><p>没有查找到数据哦</p></li>'
                            }
                            $(wFansList).append(newli);
                            $(currPage).text(data.data.current_page);
                            $(totalPage).text(data.data.last_page);
                        } else {
                            mui.toast('数据获取失败,请稍候再试');
                        }
                    },
                    error: function (xhr, type, errerThrown) {
                        mui.toast('网络异常,请稍候再试');
                    }
                });
            };

    //获取教案列表
    // var toPlanList = function() {
    //     mui.ajax("{:url('api/plan/planListNoPageApi')}", {
    //         data: {},
    //         dataType: 'json',//服务器返回json格式数据
    //         type: 'post',//HTTP请求类型
    //         timeout: 10000,//超时时间设置为10秒；
    //         headers: {'Content-Type': 'application/json'},
    //         success: function (data) {
    //         //服务器返回响应，根据响应结果，分析是否登录成功；
    //         console.log(data)
    //         var plandiv = '';
    //         if (data.code == 200) {
    //             for (var i = 0; i <= data.data.length - 1; i++) {
    //                 plandiv = plandiv + '<li class="mui-table-view-cell listli detalisli plan">'+dada.data[i].plan+'/li>'
    //             }
    //             $(".addStudentList").append(plandiv);
    //         }
    //     },
    //     error: function (xhr, type, errorThrown) {
    //             //异常处理；
    //             console.log(type);
    //         }
    //     });
    // };
        </script>
</body>

</html>