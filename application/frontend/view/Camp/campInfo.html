<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>训练营详情</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--标准mui.css-->
    <link rel="stylesheet" href="/static/frontend/css/mui.min.css">
    <!--icon扩展样式icons-extra.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/icons-extra.css"/>
    <!--App自定义的css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/app.css"/>
    <!--自定义style.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/style.css"/>
    <!--等级星星样式-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/feedback.css"/>
    <style>
     .mui-popover {
        height: 300px;
    }
</style>
</head>

<body>

    <div class="mui-content">

        <div class="mui-content">
            <div class="list camp-list detalis-list coach">
                <div class="img4x3" style="background-image:url('{$campInfo.banner}')"></div>
                <ul class="mui-table-view mb" style="margin-top: -4px">
                    <li class="mui-table-view-cell mui-media listli de " style="padding:11px 15px;">
                        <a href="javascript:;">
                            <img class="mui-media-object mui-pull-left" src="{$campInfo.logo}">
                            <div class="mui-media-body">
                                {$campInfo.camp}
                                <p class="mui-ellipsis">{$campInfo.province} {$campInfo.city} {$campInfo.area}</p>
                            </div>
                            <div class="price-frame camp-num">
                                <ul>
                                    <li>
                                        <div class="icons mui-inline">{$campInfo.star}
                                            <i data-index="1" class="mui-icon mui-icon-star-filled"></i>
                                            <i data-index="2" class="mui-icon mui-icon-star-filled"></i>
                                            <i data-index="3" class="mui-icon mui-icon-star-filled"></i>
                                        </div>
                                    </li>
                                    <li class="fr">{$campInfo.total_member}人报名</li>
                                </ul>
                            </div>
                        </a>
                    </li>
                </ul>

                <ul class="mui-table-view mb">
                    <li class="mui-table-view-cell listli detalisli">训练营介绍
                        <span class="about">{$campInfo.camp_introduction}
                            <a href="javascript:void(0)">......全文展示</a>
                        </span>
                    </li>
                </ul>

                <ul class="mui-table-view">
                    <li class="mui-table-view-cell listli detalisli" style="line-height: 40px;">
                        <a class="mui-navigate-right" id="coachlist"
                        href="{:url('coach/coachListOfCamp',['camp_id'=>$campInfo['id']])}/?campname={$campInfo.camp}">
                        
                        </a>
                    </li>
                <li class="mui-table-view-cell listli detalisli">课量<span>已上{$campInfo.total_schedule}课时</span></li>
                <li class="mui-table-view-cell listli detalisli">班级<span>全部{$campInfo.total_grade}个班级</span></li>
                <li class="mui-table-view-cell listli detalisli">
                    <a class="mui-navigate-right">
                        训练点<span>全部{$campInfo.camp_base}个训练点</span>
                    </a>
                </li>
            </ul>
            <div class="page-header">
                <span class="course">热门课程</span>
                <span class="more">全部{$lessonCount}个课程</span>
            </div>
            <ul class="mui-table-view course-list">
                {volist name="lessonList" id="vol" limit='5'}
                <li class="mui-table-view-cell mui-media listli">
                    <a href="{:url('lesson/lessonInfo',['lesson_id'=>$vol['id']])}">
                        <img class="mui-media-object mui-pull-left" src="{$vol.cover}">
                        <div class="mui-media-body">
                            {$vol.lesson}
                            <p class="mui-ellipsis">{$vol.gradecate}</p>
                        </div>
                        <div class="price-frame">
                            <p class="price">￥{$vol.cost}</p>
                            <p class="address">{$vol.province} {$vol.city} {$vol.area}</p>
                        </div>
                    </a>
                </li>
                {/volist}
            </ul>
            <p class="dropdown"><a href="{:url('lesson/lessonList',['camp_id'=>$campInfo['id']])}">更多课程...</a></p>

            <div class="page-header">
                <span class="course" style="font-size: 14px">评论</span>
                <span class="more">全部0个评论</span>
            </div>
            <ul class="mui-table-view list mui-text-center min-height">
                {volist name='commentList' id="vol" empty="暂无评论"}
                <li class="mui-table-view-cell mui-media listli">
                    <a href="javascript:;">
                        <img class="mui-media-object mui-pull-left coachicon" src="{$vol.avatar}">
                        <div class="mui-media-body">
                            {$vol.member}
                            <p class="mui-ellipsis">{$vol.comment}</p>
                        </div>
                        <div class="price-frame">
                            <p>{$vol.create_time}</p>
                        </div>
                    </a>
                </li>
                {/volist}
            </ul>
            <p class="dropdown mt55"><a href="#">查看16条评论...</a></p>

            <ul class="mui-table-view operation mt">
                <li class="mui-table-view-cell mui-media mui-col-xs-4 opli">
                    <a href="tel:18507717466">
                        <span class="mui-icon mui-icon-phone"></span>电话咨询
                    </a>
                </li>
                {neq name="isPower" value='0'}
                <li class="mui-table-view-cell mui-media mui-col-xs-4 opli">
                    <a href="#pjpopover">我来评价</a>
                </li>
                {/neq}
                <li class="mui-table-view-cell mui-media mui-col-xs-4 opli">
                    <a href="#join">申请加入</a>
                </li>
            </ul>
        </div>

    </div>

    <!-- 申请加入选择身份弹出框 -->
    <div id="join" class="mui-popover">
        <div class="mui-popover-arrow"></div>
        <div class="mui-scroll-wrapper">
            <div class="mui-scroll">
                <div class="camp-list camp-lesson-list detalis-list list">
                    <div class="page-header">
                        <span class="course"><strong>请选择身份</strong></span>
                    </div>
                    <ul class="mui-table-view ">
                        <li class="mui-table-view-cell listli detalisli choiseType">学生<input type="text" name="" value="1" style="display: none"></li>
                        <li class="mui-table-view-cell listli detalisli choiseType">教练<input type="text" name="" value="2" style="display: none"></li>
                        <li class="mui-table-view-cell listli detalisli choiseType">管理员<input type="text" name="" value="3" style="display: none"></li>
                        <li class="mui-table-view-cell listli detalisli choiseType">粉丝<input type="text" name="" value="-1" style="display: none"></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- 申请加入弹框 -->
    <div id="yqpopover" class="mui-popover mui-popover-action mui-popover-bottom actionsheet">
        <div class="list camp-list camp-lesson-list detalis-list grade-list coach">
            <ul class="mui-table-view operation">
                <h5><span class="type"></span><a href="#yqpopover" class="mui-icon mui-icon-closeempty"></a></h5>
                <li class="mui-table-view-cell listli">
                    <textarea rows="4" class="remarks"></textarea>
                </li>
                <li class="mui-table-view-cell mui-media mui-col-xs-12 opli joinBtn">提交</li>
            </ul>
        </div>
    </div>
    <!-- 评价弹框 -->
    <div id="pjpopover" class="mui-popover mui-popover-action mui-popover-bottom actionsheet">
        <div class="list camp-list camp-lesson-list detalis-list grade-list coach">
            <ul class="mui-table-view operation">
                <h5><span>评价我的训练营</span><a href="#pjpopover" class="mui-icon mui-icon-closeempty"></a></h5>
                <li class="mui-table-view-cell listli">
                    <textarea rows="4" name="comment" class="data"></textarea>
                    <input type="hidden" name="camp_id" value="{$campInfo['id']}" class="data" >
                    <input type="hidden" name="camp" value="{$campInfo['camp']}" class="data" >

                </li>
                <li class="mui-table-view-cell mui-media mui-col-xs-12 opli" id="commentSubmit">提交</li>
            </ul>
        </div>
    </div>

    <script src="/static/frontend/js/mui.min.js"></script>
    <script src="/static/frontend/js/jquery-3.2.1.min.js"></script>
    <script src="/static/frontend/js/wooApi.js"></script>
    <script>
    //初始化
    mui.init({
        swipeBack: true //启用右滑关闭功能
    });

    //弹出菜单
    mui('.mui-scroll-wrapper').scroll();

    $(function () {

        //展示训练营介绍全文
        $(".about a").click( function() {
            $(".about").css("display","block");
            $(this).hide();
        });
        
        //选择身份申请加入
        var type = '';
        $(".choiseType").click(function() {
            if ( "{$memberInfo.id}"<=0) {
                var btnArray = ['取消', "<a href='{$fasturl}' style='color:#007aff'>前往完善</a>"];
                mui.confirm('请先完善您的基本信息，以便进行后续操作，谢谢！', '提示', btnArray);
            }else{
                //弹出申请加入菜单
                type = $(this).find("input").val();
                var choiseType = $(this).text();
                $("#yqpopover").addClass("mui-active").css("display","block");
                $(".type").text("申请加入"+choiseType);
                mui('#yqpopover').popover('toggle');
            }
        })

        //评价功能
        $("#commentSubmit").on('click',function() {
            //判断是否登陆会员
            var data1 = wooApi.getInputData();
            var data2 = wooApi.getInputData('textarea','data',data1);
            var objData = wooApi.arrTOobj(data2);
            var result = wooApi.asyncF("{:url('api/camp/createCampCommentApi')}",objData);
            if(result){
                mui.toast(result.msg);
                mui('#pjpopover').popover('toggle');
            }
        })

        //训练营的身份api
        $(".joinBtn").click(function () {
            var remarks = $(".remarks").val();
            if(remarks !=0){
                mui.ajax("{:url('api/CampMember/applyApi')}", {
                    data: {
                        'type': type,
                        'camp_id': "{$campInfo.id}",
                        'remarks': remarks,
                    },
                    dataType: 'json',//服务器返回json格式数据
                    type: 'post',//HTTP请求类型
                    timeout: 10000,//超时时间设置为10秒；
                    headers: {'Content-Type': 'application/json'},
                    success: function (data) {
                        //服务器返回响应，根据响应结果，分析是否登录成功；
                        console.log(data)
                        if (data.code == 100) {
                            mui.toast("提交成功,待审核");
                            mui('#yqpopover').popover('toggle');
                        } else {
                            mui.toast(data.msg);
                        }
                    },
                    error: function (xhr, type, errorThrown) {
                        //异常处理；
                        console.log(type);
                    }
                });
            }else{
                mui.toast("请填写申请理由");
            }
            
        })

        //获取训练营教练列表
        toCoachList('','');
    });



    //训练营教练列表接口获取数据并追加到页面
    var toCoachList = function(page,gType) {
        var url  = "{:url('api/camp_member/getCoachListApi','','',true)}";
        var campID = "{$campInfo.id}";
        mui.ajax({
            url:url,
            data: {
                camp_id:campID
            },
            dataType: 'json',//服务器返回json格式数据
            type: 'post',//HTTP请求类型
            timeout: 10000,//超时时间设置为10秒；
            headers: {'Content-Type': 'application/json'},
            //processData:false,
            success: function (data) {
                var newli='';
                for(var i=0;i<=data.data.length-1;i++){
                    newli = newli + '<img class="coachicon" src="'+data.data[i].portraits+'" alt="'+data.data[i].coach+'">'
                    console.log(data.data[i].portraits)
                    if(i>=4){ return false }
                }
                $("#coachlist").append(newli);
            },
            error: function(xhr, type, errerThrown) {
                mui.toast('网络异常,请稍候再试');
            }
        });
    };
    </script>
</body>
</html>