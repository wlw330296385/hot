<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>教练管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--标准mui.css-->
    <link rel="stylesheet" href="/static/frontend/css/mui.min.css">
    <!--自定义style.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/style.css"/>
    <!--等级星星样式-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/feedback.css"/>
</head>

<body>
    <!--头部搜索2-->
    <header id="header" class="mui-bar mui-bar-nav" style="border-bottom: solid 1px #e3e3e3;">
        <a class="mui-control-item mui-icon mui-icon-left-nav" href="{:url('camp/powerCamp',['camp_id'=>$camp_id])}"></a>
        <h1 class="mui-title" style="text-align: left;font-size: 14px;">教练列表</h1>
        <a href="{:url('camp/coachListOfCamp', ['status' => 0, 'camp_id' => $camp_id])}" class="mui-pull-right " style="font-size: 14px;line-height: 44px;color:#000">待审核教练</a>
    </header>

    <div class="mui-content">

        <div class="basic-search">
            <input type="search" class="keyword" placeholder="请输入教练员名称">
            <span class="mui-icon mui-icon-search searchicon" id="searchBtn"></span>
        </div>

        <ul id="OA_task_coach" class="mui-table-view list coach">

        </ul>

    </div>

    <script src="/static/frontend/js/mui.min.js"></script>
    <script src="/static/frontend/js/jquery-3.2.1.min.js"></script>
    <script src="/static/frontend/js/wooApi.js"></script>
    <script src="/static/frontend/js/common.js"></script>
    <script>
    //初始化
    mui.init({
        swipeBack: true //启用右滑关闭功能
    });

    mui("body").on("tap","a",function(){
        window.top.location.href=this.href;
    });


    $(function () {

        var keyword='';
        $('.keyword').val(keyword);

        //搜索教练
        $("#searchBtn").on("tap","", function () {
            keyword = $(".keyword").val();
            toCoachList(keyword);
        })

        //获取训练营教练列表
        toCoachList(keyword);
    });



    //训练营教练列表接口获取数据并追加到页面
    var toCoachList = function(keyword) {
        var url  = "{:url('api/camp_member/getCoachListApi','','',true)}";
        var campID = "{$camp_id}";
        mui.ajax({
            url:url,
            data: {
                camp_id:campID,
                keyword:keyword,
                status:1
            },
            dataType: 'json',//服务器返回json格式数据
            type: 'post',//HTTP请求类型
            timeout: 10000,//超时时间设置为10秒；
            headers: {'Content-Type': 'application/json'},
            //processData:false,
            success: function (data) {
                console.log(data);
                if (data.code == 200) {
                    var newli = '';
                    for (var i = 0; i <= data.data.length - 1; i++) {
                        var coachSexUrl = getSexIconUrl(data.data[i].sex);
                        var urls = "{:url('camp/coachInfoOfCamp')}" + '/coach_id/' + data.data[i].id + '/camp_id/'+campID;
                        newli += '<li class="mui-table-view-cell mui-media listli list-wide"><div class="mui-slider-right mui-disabled"><span class="mui-btn mui-btn-red" data-id="'+data.data[i].campmemberid+'">删除</span></div><div class="mui-slider-handle"><a href="' + urls + '"><img class="mui-media-object mui-pull-left coachicon" src="' + data.data[i].portraits + '"><div class="mui-media-body wd36">' + data.data[i].coach + '<img src="' + coachSexUrl + '" class="sex" alt=""><p class="mui-ellipsis">教龄:' + data.data[i].coach_year + '&nbsp;&nbsp;等级:' + data.data[i].coach_level + '</p></div><div class="price-frame"><div class="icons mui-inline">' + data.data[i].star + '<i data-index="1" class="mui-icon mui-icon-star-filled"></i><i data-index="2" class="mui-icon mui-icon-star-filled"></i><i data-index="3" class="mui-icon mui-icon-star-filled"></i><i data-index="4" class="mui-icon mui-icon-star-filled"></i><i data-index="5" class="mui-icon mui-icon-star-filled"></i></div><p class="address tr">' + data.data[i].area + '</p></div></div></a></li>'
                    }
                    $("ul.coach").empty();
                    if(newli==''){
                        newli = '<li class="nodata"><i class="icon iconfont icon-hothome-trainingpoi"></i><p>没有查找到数据哦</p></li>'
                    }
                    $("ul.coach").append(newli);

                }else{
                    mui.toast('数据获取失败,请稍候再试');
                }
            },
            error: function(xhr, type, errerThrown) {
                mui.toast('网络异常,请稍候再试');
            }
        });
    };

     //拖拽后显示操作图标，点击操作图标删除元素；
     $('#OA_task_coach').on('tap', '.mui-btn', function(event) {
        var elem = this;
        var li = elem.parentNode.parentNode;
        var btnArray = ['确认', '取消'];
        var url  = "{:url('api/campMember/removerelationship')}";
        var campmemberid = $(this).attr("data-id");
        mui.confirm('确认删除该教练？', '提示', btnArray, function(e) {
            if (e.index == 0) {
                mui.ajax({
                    url:url,
                    data: {
                        "campmemberid":campmemberid
                    },
                    dataType: 'json',//服务器返回json格式数据
                    type: 'post',//HTTP请求类型
                    timeout: 10000,//超时时间设置为10秒；
                    headers: {'Content-Type': 'application/json'},
                    success: function (data) {
                        console.log(data);
                        if (data.code == 200) {
                            console.log(data);
                            li.parentNode.removeChild(li);
                            /*$("ul.coach").empty();
                            if(newli==''){
                                newli = '<li class="nodata"><i class="icon iconfont icon-hothome-trainingpoi"></i><p>没有查找到数据哦</p></li>'
                            }
                            $("ul.coach").append(newli);*/
                        } else {
                            mui.toast(data.msg);
                        }
                    },
                    error: function(xhr, type, errerThrown) {
                        mui.toast('网络异常,请稍候再试');
                    }
                });
                
            } else {
                setTimeout(function() {
                    $.swipeoutClose(li);
                }, 0);
            }
        });
    });

</script>
</body>
</html>