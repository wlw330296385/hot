<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>提现</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--标准mui.css-->
    <link rel="stylesheet" href="/static/frontend/css/mui.min.css">
    <!--icon扩展样式icons-extra.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/icons-extra.css"/>
    <!--App自定义的css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/app.css"/>
    <!--自定义style.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/style.css"/>
    <style>

        .mui-btn-block{
            width: 80%;
            margin: 30px auto;
            padding: 10px 0;
            font-size: 16px;
        }

    </style>
</head>

<body class=whitebg>
<header id="header" class="mui-bar mui-bar-nav subheader">
    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left arrow"></a>
    <h1 class="mui-title">钱包余额提现</h1>
</header>
<div class="mui-content">

    <form action="" class="mui-input-group">
        <input type="hidden" name="tid" class="data" value="{$tid}">
        <input type="hidden" name="bank_card" class="data" value="">
        <input type="hidden" name="bank" class="data" value="">
        <input type="hidden" name="bank_type" class="data" value="">
        <input type="hidden" name="realname" class="data" value="">
        <input type="hidden" name="telephone" class="data" value="">
        <div class="mui-input-row">
            <span>钱包余额 <b class="colororange">￥{$memberInfo['balance']}</b></span>
        </div>
        <div class="mui-input-row">
            <label>提现金额</label>
            <input type="text" class="data" name="salary" placeholder="￥0.00">
        </div>
        <div class="mui-input-row">
            <label>到账账号</label>
            {if condition="$bankcardList"}
            <span class="mui-navigate-right">
                        <select class="bankcard_select" style="padding-right: 15px;">
                            {volist name="bankcardList" id="vol"}
                                <option data-action="select" data-bank-card="{$vol.bank_card}" data-bank="{$vol.bank}" data-bank-type ="{$vol.bank_type}" data-bank="{$vol.bank}" data-realname ="{$vol.realname}" data-telephone ="{$vol.telephone}">{$vol.bank}({$vol.bank_card|substr=-4}) 提现手续费0.1%</option>
                            {/volist}
                                <option data-action="add" data-url="{:url('member/createBankCard')}">添加新账号</option>
                        </select>
             </span>
            {else /}
            <a href="{:url('member/createBankCard')}" class="mui-navigate-right"><span>添加新账号</span></a>
            {/if}
        </div>

        <button type="button" class="mui-btn mui-btn-primary mui-btn-block" id="submitBtn">提现</button>
        <br />
    </form>

    <div class="list">
        <div class="page-header">
            <span class="course">当前提现账号信息</span>
        </div>
        <ul class="mui-table-view">
            <li class="mui-table-view-cell listli">收款人
                <span class="realname"></span>
            </li>
            <li class="mui-table-view-cell listli">预留电话
                <span class="telephone"></span>
            </li>
            <li class="mui-table-view-cell listli">收款账号
                <span class="bank_card"></span>
            </li>
            <li class="mui-table-view-cell listli">收款银行
                <span class="bank"></span>
            </li>
            <li class="mui-table-view-cell listli">账号类型
                <span class="bank_type"></span>
            </li>
        </ul>
    </div>
</div>

</body>

</html>



<script src="/static/frontend/js/mui.min.js"></script>
<script src="/static/frontend/js/jquery-3.2.1.min.js"></script>
<script src="/static/frontend/js/wooApi.js"></script>
<script>
    //初始化
    mui.init({
        swipeBack: true //启用右滑关闭功能
    });
    mui('.mui-content').on('tap', 'a', function () {
        window.top.location.href = this.href;
    });

    var ok = true;

    $(function(){

        {if condition="$bankcardList"}

            var bank_card = "{$bankcardList.0.bank_card}";
            var bank= "{$bankcardList.0.bank}";
            var bank_type = "{$bankcardList.0.bank_type}";
            var realname ="{$bankcardList.0.realname}";
            var telephone = "{$bankcardList.0.telephone}";

            $('input[name=bank_card]').val(bank_card);
            $('input[name=bank_type]').val(bank_type);
            $('input[name=bank]').val(bank);
            $('input[name=realname]').val(realname);
            $('input[name=telephone]').val(telephone);
            $('.bank_card').text(bank_card);
            $('.bank_type').text(bank_type);
            $('.bank').text(bank);
            $('.realname').text(realname);
            $('.telephone').text(telephone);

        {/if}


        $('.bankcard_select').on('change',function(){

            //下来选择一变化先清空一下（如操作跳转到添加银行卡页面后返回，有可能保留了原值）
            $('input[name=bank_card]').val("");
            $('input[name=bank_type]').val("");
            $('input[name=bank]').val("");
            $('input[name=realname]').val("");
            $('input[name=telephone]').val("");
            $('.bank_card').text("");
            $('.bank_type').text("");
            $('.bank').text("");
            $('.realname').text("");
            $('.telephone').text("");

            var action = $(this).find("option:selected").attr('data-action');
            if(action=="add"){
                location.href = "{:url('member/createBankCard')}";
            }else if(action=="select"){
                $('input[name=bank_card]').val($(this).find("option:selected").attr('data-bank-card'));
                $('input[name=bank_type]').val($(this).find("option:selected").attr('data-bank-type'));
                $('input[name=bank]').val($(this).find("option:selected").attr('data-bank'));
                $('input[name=realname]').val($(this).find("option:selected").attr('data-realname'));
                $('input[name=telephone]').val($(this).find("option:selected").attr('data-telephone'));
                $('.bank_card').text($(this).find("option:selected").attr('data-bank-card'));
                $('.bank_type').text($(this).find("option:selected").attr('data-bank-type'));
                $('.bank').text($(this).find("option:selected").attr('data-bank'));
                $('.realname').text($(this).find("option:selected").attr('data-realname'));
                $('.telephone').text($(this).find("option:selected").attr('data-telephone'));
            }

        })

        $('#submitBtn').on('click',function(){

            if(ok == false||$('input[name=bank_card]').val()==""||$('input[name=bank_type]').val()==""||$('input[name=bank]').val()==""||$('input[name=realname]').val()==""||$('input[name=telephone]').val()==""||$('input[name=salary]').val()==""){
                mui.alert("请填写数值大于零的整数金额，并选择到账账号！谢谢！");
                return false;
            }else{

                var sum = $('input[name=salary]').val();
                if(!(/^[1-9]+?[0-9]*$/).test(sum)){
                    mui.alert("请填写数值大于零的整数，谢谢！");
                    return false;
                }else if(parseFloat(sum)> parseFloat("{$memberInfo['balance']}") ){
                    mui.alert("您填写的金额不能大于你的个人余额哦！");
                    return false;
                }

                var data1 = wooApi.getInputData();
                var objData = wooApi.arrTOobj(data1);
                var result = wooApi.asyncF("{:url('api/SalaryOut/applySalaryOut')}",objData);
                mui.alert(result.msg)
                if(result.code == 200){
                    window.location.href="{:url('member/mywallet')}";
                }

            }
            
        })


        // 提现金额
        $('input[name=salary]').on('blur',function(){
            var sum = $(this).val();
            if(!(/^[1-9]+?[0-9]*$/).test(sum)){
                mui.toast("请填写数值大于零的整数，谢谢！");
                ok = false;
                return false;
            }else if(parseFloat(sum)> parseFloat("{$memberInfo['balance']}") ){
                mui.toast("您填写的金额不能大于你的个人余额哦！");
                ok = false;
                return false;
            }
        })
    })
</script>