<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>个人资料</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--标准mui.css-->
    <link rel="stylesheet" href="/static/frontend/css/mui.min.css">
    <!--自定义style.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/style.css"/>
    <!--选择器样式-->
    <link href="/static/frontend/css/mui.picker.min.css" rel="stylesheet"/>
    <link href="/static/frontend/css/mui.poppicker.css" rel="stylesheet"/>
    <style>
        .mui-views,
        .mui-view,
        .mui-pages,
        .mui-page,
        .mui-page-content {
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            background-color: #efeff4;
        }
        .mui-pages {
            top: 46px;
            height: auto;
        }
        .mui-scroll-wrapper,
        .mui-scroll {
            background-color: #efeff4;
        }
        .mui-page.mui-transitioning {
            -webkit-transition: -webkit-transform 300ms ease;
            transition: transform 300ms ease;
        }
        .mui-page-left {
            -webkit-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0);
        }
        .mui-ios .mui-page-left {
            -webkit-transform: translate3d(-20%, 0, 0);
            transform: translate3d(-20%, 0, 0);
        }
        .mui-navbar {
            position: fixed;
            right: 0;
            left: 0;
            z-index: 10;
            height: 44px;
            background-color: #f7f7f8;
        }
        .mui-navbar .mui-bar {
            position: absolute;
            background: transparent;
            text-align: center;
        }
        .mui-android .mui-navbar-inner.mui-navbar-left {
            opacity: 0;
        }
        .mui-ios .mui-navbar-left .mui-left,
        .mui-ios .mui-navbar-left .mui-center,
        .mui-ios .mui-navbar-left .mui-right {
            opacity: 0;
        }
        .mui-navbar .mui-btn-nav {
            -webkit-transition: none;
            transition: none;
            -webkit-transition-duration: .0s;
            transition-duration: .0s;
        }
        .mui-navbar .mui-bar .mui-title {
         margin-left: 0 !important;
     }
     .mui-page-shadow {
        position: absolute;
        right: 100%;
        top: 0;
        width: 16px;
        height: 100%;
        z-index: -1;
        content: '';
    }
    .mui-page-shadow {
        background: -webkit-linear-gradient(left, rgba(0, 0, 0, 0) 0, rgba(0, 0, 0, 0) 10%, rgba(0, 0, 0, .01) 50%, rgba(0, 0, 0, .2) 100%);
        background: linear-gradient(to right, rgba(0, 0, 0, 0) 0, rgba(0, 0, 0, 0) 10%, rgba(0, 0, 0, .01) 50%, rgba(0, 0, 0, .2) 100%);
    }
    .mui-navbar-inner.mui-transitioning,
    .mui-navbar-inner .mui-transitioning {
        -webkit-transition: opacity 300ms ease, -webkit-transform 300ms ease;
        transition: opacity 300ms ease, transform 300ms ease;
    }
    .mui-page {
        display: none;
    }
    .mui-pages .mui-page {
        display: block;
    }
    .mui-table-view span.mui-pull-right {
        color: #999;
    }
    .mui-table-view-divider {
        background-color: #efeff4;
        font-size: 14px;
    }
    .mui-table-view-divider:before,
    .mui-table-view-divider:after {
        height: 0;
    }
    .mui-fullscreen {
        position: fixed;
        z-index: 20;
        background-color: #000;
    }
    .tipspan{
        font-size: 14px;
        text-align: center;
        display: block;
        padding: 10px;
        height: 41px;
    }
    .success{
        padding: 20px 0;
        width: 60%;
        margin: 0 auto;
    }
    .success img{
        width: 40px;
        height: 40px;
    }
    .success span{
        float: right;
        line-height: 40px;
    }

</style>
</head>

<body class="mui-fullscreen">
    <!--页面主结构开始-->
    <div id="app" class="mui-views">
        <div class="mui-view">
            <div class="mui-navbar">
            </div>
            <div class="mui-pages">
            </div>
        </div>
    </div>
    <!--页面主结构结束-->

    <!--单页面开始-->
    <div id="setting" class="mui-page">
        <!--页面标题栏开始-->
        <div class="mui-navbar-inner mui-bar mui-bar-nav">
            <button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
                <span class="mui-icon mui-icon-left-nav"></span>
            </button>
            <h1 class="mui-center mui-title">个人资料</h1>
        </div>
        <!--页面标题栏结束-->

        <!--页面主内容区开始-->
        <div class="mui-page-content">
            <div class="mui-scroll-wrapper">
                <div class="mui-scroll">
                    <div class="list camp-list camp-lesson-list detalis-list coach">
                        <div class="page-header">
                            <span class="course"><b>个人信息</b></span>
                            <span class="more" style="font-size:14px;padding-right: 15px;"><a href="#editor" class="editroBtn mui-navigate-right">编辑</a></span>
                        </div>
                        <form action="" class="mui-input-group archives1 mb">
                            <div class="mui-input-row h-auto">
                                <label>头像</label><img src="{$memberInfo['avatar']}" alt="头像" style="margin-right: 18px">
                            </div>
                            <div class="mui-input-row">
                                <label>会员ID</label><span>{$memberInfo['hot_id']}</span>
                            </div>
                            <div class="mui-input-row">
                                <label>姓名</label><span class="name">{$memberInfo['member']}</span>
                            </div>
                            <div class="mui-input-row">
                                <label>性别</label><span class="sex">{$memberInfo['sex']|format_sex}</span>
                            </div>
                            <div class="mui-input-row">
                                <label>身高</label><span class="height">{$memberInfo['height']}cm</span>
                            </div>
                            <div class="mui-input-row">
                                <label>体重</label><span class="weight">{$memberInfo['weight']}kg</span>
                            </div>
                            <div class="mui-input-row">
                                <label>出生日期</label><span class="birthday">{$memberInfo['birthday']}</span>
                            </div>
                            <div class="mui-input-row">
                                <label>所属地区</label><span>{$memberInfo['province']}{$memberInfo['city']}{$memberInfo['area']}</span>
                            </div>
                            <div class="mui-input-row">
                                <label>注册时间</label><span class="">{$memberInfo['create_time']}</span>
                            </div>
                        </form>
                        <div class="page-header">
                            <span class="course"><b>其他</b></span>
                        </div>
                        <ul class="mui-table-view  public-list border-b">
                            <li class="mui-table-view-cell listli listinitial">
                                <a href="{:url('member/memberSetup')}" class="mui-navigate-right">个人设置</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!--页面主内容区结束-->
    </div>
    <!--单页面结束-->

    <div id="editor" class="mui-page">
        <div class="mui-navbar-inner mui-bar mui-bar-nav">
            <button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
                <span class="mui-icon mui-icon-left-nav"></span>
            </button>
            <h1 class="mui-center mui-title">编辑页面</h1>
        </div>
        <div class="mui-page-content">
            <div class="mui-scroll-wrapper">
                <div class="mui-scroll">
                    <form action="" class="mui-input-group archives2 mb">

                        <div class="mui-input-row h-auto">
                            <label>头像</label><img src="{$memberInfo['avatar']}" alt="头像" style="margin-right: 18px">
                        </div>
                        <div class="mui-input-row">
                            <label>会员ID</label>
                            <span>{$memberInfo['hot_id']}</span>
                        </div>
                        <div class="mui-input-row">
                            <label>姓名</label>
                            <input type="text" name="" class="member editor" value="{$memberInfo['member']}" style="color: #737373">
                        </div>
                        <div class="mui-input-row">
                            <label>性别</label>
                            <span class="editor">
                                <select class="sex">
                                    <option value="1" {eq name="$memberInfo.sex" value="1"}selected{/eq}>男</option>
                                    <option value="2" {eq name="$memberInfo.sex" value="2"}selected{/eq}>女</option>
                                </select>
                            </span>
                        </div>
                        <div class="mui-input-row" id="showUserPickerHeight">
                            <label>身高</label>
                            <span id='userResulth' class="height editor ui-alert">{$memberInfo['height']}</span>
                        </div>
                        <div class="mui-input-row" id="showUserPickerWeight">
                            <label>体重</label>
                            <span id='userResultw' class="weight editor ui-alert">{$memberInfo['weight']}</span>
                        </div>
                        <div class="mui-input-row btn1" id="demo2" data-options='{"type":"date","beginYear":1850,"endYear":2023}'>
                            <label>出生日期</label>
                            <span id="result" class="ui-alert birthday">{$memberInfo['birthday']}</span>
                        </div>
                        <div class="mui-input-row" id='showCityPicker3'>
                            <label>所属地区</label>
                            <span id="cityResult3" class="ui-alert">{$memberInfo['province']} {$memberInfo['city']} {$memberInfo['area']}</span>
                        </div>
                        <div class="mui-input-row">
                            <label>注册时间</label>
                            <span class="">{$memberInfo['create_time']}</span>
                        </div>
                    </form>
                    <div class="tjbtn tjbtn-next">
                        <button type="button" class="btn successBtn">
                            完成
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="/static/frontend/js/mui.min.js "></script>
    <script src="/static/frontend/js/jquery-3.2.1.min.js"></script>
    <!-- 窗体切换 -->
    <script src="/static/frontend/js/mui.view.js "></script>
    <!--选择器-->
    <script src="/static/frontend/js/mui.picker.min.js"></script>
    <script src="/static/frontend/js/mui.poppicker.js"></script>
    <script src="/static/frontend/js/city.data-3.js"></script>
    <script src="/static/frontend/js/height.data.js"></script>
    <script src="/static/frontend/js/weight.data.js"></script>
    <script>
        mui.init();
        //初始化单页view
        var viewApi = mui('#app').view({
            defaultPage: '#setting'
        });

        //初始化单页的区域滚动
        mui('.mui-scroll-wrapper').scroll();
        var view = viewApi.view;
        (function($) {
            //处理view的后退与webview后退
            var oldBack = $.back;
            $.back = function() {
                if (viewApi.canBack()) { //如果view可以后退，则执行view的后退
                    viewApi.back();
                } else { //执行webview后退
                    oldBack();
                }
            };
        })(mui);

        // 选择器
        var getProvince = '';
        var getCity = '';
        var getArea = '';
        (function ($, doc) {
            $.init();
            $.ready(function () {
                var _getParam = function (obj, param) {
                    return obj[param] || '';
                };

            //身高选择
            var userPickerh = new $.PopPicker();
            userPickerh.setData(heightData);

            var showUserPickerButton = doc.getElementById('showUserPickerHeight');
            var userResulth = doc.getElementById('userResulth');
            showUserPickerButton.addEventListener('tap', function(event) {
                userPickerh.show(function(items) {
                    userResulth.innerText = _getParam(items[0], 'text');
                            //返回 false 可以阻止选择框的关闭
                            //return false;
                        });
            }, false);
             //体重选择
             var userPickerw = new $.PopPicker();
             userPickerw.setData(weightData);

             var showUserPickerButton = doc.getElementById('showUserPickerWeight');
             var userResultw = doc.getElementById('userResultw');
             showUserPickerButton.addEventListener('tap', function(event) {
                userPickerw.show(function(items) {
                    userResultw.innerText = _getParam(items[0], 'text');
                            //返回 false 可以阻止选择框的关闭
                            //return false;
                        });
            }, false);
            ///级联示例
            var cityPicker3 = new $.PopPicker({
                layer: 3
            });
            cityPicker3.setData(cityData3);
            var showCityPickerButton = doc.getElementById('showCityPicker3');
            var cityResult3 = doc.getElementById('cityResult3');
            showCityPickerButton.addEventListener('tap', function (event) {
                cityPicker3.show(function (items) {
                    cityResult3.innerText = _getParam(items[0], 'text') + " " + _getParam(items[1], 'text') + " " + _getParam(items[2], 'text');
                    //返回 false 可以阻止选择框的关闭
                    //return false;
                    getProvince = _getParam(items[0], 'text');
                    getCity = _getParam(items[1], 'text');
                    getArea = _getParam(items[2], 'text');
                });
            }, false);

            //时间
            var result = $('#result')[0];
            var btns = $('.btn1');
            btns.each(function (i, btn) {
                btn.addEventListener('tap', function () {
                    var optionsJson = this.getAttribute('data-options') || '{}';
                    var options = JSON.parse(optionsJson);
                    var id = this.getAttribute('id');
                    var picker = new $.DtPicker(options);

                    picker.show(function (rs) {
                        result.innerText = rs.text;
                        picker.dispose();
                    });
                }, false);
            });

        });
        })(mui, document);

        //个人信息编辑
        $(".successBtn").click(function(){
            var btnArray = ['取消', '确认'];
            mui.confirm('是否确认修改？','', btnArray, function(e) {
                if (e.index == 1) {
                    var member =$("#editor .member").val();
                    var sex =$("#editor .sex option:selected").val();
                    var height =$("#editor .height").text();
                    var weight =$("#editor .weight").text();
                    var birthday =$("#editor .birthday").text();
                    if(member!=''&&sex!=''&& height!=''&& weight!=''&& birthday!=''){
                        mui.ajax("{:url('api/member/updateMemberApi')}", {
                            data: {
                                'member': member,
                                'sex': sex,
                                'height': height,
                                'weight': weight,
                                'birthday': birthday,
                                'province': getProvince,
                                'city': getCity,
                                'area': getArea,
                            },
                            dataType: 'json',//服务器返回json格式数据
                            type: 'post',//HTTP请求类型
                            timeout: 10000,//超时时间设置为10秒；
                            headers: {'Content-Type': 'application/json'},
                            success: function (data) {
                                console.log(data)
                                mui.toast(data.msg)
                                  setTimeout(viewApi.back(),2500);
                                  location.reload();
                            },
                            error: function (xhr, type, errorThrown) {
                                console.log(data);
                                mui.toast("网络异常,请稍候再试");
                            }
                        }); 
                    }else{
                        mui.toast("请完善信息")
                    }
                } else {
                    return;
                }
            })

        })

    </script>

</body>

</html>