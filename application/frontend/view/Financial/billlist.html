<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>训练营名称</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--标准mui.css-->
    <link rel="stylesheet" href="/static/frontend/css/mui.min.css">
    <!--icon扩展样式icons-extra.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/icons-extra.css" />
    <!--App自定义的css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/app.css" />
    <!--自定义style.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/style.css" />
    <style type="text/css">
        .coach .table {
            font-size: 13px;
        }
        
        .for-tab {
            background-color: #efeff4;
        }
        
        .list-cont1 {
            white-space: normal;
            padding-right: 15px;
        }
        
        .nav-list .nav-list-frame a span {
            font-size: 13px;
        }
        
        .mui-table-view-cell {
            border-bottom: 1px solid #EEEEEE;
        }
        
        .mui-table-view-cell:after {
            background: none !important;
        }
        
        .mui-control-item {
            line-height: 26px !important;
            padding: 10px 0px 8px;
        }
        
        .mui-control-item span {
            font-size: 16px;
            display: block;
        }
        
        .sheader {
            padding: 8px 15px !important;
        }
        
        .sheader span {
            line-height: 24px;
        }
    </style>
</head>

<body>


    <header id="header" class="mui-bar mui-bar-nav for-tab">
        <ul class="mui-table-view detalis-list border-b">
            <li class="listli sheader mui-clearfix">
                <a class="mui-pull-left mui-icon mui-icon-left-nav" href="#"></a>
                <span class="mui-pull-right title-name">{$days} 订单列表</span>
            </li>
        </ul>
        <ul class="mui-table-view camp-lesson-list detalis-list coach">
            <li class="mui-table-view-cell">
                <ul class="mui-row table">
                    <li class="mui-col-sm-6 mui-col-xs-10 mui-text-left">订单名称（课程）</li>
                    <li class="mui-col-sm-2 mui-col-xs-2 mui-text-center">金额</li>
                </ul>
            </li>
        </ul>
    </header>

    <div class="mui-content">
        <div class="camp-lesson-list detalis-list coach">

            <!--<div class="tab-pullRefresh">
                <div id="#item4" class="mui-scroll-wrapper mui-control-content mui-active" style="top:85px">
                    <div class="mui-scroll">
                        <ul class="mui-table-view mui-text-center detalis-list bill1">
                            <li class="mui-table-view-cell listli">
                                <a href="/frontend/bill/billinfo/bill_order/22017111418153391115">
                                    <ul class="mui-row table  bill">
                                        <li class="mui-col-sm-10 mui-col-xs-10">
                                            <div class="list-cont1">legend购买超级射手［海岸城站］
                                                <p>2017-11-14 18:15</p>
                                            </div>
                                        </li>
                                        <li class="mui-col-sm-2 mui-col-xs-2">1</li>
                                    </ul>
                                </a>
                            </li>

                        </ul>
                    </div>
                </div>

            </div>-->
            <div id="refreshContainer" class="mui-scroll-wrapper" style="margin-top: 94px">
                <div class="mui-scroll">
                    <ul class="mui-table-view detalis-list list border-b bill">
                    </ul>
                </div>
            </div>

        </div>
    </div>

</body>
<script src="/static/frontend/js/mui.min.js"></script>
<script src="/static/frontend/js/jquery-3.2.1.min.js"></script>
<script src="/static/frontend/js/wooApi.js"></script>
<script src="/static/frontend/js/common.js"></script>
<script>
    //初始化
    mui.init({
        swipeBack: true //启用右滑关闭功能
    });

    mui("body").on("tap", "a", function () {
        window.top.location.href = this.href;
    });


    // $(function () {
    //     // 参考订单列表页面 api
    //     //        toBillList('dd', 1, 1);
    //     //获取订单列表数据并追加到页面
    //     //        var toBillList = function (wList, page, gType) {
    //     page = 1;
    //     var url = "{:url('api/bill/getBillListByPageApi','','',true)}/?page=" + page;
    //     mui.ajax({
    //         url: url,
    //         data: {
    //             camp_id: "{$camp_id}",
    //             start: "{$start}",
    //             end: "{$end}"
    //         },
    //         dataType: 'json',//服务器返回json格式数据
    //         type: 'post',//HTTP请求类型
    //         timeout: 10000,//超时时间设置为10秒；
    //         headers: { 'Content-Type': 'application/json' },
    //         //processData:false,
    //         success: function (data) {

    //         },
    //         error: function (xhr, type, errerThrown) {
    //             mui.toast('网络异常,请稍候再试');
    //             //mui('#' + wList).pullRefresh().endPullupToRefresh(true);
    //         }
    //     });
    //     //        }
    // })


    $(function () {

        //初始化全局变量
        var sCount = 1;

        mui.init({
            swipeBack: true, //启用右滑关闭功能
            pullRefresh: {
                //下拉刷新上拉加载教练列表
                container: "#refreshContainer",
                down: {
                    //下拉刷新
                    height: 50,//可选.默认50.触发下拉刷新拖动距离
                    auto: true,//可选,默认false.自动下拉刷新一次
                    contentdown: "下拉可以刷新",//可选，在下拉可刷新状态时，下拉刷新控件上显示的标题内容
                    contentover: "释放立即刷新",//可选，在释放可刷新状态时，下拉刷新控件上显示的标题内容
                    contentrefresh: "正在刷新...",//可选，正在刷新状态时，下拉刷新控件上显示的标题内容
                    callback: pulldownRefresh
                },
                up: {
                    //上拉加载
                    height: 150,//可选.默认50.触发上拉加载拖动距离
                    //auto:true,//可选,默认false.自动上拉加载一次
                    contentrefresh: '正在加载...',
                    contentnomore: '没有更多数据了',//可选，请求完毕若没有更多数据时显示的提醒内容；
                    callback: pullupRefresh
                }
            }
        });

        //下拉刷新具体业务实现
        function pulldownRefresh() {
            setTimeout(function () {
                sCount = 1;//刷新并显示第一页
                var page = sCount;
                var gType = 1;//代表下拉刷新
                toBillList(page, gType);//具体取数据的方法
            }, 100);
        }
        //上拉加载具体业务实现
        function pullupRefresh() {
            setTimeout(function () {
                sCount++;//翻下一页
                var page = sCount;
                var gType = 2;//代表上拉加载
                toBillList(page, gType);//具体取数据的方法
            }, 100);
        }


        // toBillList()

    });


    //获取订单列表数据并追加到页面
    var toBillList = function (wList, page, gType) {
        var url = "{:url('api/bill/getBillListByPageApi','','',true)}/?page=" + page;
        mui.ajax({
            url: url,
            data: {
                camp_id: "{$camp_id}",
                start: "{$start}",
                end: "{$end}"
            },
            dataType: 'json',//服务器返回json格式数据
            type: 'post',//HTTP请求类型
            timeout: 10000,//超时时间设置为10秒；
            headers: { 'Content-Type': 'application/json' },
            //processData:false,
            success: function (data) {
                console.log(data)
                var newli = '';
                if (data.code == 200) {
                    for (var i = 0; i <= data.data.data.length - 1; i++) {
                        var urls = "{:url('bill/billinfoofcamp')}" + '/bill_id/' + data.data.data[i].id + '/camp_id/' + data.data.data[i].camp_id;
                        newli = newli + '<a href="' + urls + '"><li class="mui-table-view-cell mui-media border-b"><ul class="mui-row table"><li class="mui-col-xs-5 mui-col-sm-5">' + data.data.data[i].goods + '</li><li class="mui-col-xs-3 mui-col-sm-3">' + data.data.data[i].balance_pay + '</li><li class="mui-col-xs-4 mui-col-sm-4">' + pay_time + '</li></ul></li></a>';
                    }
                    console.log(newli)
                    if (gType == 1) {
                        //上拉刷新
                        $("ul.bill").empty().append(newli);
                        mui('#' + wList).pullRefresh().endPulldownToRefresh();
                        mui('#' + wList).pullRefresh().refresh(true);
                        if (newli == '') {
                            $("ul.bill").append('<li class="nodata"><p>没有相关数据哦</p></li>');
                        }
                    } else {
                        //下拉加载 gType==2
                        $("ul.bill").append(newli);
                    }
                } else {
                    mui.toast('数据获取失败,请稍候再试');
                }

                if (newli != '') {
                    mui('#' + wList).pullRefresh().endPullupToRefresh(false);
                } else {
                    mui('#' + wList).pullRefresh().endPullupToRefresh(true);
                }

            },
            error: function (xhr, type, errerThrown) {
                mui.toast('网络异常,请稍候再试');
                mui('#' + wList).pullRefresh().endPullupToRefresh(true);
            }
        });
    };

</script>

</html>