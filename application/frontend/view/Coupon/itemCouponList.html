<!DOCTYPE html>
<html>
<head>
	<title>我的卡券</title>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--标准mui.css-->
    <link rel="stylesheet" href="/static/frontend/css/mui.min.css">
    <!--自定义style.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/style.css"/>
	<link rel="stylesheet" type="text/css" href="/static/frontend/css/coupon.css" />
</head>
<body>


	<header id="header" class="mui-bar mui-bar-nav for-tab">
		<div class="camp-lesson-list">
			<div class="mui-segmented-control mb">
				<a class="mui-control-item mui-icon mui-icon-left-nav" href="{:url('member/index')}"></a>
				<a class="mui-control-item mui-active" href="#changeList">礼品券</a>
			</div>
		</div>
	</header>

	<div class="mui-content">

		<div class="tab-pullRefresh">
			<div id="itemCouponList" class="mui-scroll-wrapper mui-control-content mui-active">
				<div class="mui-scroll" style="padding-top:15px;">
						{volist name="itemCouponList" id="vol"}
						<div class="coupon">
							<div class="orangebg">
								<div class="cNum">{$vol.itemCoupon.price}<span>元</span></div>
								<div class="cFrom">{$vol.itemCoupon.organization}</div>
								<div class="cID">ID:{$vol.coupon_number}</div>
								<div class="cName">{$vol.item_coupon}</div>
								<div class="cDate">{$vol.itemCoupon.start} 至 {$vol.itemCoupon.end}</div>
								<i></i>
							</div>
							<div class="tips">
								<a href="{:url('frontend/Coupon/itemCouponInfo',['item_coupon_id'=>$vol['itemCoupon']['id']])}">查看卡券详情<span class="mui-icon mui-icon-forward"></span></a>

									{if strtotime($vol.itemCoupon.start) > time() || strtotime($vol.itemCoupon.end) < time()}
									<button type="button" class="mui-btn"  disabled="true"  >已失效  </button>
									{elseif $vol.status == 1}
									<button type="button" class="mui-btn bggreen useCard" data-itemCouponID="{$vol.itemCoupon.id}"   data-itemCouponMemberID = "{$vol.id}"   >立即使用  </button>
									{else /}
									<button type="button" class="mui-btn"  disabled="true"  >已使用  </button>
									{/if}
							</div>
						</div>
						{/volist}
				</div>
			</div>
		</div>

	</div>

</body>
</html>
<script src="/static/frontend/js/mui.min.js"></script>
<script src="/static/frontend/js/jquery-3.2.1.min.js"></script>
<script src="/static/frontend/js/wooApi.js?v={:time()}"></script>

<script type="text/javascript">
	//初始化
    mui.init({
        swipeBack: true //启用右滑关闭功能
    });

    mui("body").on("tap", "a", function () {
        window.top.location.href = this.href;
    });

    $(function(){
    	$('.useCard').on('tap',function(){
    		var itemCouponID = $(this).attr("data-itemCouponID");
    		var itemCouponMemberID = $(this).attr("data-itemCouponMemberID");
    		var r = confirm('使用后不可在使用,确定使用吗?')
    		if(r===true){
	    		var objData = {
	    			item_coupon_id:itemCouponID,
	    			item_coupon_member_id : itemCouponMemberID
	    		}
	    		var ajaxResult = wooApi.asyncF("{:url('api/item_coupon/useItemCoupon')}", objData);
	    		if(ajaxResult.code == 200){
	    			$(this).attr("disabled", true);
	    			$(this).text('已使用');
	    			
	    		}
	    		mui.toast(ajaxResult.msg);    			
    		}	

    		
    	})	
    })
</script>