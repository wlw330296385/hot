<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>订单</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--标准mui.css-->
    <link rel="stylesheet" href="/static/frontend/css/mui.min.css">
    <!--icon扩展样式icons-extra.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/icons-extra.css"/>
    <!--App自定义的css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/app.css"/>
    <!--自定义style.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/style.css"/>
    <style type="text/css">
        .coach .table { font-size: 13px; }
        .list-cont1 { white-space:normal; padding-right: 15px; }
        .nav-list .nav-list-frame a span { font-size: 13px; }
        .mui-table-view-cell { border-bottom: 1px solid #EEEEEE; }
    </style>
</head>

<body class=whitebg>


<header id="header" class="mui-bar mui-bar-nav for-tab">
    <div class="camp-lesson-list">
        <div id="segmentedControl" class="mui-segmented-control mb">
            <a class="mui-control-item mui-active" href="#bill1">已付款</a>
            <a class="mui-control-item" href="#bill0">未付款</a>
            <a class="mui-control-item" href="#bill-2">已退款</a>
            <a class="mui-control-item" href="#bill-1">未退款</a>
        </div>
    </div>
    <div class="nav-list">
        <ul class="mui-table-view mui-grid-view mui-grid-9 nav-list-frame">
            <li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3"><a href="#">
                <div class="mui-media-body" id="count-bill1">0</div>
                <span>已付款</span>
            </a></li>
            <li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3"><a href="#">
                <div class="mui-media-body" id="count-bill0">0</div>
                <span>未付款</span>
            </a></li>
            <li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3"><a href="#">
                <div class="mui-media-body" id="count-bill-2">0</div>
                <span>已退款</span>
            </a></li>
            <li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3"><a href="#">
                <div class="mui-media-body" id="count-bill-1">0</div>
                <span>未退款</span>
            </a></li>
        </ul>
    </div>
    <ul class="mui-table-view camp-lesson-list detalis-list coach">
        <li class="mui-table-view-cell">
            <ul class="mui-row table">
                <li class="mui-col-sm-6 mui-col-xs-10 mui-text-left">订单名称（课程）</li>
                <li class="mui-col-sm-2 mui-col-xs-2 mui-text-center">金额</li>
            </ul>
        </li>
    </ul>
</header>

<div class="mui-content">

    <div class="camp-lesson-list detalis-list coach">


        <div class="tab-pullRefresh">


            <div id="bill1" class="mui-scroll-wrapper mui-control-content mui-active" style="top:170px">
                <div class="mui-scroll">
                    <ul class="mui-table-view mui-text-center detalis-list bill1"></ul>
                </div>
            </div>
            <div id="bill0" class="mui-scroll-wrapper mui-control-content" style="top:170px">
                <div class="mui-scroll">
                    <ul class="mui-table-view mui-text-center detalis-list bill0"></ul>
                </div>
            </div>
            <div id="bill-2" class="mui-scroll-wrapper mui-control-content" style="top:170px">
                <div class="mui-scroll">
                    <ul class="mui-table-view mui-text-center detalis-list bill-2"></ul>
                </div>
            </div>
            <div id="bill-1" class="mui-scroll-wrapper mui-control-content" style="top:170px">
                <div class="mui-scroll">
                    <ul class="mui-table-view mui-text-center detalis-list bill-1"></ul>
                </div>
            </div>
        </div>

    </div>

</div>

</div>
</body>
<script src="/static/frontend/js/mui.min.js"></script>
<script src="/static/frontend/js/jquery-3.2.1.min.js"></script>
<script src="/static/frontend/js/wooApi.js"></script>
<script src="/static/frontend/js/common.js"></script>
<script>
    //初始化
    mui.init({
        swipeBack: true //启用右滑关闭功能
    });

    mui("body").on("tap","a",function(){
        window.top.location.href=this.href;
    });


    $(function () {
        var postData = {};
        postData.status = 1;
        console.log(postData);
        //初始化全局变量
        var Count1 = 1;
        var Count0 = 1;
        var Count01 = 1;
        var Count02 = 1;
        var campID=wooApi.GetQueryString('camp_id');
        var member_id = wooApi.GetQueryString('member_id');
        if(campID){
            postData.camp_id = campID;
        }
        if(member_id){
            postData.member_id = member_id;
        }
        console.log(postData);
        //已付款订单
        mui('#bill1').pullRefresh({
            down: {
                //下拉刷新
                height: 50,//可选.默认50.触发下拉刷新拖动距离
                auto:true,//可选,默认false.自动下拉刷新一次
                contentdown : "下拉可以刷新",//可选，在下拉可刷新状态时，下拉刷新控件上显示的标题内容
                contentover : "释放立即刷新",//可选，在释放可刷新状态时，下拉刷新控件上显示的标题内容
                contentrefresh : "正在刷新...",//可选，正在刷新状态时，下拉刷新控件上显示的标题内容
                callback: pulldownRefresh1
            },
            up: {
                //上拉加载
                height: 150,//可选.默认50.触发上拉加载拖动距离
                //auto:true,//可选,默认false.自动上拉加载一次
                contentrefresh: '正在加载...',
                contentnomore:'没有更多数据了',//可选，请求完毕若没有更多数据时显示的提醒内容；
                callback: pullupRefresh1
            }
        });
        //下拉刷新具体业务实现（上架）
        function pulldownRefresh1() {
            setTimeout(function() {
                Count1 = 1;//刷新并显示第一页
                var page = Count1;
                var gType = 1;//代表下拉刷新
                toList('bill1',page,gType,postData);//具体取数据的方法
            }, 100);
        }
        //上拉加载具体业务实现（上架）
        function pullupRefresh1() {
            setTimeout(function() {
                Count1++;//翻下一页
                var page = Count1;
                var gType =2;//代表上拉加载
                toList('bill1',page,gType,postData);//具体取数据的方法
            }, 100);
        }

        //未付款订单
        mui('#bill0').pullRefresh({
            down: {
                //下拉刷新
                height: 50,//可选.默认50.触发下拉刷新拖动距离
                auto:true,//可选,默认false.自动下拉刷新一次
                contentdown : "下拉可以刷新",//可选，在下拉可刷新状态时，下拉刷新控件上显示的标题内容
                contentover : "释放立即刷新",//可选，在释放可刷新状态时，下拉刷新控件上显示的标题内容
                contentrefresh : "正在刷新...",//可选，正在刷新状态时，下拉刷新控件上显示的标题内容
                callback: pulldownRefresh0
            },
            up: {
                //上拉加载
                height: 150,//可选.默认50.触发上拉加载拖动距离
                //auto:true,//可选,默认false.自动上拉加载一次
                contentrefresh: '正在加载...',
                contentnomore:'没有更多数据了',//可选，请求完毕若没有更多数据时显示的提醒内容；
                callback: pullupRefresh0
            }
        });
        //下拉刷新具体业务实现（上架）
        function pulldownRefresh0() {
            setTimeout(function() {
                Count0 = 1;//刷新并显示第一页
                var page = Count0;
                var gType = 1;//代表下拉刷新
                postData.status = 0;
                toList('bill0',page,gType,postData);//具体取数据的方法
            }, 100);
        }
        //上拉加载具体业务实现（上架）
        function pullupRefresh0() {
            setTimeout(function() {
                Count0++;//翻下一页
                var page = Count0;
                var gType =2;//代表上拉加载
                postData.status = 0;
                toList('bill0',page,gType,postData);//具体取数据的方法
            }, 100);
        }


        //未退款订单
        mui('#bill-1').pullRefresh({
            down: {
                //下拉刷新
                height: 50,//可选.默认50.触发下拉刷新拖动距离
                auto:true,//可选,默认false.自动下拉刷新一次
                contentdown : "下拉可以刷新",//可选，在下拉可刷新状态时，下拉刷新控件上显示的标题内容
                contentover : "释放立即刷新",//可选，在释放可刷新状态时，下拉刷新控件上显示的标题内容
                contentrefresh : "正在刷新...",//可选，正在刷新状态时，下拉刷新控件上显示的标题内容
                callback: pulldownRefresh01
            },
            up: {
                //上拉加载
                height: 150,//可选.默认50.触发上拉加载拖动距离
                //auto:true,//可选,默认false.自动上拉加载一次
                contentrefresh: '正在加载...',
                contentnomore:'没有更多数据了',//可选，请求完毕若没有更多数据时显示的提醒内容；
                callback: pullupRefresh01
            }
        });
        //下拉刷新具体业务实现（上架）
        function pulldownRefresh01() {
            setTimeout(function() {
                Count01 = 1;//刷新并显示第一页
                var page = Count01;
                var gType = 1;//代表下拉刷新
                postData.status = -1;
                toList('bill-1',page,gType,postData);//具体取数据的方法
            }, 100);
        }
        //上拉加载具体业务实现（上架）
        function pullupRefresh01() {
            setTimeout(function() {
                Count01++;//翻下一页
                var page = Count01;
                var gType =2;//代表上拉加载
                postData.status = -1;
                toList('bill-1',page,gType,postData);//具体取数据的方法
            }, 100);
        }


        //已退款订单
        mui('#bill-2').pullRefresh({
            down: {
                //下拉刷新
                height: 50,//可选.默认50.触发下拉刷新拖动距离
                auto:true,//可选,默认false.自动下拉刷新一次
                contentdown : "下拉可以刷新",//可选，在下拉可刷新状态时，下拉刷新控件上显示的标题内容
                contentover : "释放立即刷新",//可选，在释放可刷新状态时，下拉刷新控件上显示的标题内容
                contentrefresh : "正在刷新...",//可选，正在刷新状态时，下拉刷新控件上显示的标题内容
                callback: pulldownRefresh02
            },
            up: {
                //上拉加载
                height: 150,//可选.默认50.触发上拉加载拖动距离
                //auto:true,//可选,默认false.自动上拉加载一次
                contentrefresh: '正在加载...',
                contentnomore:'没有更多数据了',//可选，请求完毕若没有更多数据时显示的提醒内容；
                callback: pullupRefresh02
            }
        });
        //下拉刷新具体业务实现（上架）
        function pulldownRefresh02() {
            setTimeout(function() {
                Count02 = 1;//刷新并显示第一页
                var page = Count02;
                var gType = 1;//代表下拉刷新
                postData.status = -2;
                toList('bill-2',page,gType,postData);//具体取数据的方法
            }, 100);
        }
        //上拉加载具体业务实现（上架）
        function pullupRefresh02() {
            setTimeout(function() {
                Count02++;//翻下一页
                var page = Count02;
                var gType =2;//代表上拉加载
                postData.status = -2
                toList('bill-2',page,gType,postData);//具体取数据的方法
            }, 100);
        }

    })

    //接口获取数据并追加到页面
    var toList = function(wList,page,gType,postData) {
        console.log(postData);
        //搜索关键字不能完全为空，否则查询为空
        var url  = "{:url('api/bill/getBillListByPageApi','','',true)}?page="+page;
        mui.ajax({
            url:url,
            data: postData,
            dataType: 'json',//服务器返回json格式数据
            type: 'post',//HTTP请求类型
            timeout: 10000,//超时时间设置为10秒；
            headers: {'Content-Type': 'application/json'},
            //processData:false,
            success: function (data) {

                var newli='';
                if (data.code == 200) {
                    for(var i=0;i<=data.data.data.length-1;i++){
                        var urls = "{:url('bill/billInfo')}" + '/bill_id/' + data.data.data[i].id;
                        newli +=  '<li class="mui-table-view-cell listli"><a href="'+urls+'"><ul class="mui-row table  item-list"><li class="mui-col-sm-10 mui-col-xs-10"><div class="list-cont1">' + data.data.data[i].goods_des + '<p>' + data.data.data[i].create_time + '</p></div></li><li class="mui-col-sm-2 mui-col-xs-2">' + data.data.data[i].balance_pay + '</li></ul></a></li>';
                    }
                    $('#count-'+wList).text(data.data.total);
                }
                if(gType==1){
                    //上拉刷新
                    $("ul.bill"+status).empty().append(newli);
                    mui('#'+wList).pullRefresh().endPulldownToRefresh();
                    mui('#'+wList).pullRefresh().refresh(true);
                    if(newli=='') {
                        $("ul.bill"+status).append('<li class="nodata"><p>没有相关数据哦</p></li>');
                    }
                }else{
                    //下拉加载 gType==2
                    $("ul.bill"+status).append(newli);
                }

                if(newli!=''){
                    mui('#'+wList).pullRefresh().endPullupToRefresh(false);
                }else{
                    mui('#'+wList).pullRefresh().endPullupToRefresh(true);
                }

            },
            error: function(xhr, type, errerThrown) {
                mui.toast('网络异常,请稍候再试');
                mui('#'+wList).pullRefresh().endPullupToRefresh(true);
            }
        });
    };

</script>
</html>