{extend name="layout/common"/}
{block name="css"}
<link rel="stylesheet" href="/static/plugins/datatables/dataTables.bootstrap.css">
{/block}
{block name="page-content"}


<!----------------------------------- 训练营教练工资列表 ： 开始-------------------------------------------->

<div class="row">
  <div class="col-xs-12">
    <div class="box">
      <div class="box-body">
        <div class="dataTables_wrapper form-inline dt-bootstrap">
          <div class="row hotTbHeader">
            <div class="col-sm-12">
              <div class="form-group">
                <!-- /.input group -->
                <label>统计时间：</label>
                <div class="input-group">
                  <input type="text" name="dateYM" class="form-control pull-right" id="dateYM">
                  <div class="input-group-addon">
                    <i class="fa fa-calendar"></i>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <!-- /.input group -->
                <button type="button" class="btn btn-default" id="goSearch">确认查询</button>
              </div>
              <h3 class="totalRight">
                <span><small>本月工资总额：</small><strong class="text-yellow monthIn"></strong></span>
              </h3>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12">
              <div class="box-body">

                <table id="withdrawList" class="table table-bordered table-striped dataTable" role="grid"
                       aria-describedby="example1_info">
                  <thead>
                  <tr>
                    <th>会员/教练</th>
                    <th>收入金额</th>
                    <th>基本收入</th>
                    <th>提成收入</th>
                    <th>收入类型</th>
                    <th>所属训练营</th>
                    <th>上课时间</th>
                    <th>录课时间</th>
                    <th>课时信息</th>
                    <th>结算时间</th>
                  </tr>
                  </thead>
                  <tbody>
                  {volist name="list" id="vol"}
                  <tr>
                    <td>{$vol.member}</td>
                    <td class="sIn">{$vol.salary+$vol.push_salary}</td>
                    <td>{$vol.salary}</td>
                    <td>{$vol.push_salary}</td>
                    <td>
                      {$vol.type}
                    </td>
                    <td>{$vol.camp}</td>
                    <td>{$vol.schedule_time|date='Y-m-d',###}</td>
                    <td>{$vol.schedule_time|date='Y-m-d',###}</td>
                    <td>
                      课程：{$vol.lesson}（单价：{$vol.cost}）<br>
                      班级：{$vol.grade}<br>
                      上课时间：{$vol.lesson_time|date='Y-m-d H:i',###}<br>
                      正式学员人数：{$vol.students}<br>
                      学员名单：<?php $students = unserialize($vol['student_str']);
                        foreach($students as $k =>$v){
                      echo $v['student'].' ';
                      }
                      ?><br>
                      课时工资（供参考）：{$vol.coach_salary}
                    </td>
                    <td>{$vol.s_create_time|date='Y-m-d',###}</td>
                  </tr>
                  {/volist}
                  </tbody>
                </table>

              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- /.box-body -->
    </div>
    <!-- /.box -->
  </div>
  <!-- /.col -->
</div>

<!----------------------------------- 训练营教练工资列表 ： 结束-------------------------------------------->



{/block}




{block name='js'}

<script src="/static/backend/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="/static/backend/plugins/datatables/dataTables.bootstrap.min.js"></script>
<script src="/static/plugins/datepicker/bootstrap-datepicker.js"></script>
<script>

    var currCoachName = '{$camp_member.member}';
    var currMemberID = '{$camp_member.member_id}';
    var currDateYM = localStorage.getItem('currDateYM');

    $(function () {

        $(".content-header h1").html('<i class="fa fa-fw fa-th-large"></i> 平台教练工资');
        //=========================== 初始化数据 ==============================//

        //判断是否有年月的本地存储，没则获取当前月的上一个月
        if(currDateYM==''&&currDateYM!=null) {
            var currDate = new Date();
            var currYear = currDate.getFullYear();
            var currMonth = currDate.getMonth();
            if(currMonth==0){
                currDateYM = parseInt(currYear)-1+'-12';
            }else{
                currMonth = currMonth<10 ? "0"+currMonth:currMonth;
                currDateYM = currYear+'-'+ currMonth ;
            }
            localStorage.setItem('currDateYM',currDateYM);
        }

        //判断是否有指定训练营和教练员的本地存储
        $("input[name=dateYM]").val(currDateYM);

        //隔行变色
        $(".hotTable tbody td ul").find("li:odd").addClass("even");

        //遍历需要统计的数据列，并赋值到对应位置
        var sInCount = 0;
        $(".sIn").each(function () {
            sInCount = sInCount + parseInt($(this).text());
        });
        $(".monthIn").text(sInCount);


        //=========================== 初始化数据 ==============================//


        //选择年月
        $('#dateYM').datepicker({
            language: 'zh-CN',
            autoclose: true,
            format: "yyyy-mm",
            minViewMode: 1,
            todayBtn: true
        });


        //查询统计
        $("#goSearch").on("click", function () {
            var getYM = $("input[name=dateYM]").val();
            if(getYM==""){
                alert("请选择年月份！");
                return false;
            }
            //设置本地存储
            localStorage.setItem('currDateYM',getYM);
            //拆分日期
            var arrYM = getYM.split('-');
            var getLastDate = new Date(arrYM[0],arrYM[1],0);
            var beginDate = arrYM[0]+arrYM[1]+'01';
            var endDate =  arrYM[0]+arrYM[1]+getLastDate.getDate();

            window.location.href="{:url('management/StatisticsCoach/coachSalary')}"+"/monthstart/"+beginDate+"/monthend/"+endDate;
        })


    })



</script>
{/block}