{extend name="layout/common"/}
{block name="css"}
<link rel="stylesheet" href="/static/plugins/datatables/dataTables.bootstrap.css">
{/block}
{block name="page-content"}


<div class="row">
	<div class="col-xs-12">
		<div class="box">
			<div class="box-body">
				<div class="dataTables_wrapper form-inline dt-bootstrap">
					<div class="row hotTbHeader">
						<div class="col-sm-12">
							<div class="form-group">
								<!-- /.input group -->
								<label>统计时间：</label>
								<div class="input-group">
									<input type="text" name="dateYM" class="form-control pull-right" id="dateYM">
									<div class="input-group-addon">
										<i class="fa fa-calendar"></i>
									</div>
								</div>
							</div>
							<div class="form-group">
								<!-- /.input group -->
								<button type="button" class="btn btn-default" id="goSearch">确认查询</button>
							</div>
							<h3 class="totalRight">
								<span><small>本月收入：</small><strong class="text-yellow monthLesson">￥{$income3+$income2}</strong></span>
								<span><small>本月支出：</small><strong class="text-yellow monthEvent">￥{$schedule.s_s_salary+$output_gift+$schedule.s_s_rebate+$other_output}</strong></span>
							</h3>
						</div>
					</div>
				</div>
			</div>
			<!-- /.box-body -->
		</div>
	</div>
</div>

<div class="row">
	<div class="col-md-6">
		<div class="box">
			<div class="box-header with-border">
				<h4> 本月收入</h4>
			</div>
			<div class="box-body">
				<table class="table table-bordered table-striped dataTable" role="grid"
					   aria-describedby="example1_info">
					<thead>
					<tr role="row">
						<th>类型</th>
						<th>金额</th>
					</tr>
					</thead>
					<tbody>
					<tr role="row" class="odd">
						<td>课时费：</td>
						<td>{$income3}</td>
					</tr>
					<tr role="row" class="odd">
						<td>活动费：</td>
						<td>{$income2}</td>
					</tr>
					</tbody>
					<tfoot>
					<tr role="row">
						<th>合计</th>
						<th class="inTotal">￥{$income3+$income2}</th>
					</tr>
					</tfoot>
				</table>
			</div>
		</div>
	</div>

	<div class="col-md-6">
		<div class="box">
			<div class="box-header with-border">
				<h4> 本月支出</h4>
			</div>
			<div class="box-body">
				<table class="table table-bordered table-striped dataTable" role="grid"
					   aria-describedby="example1_info">
					<thead>
					<tr role="row">
						<th>类型</th>
						<th>金额</th>
					</tr>
					</thead>
					<tbody>
					<tr role="row">
						<td>教练工资</td>
						<td>{$schedule.s_s_salary}</td>
					</tr>
					<tr role="row">
						<td>赠课支出</td>
						<td>{$output_gift}</td>
					</tr>
					<tr role="row">
						<td>平台分成</td>
						<td>{$schedule.s_s_rebate}</td>
					</tr>
					<tr role="row">
						<td>其他</td>
						<td>{$other_output}</td>
					</tr>
					</tbody>
					<tfoot>
					<tr role="row">
						<th>合计</th>
						<th class="eIDTotal">￥{$schedule.s_s_salary+$output_gift+$schedule.s_s_rebate+$other_output}</th>
					</tr>
					</tfoot>
				</table>
			</div>
		</div>
	</div>
</div>




{/block}


{block name='js'}

<script src="/static/backend/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="/static/backend/plugins/datatables/dataTables.bootstrap.min.js"></script>
<script src="/static/plugins/datepicker/bootstrap-datepicker.js"></script>
<script>

    var currDateYM = localStorage.getItem('currDateYM');

    $(function () {

        //=========================== 初始化数据 ==============================//

        //判断是否有年月的本地存储，没则获取当前月的上一个月
        if(currDateYM==''||currDateYM==null) {
            var currDate = new Date();
            var currYear = currDate.getFullYear();
            var currMonth = currDate.getMonth();
            if(currMonth==0){
                currDateYM = parseInt(currYear)-1+'-12';
            }else{
                currMonth = currMonth<10 ? "0"+currMonth:currMonth;
                currDateYM = currYear+'-'+ currMonth ;
            }
            localStorage.setItem('currDateYM',currDateYM);
        }

        //判断是否有指定训练营和教练员的本地存储
        $("input[name=dateYM]").val(currDateYM);

        //=========================== 初始化数据 ==============================//



        $('#lessonList,#eventList').DataTable({
            'paging'      : false,
            'lengthChange': false,
            'searching'   : false,
            'ordering'    : true,
            'info'        : false,
            'autoWidth'   : true
        });

        //选择年月
        $('#dateYM').datepicker({
            language: 'zh-CN',
            autoclose: true,
            format: "yyyy-mm",
            minViewMode: 1,
            todayBtn: true
        });


        //查询统计
        $("#goSearch").on("click", function () {
            var getYM = $("input[name=dateYM]").val();
            if(getYM==""){
                alert("请选择年月份！");
                return false;
            }
            //设置本地存储
            localStorage.setItem('currDateYM',getYM);
            //拆分日期
            var arrYM = getYM.split('-');
            var getLastDate = new Date(arrYM[0],arrYM[1],0);
            var beginDate = arrYM[0]+arrYM[1]+'01';
            var endDate =  arrYM[0]+arrYM[1]+getLastDate.getDate();

            window.location.href="{:url('/management/Statistics_Camp/campStatistics/')}"+"/monthstart/"+beginDate+"/monthend/"+endDate;
        })



    })



</script>
{/block}