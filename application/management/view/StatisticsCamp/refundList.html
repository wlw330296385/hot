{extend name="layout/common"/}
{block name="css"}
<link rel="stylesheet" href="/static/plugins/datatables/dataTables.bootstrap.css">
<style>
	#exportExcel:hover small{
		color:#da7908;
		cursor: pointer;
	}
</style>
{/block}
{block name="page-content"}

<!----------------------------------- 训练营学员列表 ： 开始-------------------------------------------->

<div class="row">
	<div class="col-xs-12">
		<div class="box">
			<!--<div class="box-header">-->
			<!--<h3 class="box-title">教练员收益统计</h3>-->
			<!--</div>-->
			<!-- /.box-header -->
			<div class="box-body">
				<div class="dataTables_wrapper form-inline dt-bootstrap">
					<div class="row hotTbHeader">
						<div class="col-sm-12">
							<div class="form-group">
								<!-- /.input group -->
								<label>关键字：</label>
								<div class="input-group radius4">
									<input type="text" name="keyword" class="form-control pull-right radius4" placeholder="学生名/课程名/班级名" style="border:none !important;">
								</div>
							</div>
							<div class="form-group">
								<!-- /.input group -->
								<label>退费状态：</label>
								<div class="input-group radius4">
									<select name="status" class="form-control radius4" style="border:none !important;">
										<option value="1">申请中</option>
										<option value="2">已同意</option>
										<option value="3">已打款</option>
										<option value="-1">已拒绝</option>
										<option value="-2">已撤销</option>
									</select>
								</div>
							</div>
							<div class="form-group">
								<!-- /.input group -->
								<label>退费方式：</label>
								<div class="input-group radius4">
									<select name="refundType" class="form-control radius4" style="border:none !important;">
										<option value=""></option>
										<option value="1">平台原路退回</option>
										<option value="2">银行转账退回</option>
										<option value="3">现金退回</option>
										<option value="3">其他方式</option>
									</select>
								</div>
							</div>
							<div class="form-group">
								<!-- /.input group -->
								<button type="button" class="btn btn-default" id="goSearch">确认查询</button>
							</div>
							<h3 class="totalRight">
								<span><small>退费总数：</small><strong class="text-yellow sAllCount"></strong></span>
							</h3>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<div class="box-body">

								<table id="refundList" class="table table-bordered table-striped dataTable" role="grid" aria-describedby="example1_info">
									<thead>
									<tr>
										<th>状态</th>
										<th>基本信息</th>
										<th>所退课时</th>
										<th>可退金额</th>
										<th>实际退费</th>
										<th>手续费</th>
										<th>申请时间</th>
										<th>操作时间</th>
										<th>操作人</th>
										<th>备注</th>
										<th>操作</th>
									</tr>
									</thead>
									<tbody>
									{volist name = "refundList" id="vol"}
									<tr>
										<td>{$vol.status}</td>
										<td>
											学生编号：{$vol.student_id}<br />
											学生姓名：{$vol.student}<br />
											所退课程：{$vol.bill.goods}<br />
											退费原因：{$vol.reason}<br />
											退费方式：{$vol.refund_type}
										</td>
										<td>{$vol.total}</td>
										<td>{$vol.refundamount}</td>
										<td>{$vol.refund}</td>
										<td>{$vol.refund_fee}</td>
										<td>{$vol.create_time}</td>
										<td>{$vol.process_time}</td>
										<td>{$vol.process}</td>
										<td>{$vol.remarks}</td>
										<td><a href="#" class="btn btn-xs btn-info rInfo" data-refund_id="{$vol.id}"><i class="fa fa-inbox"></i> 立即处理</a></td>
									</tr>
									{/volist}
									</tbody>
								</table>

							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- /.box-body -->
		</div>
		<!-- /.box -->
	</div>
	<!-- /.col -->
</div>

<!----------------------------------- 训练营学员列表 ： 结束-------------------------------------------->



<!-- Modal : 学员档案 -->
<div class="modal fade" id="refundInfoModal">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="coachModalLabel">退费订单处理</h4>
			</div>
			<div class="modal-body">
				<iframe id="refundInfoframe" width="100%" height="570" frameborder="0"></iframe>
			</div>
		</div>
	</div>
</div>


{/block}


{block name='js'}

<script src="/static/backend/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="/static/backend/plugins/datatables/dataTables.bootstrap.min.js"></script>
<script>

    var currDateYM = localStorage.getItem('currDateYM');
    var currRefundType = localStorage.getItem('currRefundType');
    var currRefundKeyword = localStorage.getItem('currKeyword');

    $(function () {

        $('#refundList').DataTable({
            'paging'      : true,
            'lengthChange': false,
            'searching'   : false,
            'ordering'    : true,
            'info'        : true,
            'autoWidth'   : true
        });

        //=========================== 初始化数据 ==============================//


        //判断是否有指定训练营和教练员的本地存储
        $("input[name=keyword]").val(currRefundKeyword);
        if(currRefundType!=''&&currRefundType!=null){
            $('select[name="refundType"]').find('option[value="'+currRefundType+'"]').prop("selected", true);
        }

        //=========================== 初始化数据 ==============================//


        //查询统计
        $("#goSearch").on("click", function () {
            var refundType = $("select[name=refundType]").val();
            var keyword = $("input[name=keyword]").val();
            var linkPram = '';
            if(refundType==""&&keyword==""){
                alert("请填写或选择其中一项！");
                return false;
            }

            if(refundType!=""&&refundType!=null){
                linkPram = linkPram+"/type/"+refundType+"/";
            }
            if(keyword!=""&&keyword!=null){
                linkPram = linkPram+"/keyword/"+keyword+"/";
            }

            //设置本地存储
            localStorage.setItem('currDateYM',getYM);
            localStorage.setItem('currRefundType',currRefundType);
            localStorage.setItem('currKeyword',keyword);


            window.location.href="{:url('management/Student/studentList')}"+linkPram;
        })


        $(".rInfo").click(function(){
            var getSID = $(this).attr("data-refund_id");
            var frameSrc = "{:url('management/StatisticsCamp/refundDeal')}"+"/refund_id/"+getSID;
            $("#refundInfoframe").attr("src", frameSrc);
            $('#refundInfoModal').modal({ show: true, backdrop: 'static' });
        });


    });

    function closeModel(){
        $('#refundInfoModal').modal('hide');
	}

</script>

{/block}


