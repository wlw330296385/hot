{extend name="layout/common"/}

{block name="page-content"}


<!----------------------------------- 训练营（课时结算版）资金账单 ： 开始-------------------------------------------->

<div class="row" style="width:1200px">
	<div class="col-xs-12">
		<div class="box">
			<!--<div class="box-header">-->
			<!--<h3 class="box-title">教练员收益统计</h3>-->
			<!--</div>-->
			<!-- /.box-header -->
			<div class="box-body">
				<div class="dataTables_wrapper form-inline dt-bootstrap">
					<div class="row hotTbHeader">
						<div class="col-sm-12">
							<div class="form-group">
								<!-- /.input group -->
								<label>统计时间：</label>
								<div class="input-group">
									<input type="text" name="dateYM" class="form-control pull-right" id="dateYM">
									<div class="input-group-addon">
										<i class="fa fa-calendar"></i>
									</div>
								</div>
							</div>
							<div class="form-group">
								<!-- /.input group -->
								<button type="button" class="btn btn-default" id="goSearch">确认查询</button>
							</div>
							<h3 class="totalRight">
								<span><small>本月收入：</small><strong class="text-yellow monthIn"></strong></span>
								<span><small>支出：</small><strong class="text-yellow monthOut"></strong></span>
								<span><small>课时消费：</small><strong class="text-yellow monthXF"></strong></span>
								<span><small>提现：</small><strong class="text-yellow monthTX"></strong></span>
							</h3>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<table id="example3" class="table table-bordered table-striped dataTable hotTable">
								<thead>
								<tr role="row">
									<th>结算日期</th>
									<th class="mixTitle">
										<ul class="dataCol-1">
											<li style="text-align: center">支出</li>
											<li>
												<ul class="dataCol-3">
													<li>平台分成</li>
												</ul>
												<ul class="dataCol-3">
													<li>教练工资</li>
												</ul>
												<ul class="dataCol-3">
													<li>购买赠课</li>
												</ul>
											</li>
										</ul>
									</th>
									<th class="mixTitle">
										<ul class="dataCol-1">
											<li style="text-align: center">收入</li>
											<li>
												<ul class="dataCol-2">
													<li>课时</li>
												</ul>
												<ul class="dataCol-2">
													<li>活动</li>
												</ul>
											</li>
										</ul>
									</th>
									<th>课时总价</th>
									<th>提现</th>
									<th>余额</th>
								</tr>
								</thead>
								<tbody>
								<tr role="row">
									<td>
										<ul class="dateList dataCol-1">
											{volist name='list1' id='vol'}
											<li>{$key}</li>
											{/volist}
											<li>本月小计</li>
										</ul>
									</td>
									<td>
										<ul class="dataCol-3 colCount" linkTo="lessonSchedule">
											{volist name='list4' id='vol'}
											<li><span>{$vol.s_s_rebate}</span></li>
											{/volist}
											<li class="colTotal" id="hotOut"><</li>
										</ul>
										<ul class="dataCol-3 colCount" linkTo="lessonSchedule">
											{volist name='list4' id='vol'}
											<li><span>{$vol.s_s_salary}</span></li>
											{/volist}
											<li class="colTotal" id="coachOut"><</li>
										</ul>
										<ul class="dataCol-3 colCount" linkTo="campGift">
											{volist name='list1' id='vol'}
											<li><span>{$vol.s_output}</span></li>
											{/volist}
											<li class="colTotal" id="giftOut"><</li>
										</ul>
									</td>
									<td>
										<ul class="dataCol-2 colCount" linkTo="lessonSchedule">
											{volist name='list3' id='vol'}
											<li><span>{$vol.s_income}</span></li>
											{/volist}
											<li class="colTotal" id="scheduleIn"></li>
										</ul>
										<ul class="dataCol-2 colCount" linkTo="campBillList/goods_type/2">
											{volist name='list2' id='vol'}
											<li><span>{$vol.s_income}</span></li>
											{/volist}
											<li class="colTotal" id="eventIn"></li>
										</ul>
									</td>
									<td>
										<ul class="dataCol-1 colCount" linkTo="lessonSchedule">
											{volist name='list3' id='vol'}
											<li><span>{$vol.s_schedule_income}</span></li>
											{/volist}
											<li class="colTotal" id="scheduleXF"></li>
										</ul>
									</td>
									<td>
										<ul class="dataCol-1 colCount" linkTo="campWithdraw">
											{volist name='list_1' id='vol'}
											<li><span>{$vol.s_output}</span></li>
											{/volist}
											<li class="colTotal" id="withdraw"></li>
										</ul>
									</td>
									<td>
										<ul class="dataCol-1">
											{volist name='financeList' id='vol'}
											<li>{$vol.e_balance}</li>
											{/volist}
										</ul>
									</td>
								</tr>
								</tbody>
								<tfoot>
								<tr role="row">
									<th>本月合计</th>
									<th>总支出：<span class="monthOut"></span></th>
									<th>总收入：<span class="monthIn"></span></th>
									<th>总课时消费：<span class="monthXF"></span></th>
									<th>总提现：<span class="monthTX"></span></th>
									<th>余额：</th>
								</tr>
								</tfoot>
							</table>
						</div>
					</div>
				</div>
			</div>
			<!-- /.box-body -->
		</div>
		<!-- /.box -->
	</div>
	<!-- /.col -->
</div>

<!----------------------------------- 训练营（课时结算版）资金账单 ： 结束-------------------------------------------->




{/block}




{block name='js'}

<script src="/static/plugins/datepicker/bootstrap-datepicker.js"></script>
<script>

    var currDateYM = localStorage.getItem('currDateYM');

    $(function () {

        //=========================== 初始化数据 ==============================//

        //判断是否有年月的本地存储，没则获取当前月的上一个月
        if(currDateYM==''||currDateYM==null) {
            var currDate = new Date();
            var currYear = currDate.getFullYear();
            var currMonth = currDate.getMonth();
            if(currMonth==0){
                currDateYM = parseInt(currYear)-1+'-12';
            }else{
                currMonth = currMonth<10 ? "0"+currMonth:currMonth;
                currDateYM = currYear+'-'+ currMonth ;
            }
            localStorage.setItem('currDateYM',currDateYM);
        }

        //判断是否有指定训练营和教练员的本地存储
        $("input[name=dateYM]").val(currDateYM);

        //隔行变色
        $(".hotTable tbody td ul").find("li:odd").addClass("even");


        //遍历需要统计的数据列，并赋值到对应位置
        $(".colCount").each(function () {
            var liNum = 0;
            $(this).find("li").not(".colTotal").each(function () {
                liNum = liNum + parseFloat($(this).text());
            });
            $(this).find("li.colTotal").text(liNum.toFixed(2));
        });

        var mOut = parseFloat($("#hotOut").text())+parseFloat($("#coachOut").text())+parseFloat($("#giftOut").text());
        var mIn = parseFloat($("#scheduleIn").text())+parseFloat($("#eventIn").text());
        $(".monthIn").text(mIn.toFixed(2));
        $(".monthOut").text(mOut.toFixed(2));
        $(".monthXF").text($("#scheduleXF").text());
        $(".monthTX").text($("#withdraw").text());


        //=========================== 初始化数据 ==============================//

        //选择年月
        $('#dateYM').datepicker({
            language: 'zh-CN',
            autoclose: true,
            format: "yyyy-mm",
            minViewMode: 1,
            todayBtn: true
        });


        //查询统计
        $("#goSearch").on("click", function () {
            var getYM = $("input[name=dateYM]").val();
            if(getYM==""){
                alert("请选择年月份！");
                return false;
            }
            //设置本地存储
            localStorage.setItem('currDateYM',getYM);
            //拆分日期
            var arrYM = getYM.split('-');
            var getLastDate = new Date(arrYM[0],arrYM[1],0);
            var beginDate = arrYM[0]+arrYM[1]+'01';
            var endDate =  arrYM[0]+arrYM[1]+getLastDate.getDate();

            window.location.href="{:url('management/StatisticsCamp/campBill')}"+"/monthstart/"+beginDate+"/monthend/"+endDate;
        });

        //点击链接到详情页面
        $(".colCount li span").on("click", function () {
            var getLink = $(this).parent().parent().attr("linkTo");
            var getLiIndex = $(this).parent().index();
            var getDate = $(".dateList li").eq(getLiIndex).text();
            localStorage.removeItem('currLessonName');
            localStorage.removeItem('currLessonID');
            localStorage.removeItem('currCoachName');
            localStorage.removeItem('currMemberID');
            if(getLink=="campBillList/goods_type/2"){
                localStorage.setItem('currGoodTypeID','2');
			}
            window.open("/management/Statistics_Camp/"+getLink+"/monthstart/"+getDate+"/monthend/"+getDate);
        })

    });


</script>
{/block}