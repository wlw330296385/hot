{extend name="layout/common"/}
{block name="css"}
{/block}
{block name="page-content"}

<!----------------------------------- 训练营提现列表 ： 开始-------------------------------------------->

<div class="row">
	<div class="col-xs-12">
		<div class="box">
			<div class="box-body">
				<div class="dataTables_wrapper form-inline dt-bootstrap">
					<div class="row hotTbHeader">
						<div class="col-sm-12">
							<div class="form-group">
								<!-- /.input group -->
								<label>查询时间：</label>
								<div class="input-group">
									<input type="text" name="dateYM" class="form-control pull-right" id="dateYM">
									<div class="input-group-addon">
										<i class="fa fa-calendar"></i>
									</div>
								</div>
							</div>
							<div class="form-group">
								<!-- /.input group -->
								<button type="button" class="btn btn-default" id="goSearch">确认查询</button>
							</div>
							<h3 class="totalRight">

								<span>
                                    <small>提现总额：</small><strong class="text-yellow monthIn"></strong>

                                    当前训练营余额:{$campInfo.balance}
                                    <button type="button" class="btn btn-info col-sm-6" id="goWithdraw">申请提现</button>
                                </span>
							</h3>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<div class="box-body">

								<table id="withdrawList" class="table table-bordered table-striped dataTable" role="grid"
									   aria-describedby="example1_info">
									<thead>
									<tr>
										<th>ID</th>
										<th>提现金额</th>
										<th>冻结金额</th>
										<th>会员</th>
										<th>真实姓名</th>
										<th>提现账号</th>
										<th>手续费</th>
										<th>联系电话</th>
										<th>申请时间</th>
										<th>备注</th>
										<th>状态</th>
                                        <th>系统回复</th>
									</tr>
									</thead>
									<tbody>
									{volist name='list' id="vol"}
    									<tr>
                                            <td>{$i}</td>
    										<td>{$vol.withdraw}</td>
                                            <td>{$vol.buffer}</td>
                                            <td>{$vol.member}</td>
                                            <td>{$vol.account}</td>
                                            <td>{$vol.bank_card}</td>
                                            <td>{$vol.camp_withdraw_fee}</td>
                                            <td>{$vol.telephone}</td>
                                            <td>{$vol.create_time}</td>
                                            <td>{$vol.remarks}</td>
                                            <td>{$vol.status}</td>
                                            <td>{$vol.system_remarks}</td>

    									</tr>
									{/volist}
									</tbody>
								</table>

							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- /.box-body -->
		</div>
		<!-- /.box -->
	</div>
	<!-- /.col -->
</div>

<!----------------------------------- 训练营提现列表 ： 结束-------------------------------------------->





{/block}


{block name='js'}
<script src="/static/plugins/datepicker/bootstrap-datepicker.js"></script>
<script>

    var currDateYM = localStorage.getItem('currDateYM');

    $(function () {


        $('#withdrawList').DataTable({
            'paging'      : true,
            'lengthChange': false,
            'searching'   : false,
            'ordering'    : true,
            'info'        : true,
            'autoWidth'   : true
        });

        //=========================== 初始化数据 ==============================//


        //判断是否有年月的本地存储，没则获取当前月的上一个月
        if(currDateYM==''&&currDateYM!=null) {
            var currDate = new Date();
            var currYear = currDate.getFullYear();
            var currMonth = currDate.getMonth();
            if(currMonth==0){
                currDateYM = parseInt(currYear)-1+'-12';
            }else{
                currMonth = currMonth<10 ? "0"+currMonth:currMonth;
                currDateYM = currYear+'-'+ currMonth ;
            }
            localStorage.setItem('currDateYM',currDateYM);
        }

        //遍历需要统计的数据列，并赋值到对应位置
        var wInCount = 0;
        $(".wIn").each(function () {
            wInCount = wInCount + parseFloat($(this).text());
        });
        $(".monthIn").text(wInCount.toFixed(2));

        //隔行变色
        $(".hotTable tbody td ul").find("li:even").addClass("even");

        //判断是否有指定训练营的本地存储
        $("input[name=dateYM]").val(currDateYM);

        //=========================== 初始化数据 ==============================//

        //选择年月
        $('#dateYM').datepicker({
            language: 'zh-CN',
            autoclose: true,
            format: "yyyy-mm",
            minViewMode: 1,
            todayBtn: true
        });


        //查询统计
        $("#goSearch").on("click", function () {
            var getYM = $("input[name=dateYM]").val();
            if(getYM==""){
                alert("请选择年月份！");
                return false;
            }
            //设置本地存储
            localStorage.setItem('currDateYM',getYM);
            //拆分日期
            var arrYM = getYM.split('-');
            var getLastDate = new Date(arrYM[0],arrYM[1],0);
            var beginDate = arrYM[0]+arrYM[1]+'01';
            var endDate =  arrYM[0]+arrYM[1]+getLastDate.getDate();

            window.location.href="{:url('management/StatisticsCamp/campWithdraw')}"+"/monthstart/"+beginDate+"/monthend/"+endDate;
        })


        $('#goWithdraw').on('click',function(){

            if("{$camp_member.type}"!=4){
                alert('权限不足');
                return false;
            }

            layui.use('layer', function() {
                var layer = layui.layer;
                    layer.open({
                    skin:'layui-layer-lan',
                    type: 2,
                    title: '训练营余额提现',
                    shadeClose: true,
                    shade: false,
                    maxmin: true, //开启最大化最小化按钮
                    area: ['900px', '650px'],
                    content: "{:url('withdraw')}"
                });
            });
        })

    })


</script>

{/block}


