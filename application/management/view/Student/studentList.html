{extend name="layout/common"/}
{block name="css"}
<link rel="stylesheet" href="/static/plugins/datatables/dataTables.bootstrap.css">
<style>
	#exportExcel:hover small{
		color:#da7908;
		cursor: pointer;
	}
</style>
{/block}
{block name="page-content"}

<!----------------------------------- 训练营学员列表 ： 开始-------------------------------------------->

<div class="row">
	<div class="col-xs-12">
		<div class="box">
			<!--<div class="box-header">-->
			<!--<h3 class="box-title">教练员收益统计</h3>-->
			<!--</div>-->
			<!-- /.box-header -->
			<div class="box-body">
				<div class="dataTables_wrapper form-inline dt-bootstrap">
					<div class="row hotTbHeader">
						<form method="post">
						<div class="col-sm-12">
							<div class="form-group">
								<!-- /.input group -->
								<label>关键字：</label>
								<div class="input-group radius4">
									<input type="text" name="keyword" class="form-control pull-right radius4" placeholder="学生名/课程名" style="border:none !important;">
								</div>
							</div>
							<div class="form-group">
								<!-- /.input group -->
								<label>状态：</label>
								<div class="input-group radius4">
									<select name="status" class="form-control radius4" style="border:none !important;">
										<option value=""></option>
										<option value="1">正常</option>
										<option value="4">毕业</option>
										<option value="-1">离营</option>
									</select>
								</div>
							</div>
							<div class="form-group">
								<!-- /.input group -->
								<label>类型：</label>
								<div class="input-group radius4">
									<select name="type" class="form-control radius4" style="border:none !important;">
										<option value=""></option>
										<option value="1">正式生</option>
										<option value="2">体验生</option>
									</select>
								</div>
							</div>
							<div class="form-group">
								<!-- /.input group -->
								<button type="submit" class="btn btn-default" id="goSearch">确认查询</button>
							</div>
						</form>
							<h3 class="totalRight">
								<span><small>学员总数：</small><strong class="text-yellow sAllCount"></strong></span>
								<span><small>学员报课总数：</small><strong class="text-yellow sLessonCount"></strong></span>
								<span id="exportExcel"><small><i class="fa fa-file-excel-o"></i> &nbsp;导出 Excel</small></span>
							</h3>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<div class="box-body">

								<table id="billList" class="table table-bordered table-striped dataTable" role="grid" aria-describedby="example1_info">
									<thead>
									<tr>
										<th>学生ID</th>
										<th>姓名</th>
										<th>课程名称</th>
										<th>总交费</th>
										<th>总课时</th>
										<th>已上课时</th>
										<th>剩余课时</th>
										<th>类型</th>
										<th>状态</th>
										<th>查看详情</th>
										<th>催费提醒</th>
									</tr>
									</thead>
									<tbody>
									{volist name="studentList" id="vol"}
									<tr>
										<td>{$vol.student_id}</td>
										<td>{$vol.student}</td>
										<td>{$vol.lesson}</td>
										<td>{$vol.s_balance_pay}</td>
										<td>{$vol.total_schedule}</td>
										<td>{$vol.total_schedule - $vol.rest_schedule}</td>
										<td>{$vol.rest_schedule}</td>
										<td>
											{if $vol.type ==1}
												正式生
											{else /}
												体验生
											{/if}
										</td>
										<td>{switch $vol.status}
											{case 1}在学{/case}
											{case 2}已退款退学{/case}
											{case 4}已毕业{/case}
											{case -1}已离赢{/case}
											{default /}{$vol.status}
											{/switch}
										</td>
										<td><a class="btn btn-xs btn-info sInfo" data-student_id="{$vol['student_id']}"><i class="fa fa-inbox"></i> 查看详情</a></td>
										<td><button  class="btn btn-xs btn-default sendTip" data-lesson="{$vol.lesson}" data-member_id = "{$vol['member_id']}" data-total_schedule = "{$vol.total_schedule}" data-rest_schedule = "{$vol.rest_schedule}"><i class="fa fa-inbox"></i> 发送续费提醒</a></button>
									</tr>
									{/volist}
									</tbody>
								</table>

							</div>
						</div>
					</div>


					<!-- 分页页码区域 -->
					<div class="row">
						<div class="col-sm-5">
							<div class="dataTables_info" id="billList_info" role="status" aria-live="polite">显示第 1 至 10 项结果，共 49 项</div>
						</div>
						<div class="col-sm-7">
							<!-- <div class="dataTables_paginate paging_simple_numbers" id="billList_paginate">
								<ul class="pagination">
									<li class="paginate_button previous disabled" id="billList_previous">
										<a href="#" aria-controls="billList" data-dt-idx="0" tabindex="0">上页</a>
									</li>
									<li class="paginate_button active">
										<a href="#" aria-controls="billList" data-dt-idx="1" tabindex="0">1</a>
									</li>
									<li class="paginate_button ">
										<a href="#" aria-controls="billList" data-dt-idx="2" tabindex="0">2</a>
									</li>
									<li class="paginate_button ">
										<a href="#" aria-controls="billList" data-dt-idx="3" tabindex="0">3</a>
									</li>
									<li class="paginate_button ">
										<a href="#" aria-controls="billList" data-dt-idx="4" tabindex="0">4</a>
									</li>
									<li class="paginate_button next" id="billList_next">
										<a href="#" aria-controls="billList" data-dt-idx="6" tabindex="0">下页</a>
									</li>
								</ul>
							</div> -->
							{$studentList->render()}
						</div>
					</div>
					<!-- 分页页码 -->


				</div>
			</div>
			<!-- /.box-body -->
		</div>
		<!-- /.box -->
	</div>
	<!-- /.col -->
</div>

<!----------------------------------- 训练营学员列表 ： 结束-------------------------------------------->



<!-- Modal : 学员档案 -->
<div class="modal fade" id="studentInfoModal">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="coachModalLabel">学员档案</h4>
			</div>
			<div class="modal-body">
				<iframe id="studentInfoframe" width="100%" height="500" frameborder="0"></iframe>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
			</div>
		</div>
	</div>
</div>


{/block}


{block name='js'}
<script src="/static/frontend/js/mui.min.js"></script>
<script src="/static/frontend/js/wooApi.js"></script>
<script src="/static/frontend/js/smsCode.js"></script>
<!-- <script src="/static/backend/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="/static/backend/plugins/datatables/dataTables.bootstrap.min.js"></script> -->
<script>

    var currStatus = localStorage.getItem('currStatus');
    var currType = localStorage.getItem('currType');
    var currKeyword = localStorage.getItem('currKeyword');

    $(function () {
        $(".content-header h1").html('<i class="fa fa-fw fa-th-large"></i> 训练营学员列表');

        // $('#billList').DataTable({
        //     'paging'      : true,
        //     'lengthChange': false,
        //     'searching'   : false,
        //     'ordering'    : true,
        //     'info'        : true,
        //     'autoWidth'   : true
        // });

        //=========================== 初始化数据 ==============================//

        //隔行变色
        $(".hotTable tbody td ul").find("li:even").addClass("even");


        //判断是否有指定训练营和教练员的本地存储
        $("input[name=keyword]").val(currKeyword);
        if(currType!=''&&currType!=null){
            $('select[name="type"]').find('option[value="'+currType+'"]').prop("selected", true);
        }
        if(currStatus!=''&&currStatus!=null){
            $('select[name="status"]').find('option[value="'+currStatus+'"]').prop("selected", true);
        }

        //=========================== 初始化数据 ==============================//



        $(".sInfo").click(function(){
            var getSID = $(this).attr("data-student_id");
            var frameSrc = "{:url('management/Student/studentInfo')}"+"/student_id/"+getSID+"/camp_id/{$campInfo.id}";
            $("#studentInfoframe").attr("src", frameSrc);
            $('#studentInfoModal').modal({ show: true, backdrop: 'static' });
        });










        //发送提醒
        var isTip = true;
        // 发送模板消息
        $(document).on("click", '.sendTip', function () {
            var aa = $(this);
            var member_id = aa.attr('data-member_id');

            var url = "{:url('api/message/sendMessageApi')}/member_id/" + member_id;
            var total_schedule = aa.attr('data-total_schedule');
            var rest_schedule = aa.attr('data-rest_schedule');
            var lesson = aa.attr('data-lesson');
            var messageData = {
                touser: '',
                template_id: "{:config('wxTemplateID.scheduleExpend')}",
                url: "{:url('frontend/message/index','','',true)}",
                topcolor: "#FF0000",
                data: {
                    'first': { 'value': '您好，您所报的（'+lesson+'）只剩下' + rest_schedule + '节课，请及时续费，谢谢。' },
                    'keyword1': { 'value': total_schedule },
                    'keyword2': { 'value': (total_schedule - rest_schedule) },
                    'keyword3': { 'value': rest_schedule },
                    'remark': { 'value': '如果您想续费,请重新购买课程' }
                }

            };
            var saveData = {
                title: '课时提醒',
                content: '您好，您所报的（'+lesson+'）只剩下' + rest_schedule + '节课，请及时续费，谢谢。',
                url: "{:url('frontend/message/index','','',true)}",
                member_id: member_id
            };

            var postParam = {
                messageData: JSON.stringify(messageData),
                saveData: JSON.stringify(saveData),
            }
            sendMsg(aa, url, postParam);
        })

    })

</script>

{/block}


