{extend name="layout/common" /}

{block name="page-content"}
<div class="row">
    

    <div class="col-sm-12 col-md-6">
        <div class="box box-info">
            <div class="box-header with-border">
                <h3 class="box-title">裁判员 详细资料</h3>
            </div>
            <form class="form-horizontal referee-form" method="post" action="">
                <input type="hidden" id="referee-id" name="referee_id" value="{$refereeInfo.id}">
                <input type="hidden" name="member_id" value="{$refereeInfo.member_id}">
                {:token()}
                <div class="box-body">
                    <div class="form-group">
                        <div class="col-sm-2 control-label">裁判员姓名</div>
                        <div class="col-sm-5">
                            {$refereeInfo.referee}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-2 control-label">性别</div>
                        <div class="col-sm-5">
                            {switch name="refereeInfo.member.sex"}
                            {case value="1"}男{/case}
                            {case value="2"}女{/case}
                            {default/}未知
                            {/switch}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">电话号码</div>
                        <div class="col-sm-5">
                            {$refereeInfo.member.telephone}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">接单地区</div>
                        <div class="col-sm-5">
                            {$refereeInfo.province}-{$refereeInfo.city}-{$refereeInfo.area}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">裁判等级</div>
                        <div class="col-sm-5">
                            {$refereeInfo.level_text}
                            <input type="hidden" name="" value="{$refereeInfo.level}">
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">执裁经验</div>
                        <div class="col-sm-5">
                            {$refereeInfo.referee_year}（年）
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">执裁单场费用</div>
                        <div class="col-sm-5">
                            {$refereeInfo.appearance_fee}（元）
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">个人形象照</div>
                        <div class="col-sm-5">
                            {notempty name="refereeInfo.portraits"}
                            <a href="{$refereeInfo.portraits}" target="_blank">
                            <img src="{$refereeInfo.portraits}" class="img-thumbnail" alt="">
                            </a>
                            {/notempty}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">注册时间</div>
                        <div class="col-sm-5">
                            {$refereeInfo.create_time}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">系统备注</div>
                        <div class="col-sm-5">
                            <textarea  class="form-control" name="system_remarks" rows="3">{$refereeInfo.system_remarks}</textarea>
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">状态</div>
                        <div class="col-sm-5">
                            {$refereeInfo.status}
                        </div>
                        <div class="col-sm-5">
                        </div>
                    </div>
                </div>
                <div class="box-footer">
                    <div class="form-group">
                        <div class="col-sm-2"></div>
                        <div class="col-sm-10">
                            {neq name="refereeInfo.status_num" value="1"}
                            <button type="button" class="btn btn-success" onclick="check(1);">审核通过</button>
                            <button type="button" class="btn btn-warnin" onclick="check(2);">审核不通过</button>
                            {/neq}
                            <!--<button type="sumit" class="btn btn-info" onclick="check(0);">修改信息</button>-->
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="col-sm-12 col-md-6">
        <div class="box box-danger">
            <div class="box-header with-border">
                <h3 class="box-title">证件资料</h3>
            </div>
            <form class="form-horizontal refereeInfo-form" method="post" action="{:url('admin/referee/updateReferee')}">
                <input type="hidden" id="refereeInfo-id" name="id" value="{$refereeInfo.id}">
                <div class="box-body">
                    <div class="form-group">
                        <div class="col-sm-2 control-label">资质证书</div>
                        <div class="col-sm-5">
                            {if condition="$license"}
                            <a href="{$license.photo_positive}" target="_blank">
                            <img src="{$license.photo_positive}" class="img-thumbnail" alt="">
                            </a>
                            </a>
                            {/if}

                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">身份证</div>
                        {if condition="$idcard"}
                        <div class="col-sm-5">
                            {notempty name="$idcard.photo_positive"}
                            <a href="{$idcard.photo_positive}" target="_blank">
                            <img src="{$idcard.photo_positive}" class="img-thumbnail" alt="">
                            </a>
                            {/notempty}
                            <p>身份证：{$idcard.cert_no}</p>
                        </div>
                        <div class="col-sm-5">
                            {notempty name="$idcard.photo_back"}
                            <a href="{$idcard.photo_back}" target="_blank">
                            <img src="{$idcard.photo_back}" class="img-thumbnail" alt="">
                            </a>
                            {/notempty}
                        </div>
                        {/if}
                    </div>
                </div>
             
            </form>
        </div>
    </div>
</div>
{/block}

{block name="js"}
<script>
    "use strict";
    function check(status) {
        var dataid = $('#referee-id').val();
        var system_remarks = $("textarea[name='system_remarks']").val();
        var member_id = $("input[name=member_id]").val();
        switch ( status ) {
            case 1:  {
                var msg = '确定审核通过?';
                if ( confirm(msg) === true ) {
                    sendpost(dataid, status, '', member_id);
                }
                break;
            }
            case 2: {
                var msg = '确定审核不通过?';
                if ( confirm(msg) === true ) {
                    if (system_remarks == "") {
                        alert('请在系统备注填写不通过原因');
                        return;
                    }
                    sendpost(dataid, status, system_remarks, member_id);
                }
                break;
            }
            default: {
                $('.referee-form').submit();
                break;
            }

        }
    }

    function sendpost(dataid, status, system_remarks, member_id) {
        var serverurl = "{:url('referee/updateRefereeStatus')}";
        $.post(serverurl, {
            id: dataid,
            status: status,
            system_remarks: system_remarks,
            member_id: member_id
        }, function(res) {
            console.log(res);
            alert(res.msg);
            if (res.status) {
                location.href = "{:url('referee/index')}";
            } else {
                location.reload();
            }
        }, 'json');
    }
</script>
{/block}