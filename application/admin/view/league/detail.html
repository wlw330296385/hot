{extend name="layout/common" /}

{block name="page-content"}
<div class="row">
    <div class="col-sm-12 col-md-6">
        <div class="box box-info">
            <div class="box-header with-border">
                <h3 class="box-title">联赛详细</h3>
            </div>
            <form class="form-horizontal " method="post" action="">
                <input type="hidden" id="id" name="id" value="{$matchInfo.id}">
                {:token()}
                <div class="box-body">
                    <div class="form-group">
                        <div class="col-sm-2 control-label">联赛名称</div>
                        <div class="col-sm-5">
                            {$matchInfo.name}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">联赛负责人</div>
                        <div class="col-sm-5">
                            {$matchInfo.charge_name}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">联赛类型</div>
                        <div class="col-sm-5">
                            {$matchInfo.type}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">赛制</div>
                        <div class="col-sm-5">
                            {$matchInfo.format}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">联赛创建人</div>
                        <div class="col-sm-5">
                            {$matchInfo.member}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">联赛开始时间</div>
                        <div class="col-sm-5">
                            {$matchInfo.start_time}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">联赛结束时间</div>
                        <div class="col-sm-5">
                            {$matchInfo.end_time}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">所在地区</div>
                        <div class="col-sm-5">
                            {$matchInfo.province}-{$matchInfo.city}-{$matchInfo.area}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">具体地址</div>
                        <div class="col-sm-5">
                            {$matchInfo.court}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">参赛球队数上限</div>
                        <div class="col-sm-5">
                            {$matchInfo.teams_max} (0为不限)
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">参赛费用</div>
                        <div class="col-sm-5">
                            {$matchInfo.entry_fees}（元）
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">参赛保证金</div>
                        <div class="col-sm-5">
                            {$matchInfo.deposit}（元）
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">封面图</div>
                        <div class="col-sm-5">
                            {empty name="matchInfo.cover"}暂无
                            {else/}
                            <img src="{$matchInfo.cover}" class="img-thumbnail" alt="logo">
                            {/empty}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">个人备注</div>
                        <div class="col-sm-5">
                            {$matchInfo.remarks}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">联赛审核状态</div>
                        <div class="col-sm-5">
                            {$matchInfo.status}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">联赛注册时间</div>
                        <div class="col-sm-5">
                            {$matchInfo.create_time}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">平台备注</div>
                        <div class="col-sm-5">
                            <textarea  class="form-control" name="system_remarks" rows="3">{$matchInfo.system_remarks}</textarea>
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                </div>
                <div class="box-footer">
                    <div class="form-group">
                        <div class="col-sm-2"></div>
                        <div class="col-sm-10">
                            {eq name="matchInfo.status_num" value="0"}
                            <button type="button" class="btn btn-success" onclick="check(1);">审核通过</button>
                            <button type="button" class="btn btn-default" onclick="check(2);">审核不通过</button>
                            {else/}
                            {/eq}
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    {if condition="$matchInfo['match_org']"}
    <!--联赛组织信息-->
    <div class="col-sm-12 col-md-6">
        <div class="box box-info">
            <div class="box-header with-border">
                <h3 class="box-title">联赛组织信息</h3>
            </div>
            <form class="form-horizontal" method="post" action="">
                <div class="box-body">
                    <div class="form-group">
                        <div class="col-sm-2 control-label">联赛组织</div>
                        <div class="col-sm-5">
                            {$matchInfo.match_org.name}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">创建会员</div>
                        <div class="col-sm-5">
                            {$matchInfo.match_org.member}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">电话号码</div>
                        <div class="col-sm-5">
                            {$matchInfo.match_org.contact_tel}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">所在地区</div>
                        <div class="col-sm-5">
                            {$matchInfo.match_org.province}-{$matchInfo.match_org.city}-{$matchInfo.match_org.area}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">具体地址</div>
                        <div class="col-sm-5">
                            {$matchInfo.match_org.address}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">LOGO</div>
                        <div class="col-sm-5">
                            <img src="{$matchInfo.match_org.logo}" class="img-thumbnail" alt="logo">
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">封面图</div>
                        <div class="col-sm-5">
                            <img src="{$matchInfo.match_org.cover}" class="img-thumbnail" alt="logo">
                        </div>
                        <div class="col-sm-5"></div>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-2 control-label">营业执照</div>
                        <div class="col-sm-5">
                            {empty name="orgCert.cert"}暂无
                            {else/}
                            <img src="{$orgCert.cert}" class="img-thumbnail" alt="logo">
                            {/empty}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">法人证件</div>
                        <div class="col-sm-5">
                            {empty name="orgCert.fr.photo_positive"}暂无
                            {else/}
                            <img src="{$orgCert.fr.photo_positive}" class="img-thumbnail" alt="logo">
                            {/empty}
                        </div>
                        <div class="col-sm-5">证件号：{$orgCert.fr.cert_no}</div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">创建人证件</div>
                        <div class="col-sm-5">
                            {empty name="idCard.photo_positive"}暂无
                            {else/}
                            <img src="{$idCard.photo_positive}" class="img-thumbnail" alt="logo">
                            {/empty}
                        </div>
                        <div class="col-sm-5">证件号：{$idCard.cert_no}</div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">其他证书</div>
                        <div class="col-sm-5">
                            {empty name="orgCert.other"}暂无
                            {else/}
                            <img src="{$orgCert.other}" class="img-thumbnail" alt="logo">
                            {/empty}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-2 control-label">注册时间</div>
                        <div class="col-sm-5">
                            {$matchInfo.match_org.create_time}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2 control-label">个人备注</div>
                        <div class="col-sm-5">
                            {$matchInfo.match_org.remarks}
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    {/if}
</div>
{/block}

{block name="js"}
<script>
"use strict";
function check(code) {
    var match_id = $('#id').val();
    var sremarks_txt = $("textarea[name='system_remarks']").val();
    console.log(match_id);
    switch ( code ) {
        case 1:
            var msg = '确定审核通过?';
            if ( confirm(msg) === true ) {
                sendpost(match_id, code, '');
            }
            break;
        case 2:
            var msg = '确定审核不通过?';
            if ( confirm(msg) === true ) {
                if (sremarks_txt == "") {
                    alert('请输入平台备注以作审核回复');
                    return;
                }
                sendpost(match_id, code, sremarks_txt);
            }
            break;
    }
}

function sendpost(match_id, code, sremarks) {
    var serverurl = "{:url('league/audit')}";
    $.post(serverurl, {
        id: match_id,
        status: code,
        system_remarks: sremarks
    }, function(res) {
        console.log(res);
        alert(res.msg);
        if (res.status) {
            location.reload();
        }
    }, 'json');
}
</script>
{/block}