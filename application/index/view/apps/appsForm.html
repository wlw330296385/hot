<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>报名表</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--标准mui.css-->
    <link rel="stylesheet" href="/static/frontend/css/mui.min.css">
    <!--自定义style.css-->
    <link rel="stylesheet" type="text/css" href="/static/frontend/css/style.css" />
    <!-- webuploader -->
    <link rel="stylesheet" href="/static/frontend/css/webuploader.css">
    <style>
        .tipContent {
            margin: 25px 28px 0 28px;
            line-height: 54px;
            vertical-align: middle;
            display: inline-flex;
        }
        .tipContent .tipContentText p {
            line-height: 20px;
            color:#666;
        }
        .registerFrom {
            margin: 10px 25px 0px;
            background: none;
        }

        .registerFrom .mui-input-row {
            margin-top: 15px;
            background: #fff;
        }

        .tipBottom {
            margin: 15px 40px;
        }

        .tipBottom p {
            margin-bottom: 0;
            color: #999;
        }

    </style>
</head>

<body>

    <header class="mui-bar mui-bar-nav subheader">
        <h1 class="mui-title">活动登记表</h1>
    </header>

    <div class="mui-content mt55" style="background: none !important">
        <div class="tipContent">
            <div class="tipContentText">
                <p><strong>活动登记说明：</strong></p>
                <p>{$eventInfo.apps_des}</p>
            </div>
        </div>

        <form action="" class="mui-input-group registerFrom">
            <input type="hidden" name="__token__" class="data" value="{$Request.token}" />
            <div class="mui-input-row">
                <label class="colororange">姓名</label>
                <input type="text" class="data" name="name" value="{$memberInfo.realname}" placeholder="姓名">
            </div>
            <div class="mui-input-row">
                <label class="colororange">性别</label>
                <input type="text" class="data" name="age" value="{:getSex($memberInfo['sex'])}" placeholder="性别">
            </div>

            <div class="mui-input-row">
                <label class="colororange">所属社区</label>
                <input type="text" class="data" name="address" value="" placeholder="户口所在街道社区">
            </div>

            <div class="mui-input-row">
                <label class="colororange">居住地</label>
                <input type="text" class="data" name="address" value="" placeholder="现居住地址">
            </div>

            <div class="mui-input-row">
                <label class="colororange">籍贯</label>
                <input type="text" class="data" name="school" value="" placeholder="籍贯">
            </div>

            <div class="mui-input-row">
                <label class="colororange">身份证号码</label>
                <input type="text" name="idno" value="{$cert.cert_no}" class="input wd54 idno" placeholder="请输入身份证号码">
            </div>

            <div class="mui-input-row h-auto">
                <a class="mui-navigate-right filePicker" onclick="add_id(1)">
                    <label class="colororange">身份证</label>
                    <img id="preview_1" class="coachicon icon01 upload-preview" alt="" src="{$cert.photo_positive}">
                    <input type="hidden" name="photo_positive" value="">
                </a>
            </div>

            <div class="mui-input-row">
                <label class="colororange">联系电话</label>
                <input type="text" class="data telephone" name="telephone reg_mobile" value="" placeholder="联系电话">
            </div>

            <div class="mui-input-row">
                <label class="colororange">短信验证码</label>
                <input type="button" class="code-btn" value="获取验证码" onclick="sendCode(this)" style="width: 30%;">
                <input id="code" type="text" class="input reg_code reg_validate" placeholder="输入验证码" style="width: 30%;">
            </div>

            <div class="mui-input-row" style="height: auto !important;">
                <textarea name="remarks" class="mui-text-left remarks" rows="4" value="" placeholder="备注:"></textarea>
            </div>
        </form>
        <div class="tipBottom">
            <p>本活动最终解释权归</p>
            <p>巨星培训所有</p>
        </div>

        <ul class="mui-table-view operation">
            <li class="mui-table-view-cell mui-media mui-col-xs-12 opli bggreen" onclick="submitAction()">
                提交
            </li>
        </ul>

    </div>

    <script src="/static/frontend/js/mui.min.js"></script>
    <script src="/static/frontend/js/jquery-3.2.1.min.js"></script>
    <script src="/static/frontend/js/common.js"></script>
    <script src="/static/frontend/js/wooApi.js"></script>
    <script>
        var uploadApiUrl = "{:url('api/upload/imgwupload', ['usage' => 'cert'])}";
    </script>
    <script src="/static/frontend/libs/webuploader.cert.js?v=<?php echo time();?>"></script>
    <script src="/static/frontend/js/uploadcert.js?v=<?php echo time();?>"></script>
    <script src="/static/frontend/js/uploadduotu.js?v=<?php echo time();?>"></script>
    <script src="/static/frontend/js/smsCode.js"></script>
    <script>

        $(function () {
            //验证短信验证码
            $('#code').on("blur", function () {
                var code = document.getElementById('code').value;
                var codeReg = /^\d{6,6}$/;
                if (!codeReg.test(code)) {
                    mui.toast('请填写正确的验证码');
                    flag = false;
                } else {
                    telephone = $(".telephone").val();
                    console.log(telephone)
                    var result = smsCode.validateSmsCodeApi(telephone, code, "{:url('api/sms/validateSmsCodeApi','','',true)}");
                    if (result == 200) {
                        flag = true;
                        mui.toast(result.msg);
                    } else {
                        flag = false;
                        mui.toast(result.msg);
                    }
                }
            });
        })

        // 发送短信验证码
        function sendCode(obj) {
            telephone = $(".telephone").val();
            var telephoneReg = /^\d{11,11}$/;
            if (!telephoneReg.test(telephone)) {
                mui.toast('请填写正确的手机号码');
                flag = false;
            } else {
                var result = smsCode.getMobileCodeApi(obj, telephone, "{:url('api/sms/getMobileCodeApi','','',true)}");
                if (result.code == 200) {
                    flag = true;
                    mui.toast(result.msg);
                } else {
                    flag = false;
                    mui.toast(result.msg);

                }
            }
        }

        // 获取数据并进行提交
        function submitAction() {

            if (!(/^1[34578]\d{9}$/).test($("input[name=telephone]").val())) {
                mui.toast("请填写正确的手机格式");
                return false;
            };

            var data = wooApi.getInputData('input', 'data');
            datas = wooApi.getInputData('select', 'data', data);
            // 获取其他标签值
            arrData = wooApi.getDomData('domData', datas);
            var objData = wooApi.arrTOobj(arrData);
            objData.remarks = $(".remarks").val();
            var url = "{:url('api/member/createstudyinterion')}";
            var ajaxResult = wooApi.asyncF(url, objData);
            if (ajaxResult.code == 200) {
                mui.alert('登记成功，工作人员将会尽快与您联系', "", '确定', function () {
                    window.location.href = "{:url('index/index')}"
                })
            } else {
                mui.alert(ajaxResult.msg, '提交失败', function () { });
                mui.get("{:url('api/frontend/reloadtoken')}", function (data) {
                    if (data.code === 200) {
                        $('input[name=__token__]').val(data.data);
                    }
                }, 'json');
            }
        };

    </script>
</body>

</html>